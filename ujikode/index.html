<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>SIMPADAN TANGKAP - SISTEM PEMETAAN NELAYAN</title>
    
    <!-- LOAD SEMUA CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@500;600;700;800;900&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- LOAD SEMUA JAVASCRIPT LIBRARY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- LOAD FILE JAVASCRIPT YANG DIPISAHKAN -->
    <script src="idcard.js"></script>
    <script src="reload.js" onerror="console.log('File reload.js belum tersedia di server, menggunakan database lokal.')"></script>
    <script src="convert.js"></script>
    <script src="print.js"></script>
    <script src="export.js"></script>
    <script src="backup.js"></script>
    <script src="main.js"></script>
</head>
<body>
    <!-- Modal Loading -->
    <div class="loading-modal-overlay" id="loadingModal" style="display: none;">
        <div class="loading-modal-content">
            <div class="loading-spinner"></div>
            <h3 class="loading-title" id="loadingTitle">Memproses Data</h3>
            <p class="loading-message" id="loadingMessage">Mohon tunggu, sistem sedang memproses permintaan Anda. Proses ini mungkin memerlukan waktu beberapa saat tergantung jumlah data yang tersedia.</p>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <div id="qr-code-generator">
        <div id="qr-right"></div> 
    </div>
    
    <!-- Container untuk tabel PDF (hidden) -->
    <div class="pdf-table-container" id="pdfTableContainer"></div>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="login-overlay" id="loginModal">
        <ul class="circles">
            <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
        </ul>
        <div class="login-card">
            <div class="login-header-new">
                <div class="simata-logo-container">
                    <div class="simata-icon-box">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/logoku.png" alt="Logo SIMPADAN TANGKAP" onerror="this.onerror=null; this.innerHTML='<i class=\'fas fa-eye fa-4x\'></i>';">
                    </div>
                </div>
                <h1 class="simata-title">SIMPADAN TANGKAP</h1>
                <p class="simata-subtitle">SISTEM SATU DATA NELAYAN</p>
                <div class="simata-slogan">Situbondo Naik Kelas</div>
            </div>
            <div class="p-4 p-md-5 pt-2">
                <form id="loginForm">
                    <div class="mb-4 text-center">
                        <p class="small text-primary fw-bold mb-2" id="currentDateDisplay"></p>
                        <div class="input-group input-group-lg shadow-sm rounded-pill overflow-hidden">
                            <span class="input-group-text bg-light border-0 ps-4"><i class="fas fa-key text-success"></i></span>
                            <input type="password" class="form-control bg-light border-0 fs-6" id="securityCode" placeholder="Masukkan kode keamanan" required>
                            <button type="button" class="input-group-text bg-light border-0 password-toggle-btn" id="passwordToggle">
                                <i class="fas fa-eye" id="passwordToggleIcon"></i>
                            </button>
                        </div>
                        <small class="text-muted mt-2 d-block" id="passwordHint">Kode Keamanan Berubah Setiap Hari</small>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-3 fw-bold shadow rounded-pill" id="loginButton" style="background: var(--primary-gradient);">
                        BUKA DASHBOARD
                        <span class="spinner-border spinner-border-sm d-none ms-2" id="loginSpinner"></span>
                    </button>
                </form>
                
                <!-- TOMBOL TAMBAHAN BARU -->
                <div class="login-extra-buttons">
                    <a href="https://drive.google.com/drive/folders/1zmLnQ8bXFEL682BXzA2pV6WsQq7p4wdo?usp=sharing" target="_blank" class="btn btn-outline-primary">
                        <i class="fas fa-download me-2"></i>Panduan Aplikasi
                    </a>
                    <a href="http://www.dinasperikanansitubondo.com/simpadan/peta" target="_blank" class="btn btn-outline-success">
                        <i class="fas fa-map me-2"></i>Lihat Peta
                    </a>
                </div>
                
                <div class="text-center mt-4 pt-3 border-top">
                    <small class="text-muted opacity-75">&copy; 2025 Dinas Perikanan Kabupaten Situbondo</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Notifikasi Login Berhasil -->
    <div class="modal fade login-success-modal" id="loginSuccessModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="w-100 d-flex flex-column align-items-center justify-content-center">
                        <i class="fas fa-check-circle fa-3x mb-3 text-warning"></i>
                        <h4 class="fw-bold mb-0 text-center">Akses Diotorisasi</h4>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="login-success-icon d-flex justify-content-center">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h5 class="fw-bold text-center mb-4" style="color: #0c2461;">SELAMAT DATANG DI SIMPADAN TANGKAP</h5>
                    
                    <div class="welcome-message">
                        <p class="mb-3">Anda telah berhasil mengakses <span class="fw-bold" style="color: #0c2461;">Sistem Informasi Pemetaan Data Nelayan Terpadu</span> Dinas Perikanan Kabupaten Situbondo.</p>
                        
                        <div class="welcome-highlight mb-3">
                            <i class="fas fa-user-check me-2"></i>Akses Anda telah diverifikasi dan diotorisasi
                        </div>
                        
                        <div class="welcome-highlight mb-3">
                            <i class="fas fa-database me-2"></i>Sistem siap untuk pengelolaan data nelayan terpadu
                        </div>
                        
                        <div class="welcome-highlight">
                            <i class="fas fa-chart-line me-2"></i>Dashboard analitik tersedia untuk pengambilan keputusan
                        </div>
                    </div>
                    
                    <p class="text-muted small mt-4 text-center">
                        <i class="fas fa-info-circle me-2"></i>
                        Sistem ini menggunakan teknologi keamanan dinamis untuk melindungi data sensitif
                    </p>
                </div>
                <div class="modal-footer justify-content-center border-0">
                    <button type="button" class="btn btn-primary px-5 fw-bold shadow" data-bs-dismiss="modal" id="btnContinueDashboard">
                        <i class="fas fa-rocket me-2"></i>LANJUT KE DASHBOARD
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="welcomeModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content welcome-modal-content">
                <div class="welcome-header">
                    <i class="fas fa-satellite-dish fa-3x mb-3 text-warning"></i>
                    <h4 class="fw-bold mb-0">Selamat Datang, Sobat!</h4>
                </div>
                <div class="welcome-body">
                    <p class="text-muted mb-4">
                        Untuk memastikan data yang Anda akses adalah data terbaru dan valid, sistem merekomendasikan untuk melakukan <strong>Sinkronisasi Data</strong> terlebih dahulu.
                    </p>
                    <div class="d-grid gap-2 justify-content-center">
                        <button type="button" class="welcome-btn-reload" id="btnWelcomeReload">
                            <i class="fas fa-sync me-2"></i> Sinkronisasi Data Sekarang
                        </button>
                        <button type="button" class="btn btn-link text-muted text-decoration-none btn-sm mt-2" data-bs-dismiss="modal">
                            Tutup Notifikasi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Data Wilayah - DIREVISI DAN DISEMPURNAKAN -->
    <div class="modal fade" id="modalDataWilayah" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="wilayah-modal-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="modal-title fw-bold mb-1"><i class="fas fa-map-marked-alt me-2"></i> Data Wilayah</h5>
                            <p class="mb-0 opacity-75">Kelola data berdasarkan wilayah administratif</p>
                        </div>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                </div>
                <div class="modal-body p-0">
                    <div class="wilayah-search-box px-4">
                        <div class="alert alert-info mb-3">
                            <i class="fas fa-info-circle me-2"></i>
                            Pilih desa untuk memuat data nelayan dari wilayah tersebut. Anda juga dapat langsung input data untuk desa yang dipilih.
                        </div>
                        
                        <div class="row align-items-center mb-3">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="searchWilayah" placeholder="Cari nama desa...">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end align-items-center gap-3">
                                    <div class="wilayah-status-indicator" id="wilayahStatusIndicator">
                                        <i class="fas fa-globe"></i>
                                        <span>Mode Global</span>
                                    </div>
                                    <button class="btn btn-warning" id="btnInputGlobalModal">
                                        <i class="fas fa-globe me-2"></i> Switch ke Global
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="px-4 pb-4">
                        <!-- KARTU GLOBAL -->
                        <div class="wilayah-global-card mb-4">
                            <div class="icon">
                                <i class="fas fa-globe-americas"></i>
                            </div>
                            <h5 class="fw-bold">Mode Global</h5>
                            <p class="text-muted mb-3">Akses dan kelola semua data nelayan tanpa batasan wilayah</p>
                            <button class="btn btn-warning px-4" id="btnGlobalMode">
                                <i class="fas fa-database me-2"></i> Aktifkan Mode Global
                            </button>
                        </div>
                        
                        <h6 class="fw-bold mb-3">Daftar Desa / Kelurahan</h6>
                        
                        <!-- KONTAINER KARTU DESA -->
                        <div class="wilayah-grid" id="wilayahCardsContainer">
                            <!-- Kartu desa akan dimuat di sini -->
                        </div>
                        
                        <!-- STATE KOSONG -->
                        <div class="wilayah-empty-state d-none" id="wilayahEmptyState">
                            <i class="fas fa-search"></i>
                            <h5 class="text-muted">Desa tidak ditemukan</h5>
                            <p class="text-muted">Coba gunakan kata kunci pencarian yang berbeda</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-top py-3">
                    <div class="d-flex justify-content-between w-100">
                        <div class="text-muted small">
                            <i class="fas fa-info-circle me-1"></i>
                            Total <span id="totalDesaCount">0</span> desa tersedia
                        </div>
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sticky-warning" id="duplicateWarning">
        <div class="d-flex align-items-start">
            <div class="me-3 text-danger"><i class="fas fa-exclamation-triangle fa-2x"></i></div>
            <div>
                <h6 class="fw-bold text-danger mb-1">PERHATIAN: Data Ganda!</h6>
                <p class="small text-muted mb-2">Sistem mendeteksi adanya NIK ganda yang belum diperbaiki.</p>
                <button class="btn btn-sm btn-outline-danger" onclick="document.getElementById('v-pills-data-tab').click(); setTimeout(() => document.getElementById('btnCekGanda').click(), 200);">Periksa Sekarang</button>
                <button class="btn btn-sm btn-link text-muted text-decoration-none ms-2" onclick="document.getElementById('duplicateWarning').style.display='none'">Tutup</button>
            </div>
        </div>
    </div>

    <div class="app-content-unauthenticated" id="appContent" style="display:none;">
        <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo-icon">
                    <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/logoku2.png" alt="Logo SIMPADAN TANGKAP" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <h1 class="app-title">SISTEM MANAJEMEN & PEMETAAN DATA PEMBERDAYAAN NELAYAN TANGKAP</h1>
                <p class="app-subtitle" id="dynamicSubtitle">DINAS PERIKANAN KABUPATEN SITUBONDO</p>
                <div class="app-slogan">Situbondo Naik Kelas</div>
                <div class="app-origin" id="appOrigin">APLIKASI SIMPADAN TANGKAP</div>
                <div class="position-absolute top-0 end-0 p-3 d-none d-md-block">
                    <span class="badge bg-white text-success border shadow-sm px-3 py-2 rounded-pill"><i class="fas fa-circle text-success me-2 small"></i>Online v5.9</span>
                </div>
            </div>
            
            <div class="row g-0 flex-grow-1">
                <div class="col-md-3 col-lg-2 bg-white border-end py-4" id="sidebarMenu">
                    <div class="px-3 mb-3 text-muted small fw-bold text-uppercase" style="color: var(--secondary-color) !important; padding-left: 15px;">Menu Utama</div>
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist">
                        <button class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dashboard" type="button"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
                        <button class="nav-link" id="v-pills-input-tab" data-bs-toggle="pill" data-bs-target="#v-pills-input" type="button"><i class="fas fa-edit"></i> Input Data</button>
                        <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button"><i class="fas fa-database"></i> Data Nelayan</button>
                        <button class="nav-link" id="v-pills-verify-tab" data-bs-toggle="pill" data-bs-target="#v-pills-verify" type="button"><i class="fas fa-check-circle"></i> Verifikasi KIN</button>
                        <button class="nav-link" id="v-pills-print-tab" data-bs-toggle="pill" data-bs-target="#v-pills-print" type="button"><i class="fas fa-print"></i> Cetak Laporan</button>
                        <button class="nav-link" id="v-pills-export-tab" data-bs-toggle="pill" data-bs-target="#v-pills-export" type="button"><i class="fas fa-file-export"></i> Ekspor Data</button>
                        <button class="nav-link" id="v-pills-backup-tab" data-bs-toggle="pill" data-bs-target="#v-pills-backup" type="button"><i class="fas fa-cloud-download-alt"></i> Backup & Restore</button>
                        <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button"><i class="fas fa-cog"></i> Pengaturan</button>
                        <!-- TAMBAHAN: Tombol Refresh Halaman -->
                        <button class="nav-link" id="btn-refresh-page" type="button">
                            <i class="fas fa-redo"></i> Refresh Halaman
                        </button>
                        <!-- Tombol Reload Data dengan spinner -->
                        <button class="nav-link" id="btn-reload-repo" type="button">
                            <i class="fas fa-sync"></i> Reload Data
                            <span class="spinner-border spinner-border-sm reload-spinner" id="reloadSpinner"></span>
                        </button>
                        <div class="mt-4 pt-3 border-top px-3">
                             <button class="nav-link text-danger w-100 justify-content-start bg-light" id="v-pills-logout-tab" type="button"><i class="fas fa-sign-out-alt"></i> Keluar</button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-9 col-lg-10 p-0 d-flex flex-column" style="background-color: #fff;">
                    <div class="p-3 p-lg-5 flex-grow-1">
                        <div class="tab-content" id="v-pills-tabContent">
                            
                            <div class="tab-pane fade show active" id="v-pills-dashboard">
                                <h3 class="section-title">Ringkasan Eksekutif</h3>
                                <div class="row g-3 dashboard-row">
                                    <div class="col-6 col-lg-3">
                                        <div class="card border-0 shadow-sm h-100 text-white" style="background: var(--primary-gradient);">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="small fw-bold text-uppercase opacity-75">Total</span>
                                                    <i class="fas fa-users opacity-50 fa-2x"></i>
                                                </div>
                                                <h2 class="fw-bold mb-0" id="totalPenerima">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-lg-3">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="text-muted small fw-bold text-uppercase">Nelayan Penuh Waktu</span>
                                                    <i class="fas fa-user-tie text-primary opacity-50 fa-2x"></i>
                                                </div>
                                                <h2 class="fw-bold text-dark mb-0" id="totalPenuhWaktu">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-lg-3">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="text-muted small fw-bold text-uppercase">Kapal</span>
                                                    <i class="fas fa-ship text-info opacity-50 fa-2x"></i>
                                                </div>
                                                <h2 class="fw-bold text-dark mb-0" id="totalPemilik">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- TAMBAHAN FITUR RINGKASAN EKSEKUTIF -->
                                    <div class="col-6 col-lg-3">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="text-muted small fw-bold text-uppercase">Nelayan Sambilan Utama</span>
                                                    <i class="fas fa-user-clock text-warning opacity-50 fa-2x"></i>
                                                </div>
                                                <h2 class="fw-bold text-dark mb-0" id="totalSambilanUtama">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-lg-3">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="text-muted small fw-bold text-uppercase">Nelayan Sambilan Tambahan</span>
                                                    <i class="fas fa-user-clock text-success opacity-50 fa-2x"></i>
                                                </div>
                                                <h2 class="fw-bold text-dark mb-0" id="totalSambilanTambahan">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-lg-3">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="text-muted small fw-bold text-uppercase">ABK</span>
                                                    <i class="fas fa-users text-info opacity-50 fa-2x"></i>
                                                </div>
                                                <h2 class="fw-bold text-dark mb-0" id="totalABK">0</h2>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-4 g-3">
                                    <div class="col-md-6">
                                        <div class="card h-100 shadow-sm border-0">
                                            <div class="card-header bg-white fw-bold py-3"><i class="fas fa-chart-pie me-2 text-primary"></i> Proporsi Profesi</div>
                                            <div class="card-body"><div class="chart-container-fixed"><canvas id="profesiChart"></canvas></div></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card h-100 shadow-sm border-0">
                                            <div class="card-header bg-white fw-bold py-3"><i class="fas fa-chart-bar me-2 text-primary"></i> Statistik Kepemilikan Kapal</div>
                                            <div class="card-body"><div class="chart-container-fixed"><canvas id="kapalChart"></canvas></div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="v-pills-input">
                                <h3 class="section-title">Formulir Pendataan</h3>
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-white py-3 border-bottom">
                                        <i class="fas fa-file-alt me-2 text-primary"></i> Entri Data Baru
                                        <span class="badge bg-warning float-end" id="inputModeBadge">Mode: Global</span>
                                    </div>
                                    <div class="card-body p-4">
                                        <form id="inputForm" novalidate>
                                            <div class="alert alert-info small mb-4 border-0 bg-light-info text-primary">
                                                <i class="fas fa-info-circle me-2"></i>
                                                NIK digunakan sebagai validasi utama. Semua kolom WAJIB DIISI kecuali Keterangan, Usaha Sampingan, dan Link Drive.
                                                <span id="desaWarning" class="text-danger fw-bold d-none"> - Anda harus memilih desa terlebih dahulu di menu Data Wilayah!</span>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="nama" class="form-label">Nama Lengkap <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="nama" required placeholder="Sesuai KTP">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="nik" class="form-label">NIK (Nomori Induk Kependudukan) <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="nik" required maxlength="16" placeholder="16 Digit Angka">
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="whatsapp" class="form-label">Nomor Handphone Aktif <span class="text-danger">*</span></label>
                                                    <div class="input-group">
                                                        <span class="input-group-text">+62</span>
                                                        <input type="tel" class="form-control" id="whatsapp" required placeholder="8123xxxx">
                                                        <button class="btn btn-outline-secondary" type="button" id="btnNoWA" title="Tidak Punya WA">Tidak Ada</button>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="profesi" class="form-label">Kategori Profesi <span class="text-danger">*</span></label>
                                                    <select class="form-select" id="profesi" required>
                                                        <option value="">Pilih Profesi...</option>
                                                        <option value="Nelayan Penuh Waktu">Nelayan Penuh Waktu</option>
                                                        <option value="Nelayan Sambilan Utama">Nelayan Sambilan Utama</option>
                                                        <option value="Nelayan Sambilan Tambahan">Nelayan Sambilan Tambahan</option>
                                                    </select>
                                                    <div id="profesiHelp" class="form-text small text-muted mt-1"></div>
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-4">
                                                    <label for="statusNelayan" class="form-label">Status Pekerjaan <span class="text-danger">*</span></label>
                                                    <select class="form-select" id="statusNelayan" required>
                                                        <option value="">Pilih Status...</option>
                                                        <option value="Anak Buah Kapal">Anak Buah Kapal</option>
                                                        <option value="Pemilik Kapal">Pemilik Kapal</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4">
                                                    <label for="tahunLahir" class="form-label">Tahun Kelahiran <span class="text-danger">*</span></label>
                                                    <input type="number" class="form-control" id="tahunLahir" placeholder="YYYY" required>
                                                </div>
                                                <div class="col-md-4">
                                                    <label for="kecamatan" class="form-label fw-bold text-primary">Kecamatan <span class="text-danger">*</span></label>
                                                    <select class="form-select border-primary" id="kecamatan" required>
                                                        <option value="">Pilih Kecamatan</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="usia" class="form-label">Usia (Otomatis)</label>
                                                    <input type="text" class="form-control bg-light" id="usia" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="desa" class="form-label fw-bold text-primary">Desa / Kelurahan <span class="text-danger">*</span></label>
                                                    <select class="form-select border-primary" id="desa" required disabled>
                                                        <option value="">-- Pilih Kecamatan Terlebih Dahulu --</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <!-- ALAT PENANGKAPAN IKAN (API) -->
                                            <div class="row mb-3">
                                                <div class="col-md-12">
                                                    <label class="form-label fw-bold">Alat Penangkapan Ikan (API) <span class="text-danger">*</span></label>
                                                    <div class="card p-3 bg-light border">
                                                        <select class="form-select" id="alatTangkap" required>
                                                            <option value="">Pilih Alat Penangkapan Ikan...</option>
                                                        </select>
                                                        <div id="apiInfo" class="api-info-box mt-2" style="display:none;"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div id="ownerFields" style="display:none;" class="bg-light p-4 rounded-3 mb-3 border">
                                                <h6 class="text-primary fw-bold border-bottom pb-2 mb-3"><i class="fas fa-ship me-2"></i>Detail Aset Kapal (Wajib bagi Pemilik Kapal)</h6>
                                                <div class="row mb-3">
                                                    <div class="col-md-6">
                                                        <label class="form-label">Nama Kapal</label>
                                                        <input type="text" class="form-control" id="namaKapal">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label">Jenis Kapal</label>
                                                        <select class="form-select" id="jenisKapal">
                                                            <option value="">Pilih Jenis...</option>
                                                        </select>
                                                        <div id="kapalInfo" class="kapal-info-box mt-2" style="display:none;"></div>
                                                        <div id="apiMappingInfo" class="api-mapping-info mt-2" style="display:none;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label class="form-label fw-bold">Jenis Ikan Tangkapan Utama <span class="text-danger">*</span>
                                                        <button type="button" class="fish-info-btn" onclick="showFishInfoModal()" title="Lihat Referensi Jenis Ikan">
                                                            <i class="fas fa-info"></i>
                                                        </button>
                                                    </label>
                                                    <div class="card p-3 bg-light border">
                                                        <div id="fishCheckboxContainer" style="max-height: 200px; overflow-y: auto;">
                                                            <!-- Daftar ikan akan dimuat secara dinamis berdasarkan alat tangkap -->
                                                        </div>
                                                        <input type="text" class="form-control form-control-sm mt-2" id="jenisIkanLainnya" placeholder="Sebutkan jenis lainnya..." style="display:none;">
                                                    </div>
                                                    <small class="text-muted fst-italic">*Pilih minimal satu</small>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="usahaSampingan" class="form-label">Usaha Sampingan (Opsional)</label>
                                                    <input type="text" class="form-control" id="usahaSampingan" placeholder="Contoh: Ternak, Warung">
                                                </div>
                                            </div>
                                            
                                            <!-- PERIODE TANGGAL VALIDASI OTOMATIS DAN TERKUNCI -->
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="tanggalValidasi" class="form-label">Tanggal Validasi <span class="text-danger">*</span></label>
                                                    <div class="input-group">
                                                        <input type="date" class="form-control" id="tanggalValidasi" required readonly style="background-color: #f8f9fa;">
                                                        <span class="input-group-text bg-light">
                                                            <i class="fas fa-calendar-check text-primary" title="Tanggal validasi terkunci secara otomatis"></i>
                                                        </span>
                                                    </div>
                                                    <small class="text-muted mt-1">Tanggal validasi terkunci otomatis sesuai periode saat ini</small>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="validator" class="form-label">Petugas Validator <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="validator" required>
                                                </div>
                                            </div>
                                            
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="driveLink" class="form-label">Link Dokumen (Google Drive) <span class="text-muted">(Opsional)</span></label>
                                                    <input type="url" class="form-control" id="driveLink">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="kodeValidasi" class="form-label fw-bold text-danger">Kode Validasi (Wajib Generate) <span class="text-danger">*</span></label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control bg-light" id="kodeValidasi" readonly required placeholder="Klik Generate...">
                                                        <button type="button" class="btn btn-warning fw-bold" id="generateKodeBtn">GENERATE ID</button>
                                                    </div>
                                                    <small class="text-muted" style="font-size: 0.75rem;">*Kode validasi bersifat permanen dan tidak dapat diubah.</small>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label for="keterangan" class="form-label">Keterangan Tambahan <span class="text-muted">(Opsional)</span></label>
                                                <textarea class="form-control" id="keterangan" rows="2"></textarea>
                                            </div>
                                            
                                            <div class="d-flex justify-content-end border-top pt-3">
                                                <button type="reset" class="btn btn-light me-2 text-muted">Reset Form</button>
                                                <button type="submit" class="btn btn-primary px-4 fw-bold shadow" id="submitFormBtn">
                                                    <i class="fas fa-save me-2"></i>SIMPAN DATA
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="v-pills-data">
                                <h3 class="section-title">Database Nelayan</h3>
                                
                                <!-- TAMBAHAN: Tombol Data Wilayah dan Input Global -->
                                <div class="card mb-4 border-0 shadow-sm">
                                    <div class="card-header bg-white py-3 border-bottom">
                                        <h6 class="mb-0 fw-bold"><i class="fas fa-map me-2 text-primary"></i>Pengelolaan Data Wilayah</h6>
                                    </div>
                                    <div class="card-body p-3">
                                        <div class="d-flex flex-wrap gap-2 align-items-center">
                                            <button class="btn btn-info btn-sm shadow-sm" id="btnDataWilayah">
                                                <i class="fas fa-map-marked-alt me-2"></i> Data Wilayah
                                            </button>
                                            <button class="btn btn-warning btn-sm shadow-sm" id="btnInputGlobal">
                                                <i class="fas fa-globe me-2"></i> Input Global
                                            </button>
                                            <div class="ms-auto">
                                                <span class="badge bg-primary" id="currentWilayahBadge">Wilayah: Global (reload.js)</span>
                                            </div>
                                        </div>
                                        <div class="mt-2 text-muted small">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <span id="wilayahInfo">Mode Global: Data dari reload.js. Pilih Data Wilayah untuk mengakses data spesifik desa.</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- FITUR FILTER & VALIDASI DATA YANG DIPINDAHKAN -->
                                <div class="card mb-4 border-0 shadow-sm filter-section">
                                    <div class="card-header bg-white py-3 border-bottom">
                                        <h6 class="mb-0 fw-bold"><i class="fas fa-filter me-2 text-primary"></i>Filter & Validasi Data</h6>
                                    </div>
                                    <div class="card-body bg-light rounded">
                                        <div class="row g-3">
                                            <div class="col-md-3">
                                                <label class="form-label small fw-bold">Desa</label>
                                                <select class="form-select form-select-sm" id="filterDesa">
                                                    <option value="">Semua Desa</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label small fw-bold">Profesi</label>
                                                <select class="form-select form-select-sm" id="filterProfesi">
                                                    <option value="">Semua</option>
                                                    <option value="Nelayan Penuh Waktu">Nelayan Penuh Waktu</option>
                                                    <option value="Nelayan Sambilan Utama">Nelayan Sambilan Utama</option>
                                                    <option value="Nelayan Sambilan Tambahan">Nelayan Sambilan Tambahan</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label small fw-bold">Status Kepemilikan</label>
                                                <select class="form-select form-select-sm" id="filterStatus">
                                                    <option value="">Semua</option>
                                                    <option value="Anak Buah Kapal">Anak Buah Kapal</option>
                                                    <option value="Pemilik Kapal">Pemilik Kapal</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label small fw-bold">Jenis Kapal</label>
                                                <select class="form-select form-select-sm" id="filterJenisKapal">
                                                    <option value="">Semua</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label small fw-bold">Alat Tangkap (API)</label>
                                                <select class="form-select form-select-sm" id="filterAlatTangkap">
                                                    <option value="">Semua</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label small fw-bold">Usaha Sampingan</label>
                                                <select class="form-select form-select-sm" id="filterUsaha">
                                                    <option value="">Semua</option>
                                                    <option value="Ada">Ada Usaha Sampingan</option>
                                                    <option value="Tidak">Tidak Ada</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3 d-flex align-items-end">
                                                <button class="btn btn-primary w-100 btn-sm" id="applyFilterBtn"><i class="fas fa-search me-2"></i> Terapkan Filter</button>
                                            </div>
                                            <div class="col-md-3 d-flex align-items-end">
                                                <button class="btn btn-outline-secondary w-100 btn-sm" id="resetFilterBtn"><i class="fas fa-redo me-2"></i> Reset Filter</button>
                                            </div>
                                            <div class="col-md-12 mt-2">
                                                <div class="d-flex justify-content-end gap-2">
                                                    <!-- TAMBAHAN: Tombol Unduh PDF Tabel Data -->
                                                    <button class="btn btn-download-table-pdf btn-sm shadow-sm" id="btnUnduhTabelPdf"><i class="fas fa-file-pdf me-2"></i> Unduh PDF Tabel Data</button>
                                                    <button class="btn btn-download-filtered-pdf btn-sm shadow-sm" id="btnUnduhFilteredPdf"><i class="fas fa-file-pdf me-2"></i> Unduh PDF (Filter)</button>
                                                    <button class="btn btn-danger btn-sm shadow-sm" id="btnCekGanda"><i class="fas fa-exclamation-triangle me-2"></i> Cek Data Ganda</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                 </div>
                                 
                                <!-- TABEL DATA NELAYAN -->
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-white py-3">
                                        <div class="row align-items-center g-2">
                                            <div class="col-12 col-md-4">
                                                <h6 class="mb-0 fw-bold"><i class="fas fa-list me-2"></i>Data Terdaftar</h6>
                                            </div>
                                            <div class="col-12 col-md-8 d-flex justify-content-md-end gap-2 flex-wrap">
                                                <div class="input-group flex-grow-1 flex-md-grow-0" style="max-width: 100%; width: 300px;">
                                                    <span class="input-group-text bg-light border-end-0"><i class="fas fa-search text-muted"></i></span>
                                                    <input type="text" class="form-control border-start-0" id="searchData" placeholder="Cari cerdas (Nama, NIK, Kapal)...">
                                                </div>
                                                <button class="btn btn-danger btn-sm d-none" id="bulkDeleteBtn"><i class="fas fa-trash me-1"></i> Hapus Terpilih</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover data-table mb-0" id="dataTable">
                                                <thead>
                                                    <tr>
                                                        <th width="40" class="text-center"><input type="checkbox" id="selectAllCheckbox"></th>
                                                        <th width="50" class="text-center">No</th>
                                                        <th class="col-id-cell">Identitas Nelayan</th>
                                                        <th class="col-contact-cell">Kontak</th>
                                                        <th class="col-status-cell">Profesi & Status</th>
                                                        <th class="col-status-cell">Aset Kapal</th>
                                                        <th style="white-space: nowrap;">API</th>
                                                        <th class="col-action sticky-col-right text-center">Aksi</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="dataTableBody">
                                                    <tr><td colspan="8" class="text-center py-5 text-muted">Memuat data database...</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center p-3 border-top bg-light flex-wrap gap-2">
                                            <div class="text-muted small" id="tableInfo">Menampilkan 0 data</div>
                                            <div class="pagination-container">
                                                <span class="pagination-info" id="paginationInfo">Halaman 1</span>
                                                <nav><ul class="pagination pagination-sm mb-0" id="pagination"></ul></nav>
                                            </div>
                                        </div>
                                        <div class="p-2 small text-muted fst-italic text-end border-top">
                                            <span id="sensorStatusText" class="badge bg-secondary me-2">Sensor: ON</span>
                                            <i class="fas fa-info-circle text-danger me-1"></i> Baris <span class="badge bg-danger">Merah</span> = duplikasi NIK.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- TAB FILTER & VALIDASI YANG DIBIARKAN KOSONG -->
                            <div class="tab-pane fade" id="v-pills-filter">
                                 <h3 class="section-title">Filter & Validasi Data</h3>
                                 <div class="alert alert-info mt-4">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Fitur Filter & Validasi Data telah dipindahkan ke menu <u>Database Nelayan</u>.</strong>
                                    <p class="mb-0 mt-2">Silakan gunakan menu Database Nelayan untuk mengakses semua fitur filter dan validasi data yang telah disempurnakan.</p>
                                 </div>
                                 <div class="text-center mt-4">
                                    <button class="btn btn-primary" onclick="document.getElementById('v-pills-data-tab').click()">
                                        <i class="fas fa-database me-2"></i>Buka Menu Database Nelayan
                                    </button>
                                 </div>
                            </div>

                            <!-- TAB VERIFIKASI KIN BARU - DIREVISI DAN DISEMPURNAKAN -->
                            <div class="tab-pane fade" id="v-pills-verify">
                                <h3 class="section-title">Verifikasi KIN (Kode Identifikasi Nelayan)</h3>
                                
                                <div class="row mb-4">
                                    <div class="col-md-10 mx-auto">
                                        <div class="card verify-card shadow-sm">
                                            <div class="verify-header">
                                                <div class="verify-icon-container">
                                                    <i class="fas fa-id-card"></i>
                                                </div>
                                                <h4 class="fw-bold mb-2">Verifikasi Data Nelayan</h4>
                                                <p class="mb-0 opacity-75">Masukkan Kode Validasi (KIN) atau NIK untuk memverifikasi keabsahan data nelayan</p>
                                            </div>
                                            <div class="card-body p-4">
                                                <div class="row mb-4">
                                                    <div class="col-md-12">
                                                        <div class="input-group verify-input-group">
                                                            <span class="input-group-text bg-primary text-white border-0"><i class="fas fa-search"></i></span>
                                                            <input type="text" class="form-control border-0 py-3" id="verifyInput" placeholder="Masukkan Kode Validasi (contoh: VLD-ABC123) atau NIK 16 digit" autocomplete="off">
                                                            <button class="btn btn-primary px-4 fw-bold border-0" type="button" id="verifyBtn">Verifikasi</button>
                                                        </div>
                                                        <div class="form-text mt-3 text-center">
                                                            <i class="fas fa-info-circle text-primary me-1"></i>
                                                            Kode Validasi (KIN) dapat ditemukan di ID Card atau kolom "Kode Validasi" pada data nelayan
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="verify-breadcrumb">
                                                            <div class="verify-breadcrumb-item active" onclick="setVerifyExample('kin')">
                                                                <i class="fas fa-id-card me-2"></i>Cek dengan KIN
                                                            </div>
                                                            <div class="verify-breadcrumb-item" onclick="setVerifyExample('nik')">
                                                                <i class="fas fa-address-card me-2"></i>Cek dengan NIK
                                                            </div>
                                                            <div class="verify-breadcrumb-item" onclick="setVerifyExample('all')">
                                                                <i class="fas fa-list me-2"></i>Tampilkan Semua KIN
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- HASIL VERIFIKASI -->
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="card shadow-sm border-0 mb-4" id="verifyResultCard" style="display: none;">
                                            <div class="card-body p-0">
                                                <div class="verify-result-header" id="verifyResultHeader">
                                                    <div class="d-flex align-items-center">
                                                        <div class="me-3" id="verifyResultIcon"></div>
                                                        <div>
                                                            <h5 class="fw-bold mb-1" id="verifyResultTitle"></h5>
                                                            <p class="mb-0 opacity-75" id="verifyResultSubtitle"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="verify-result-content" id="verifyResultBody">
                                                    <div class="row" id="verifyResultContent"></div>
                                                </div>
                                                
                                                <div class="verify-actions" id="verifyResultActions">
                                                    <div class="d-flex gap-2 flex-wrap justify-content-center">
                                                        <button class="btn btn-outline-secondary px-4" onclick="resetVerifyForm()">
                                                            <i class="fas fa-redo me-2"></i>Cari Lagi
                                                        </button>
                                                        <button class="btn btn-primary px-4" id="verifyDetailBtn" style="display: none;">
                                                            <i class="fas fa-eye me-2"></i>Lihat Detail Lengkap
                                                        </button>
                                                        <button class="btn btn-success px-4" id="verifyIdCardBtn" style="display: none;">
                                                            <i class="fas fa-id-card me-2"></i>Cetak ID Card
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- DAFTAR SEMUA KIN -->
                                        <div class="card shadow-sm border-0" id="allKinCard" style="display: none;">
                                            <div class="verify-result-header">
                                                <div class="d-flex align-items-center">
                                                    <i class="fas fa-list-check me-2"></i> 
                                                    <div>
                                                        <h5 class="fw-bold mb-0">Daftar Semua Kode Validasi (KIN) Terdaftar</h5>
                                                        <p class="mb-0 opacity-75">Total: <span class="badge bg-warning ms-1" id="totalKinCount">0</span> KIN terdaftar</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card-body p-0">
                                                <div class="table-responsive">
                                                    <table class="table table-hover mb-0">
                                                        <thead>
                                                            <tr>
                                                                <th width="50">No</th>
                                                                <th>Kode Validasi (KIN)</th>
                                                                <th>Nama Nelayan</th>
                                                                <th>NIK</th>
                                                                <th>Desa/Kecamatan</th>
                                                                <th>Status Validasi</th>
                                                                <th>Aksi</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="allKinTableBody">
                                                            <tr>
                                                                <td colspan="7" class="text-center py-4 text-muted">
                                                                    <i class="fas fa-spinner fa-spin me-2"></i>Memuat data KIN...
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="v-pills-print">
                                <h3 class="section-title">Cetak Laporan</h3>
                                <div class="card p-5 text-center shadow-sm border-0">
                                    <div class="mb-3"><i class="fas fa-file-pdf fa-4x text-danger opacity-50"></i></div>
                                    <h5>Cetak Laporan Data Terfilter</h5>
                                    <p class="text-muted">Fitur ini akan mencetak data rekapitulasi lengkap sesuai data yang tersedia dalam format PDF Resmi.</p>
                                    <button class="btn btn-danger px-5 mt-3 shadow" id="printPdfBtn"><i class="fas fa-download me-2"></i> Download PDF Laporan Resmi</button>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="v-pills-export">
                                <h3 class="section-title">Ekspor & Pelaporan Data</h3>
                                <div class="row g-4">
                                    <div class="col-md-12">
                                        <div class="card p-4 border-success bg-white shadow-sm" style="border-left: 5px solid #25D366;">
                                            <div class="d-flex align-items-start flex-column flex-md-row">
                                                <div class="me-md-4 mb-3 mb-md-0 text-success"><i class="fab fa-whatsapp fa-3x"></i></div>
                                                <div>
                                                    <h5 class="fw-bold text-dark mb-2">Lapor Cepat via WhatsApp Center</h5>
                                                    <p class="mb-2 text-muted" style="line-height: 1.6;">
                                                        Silakan unduh <strong>File Sinkronisasi (reload.js)</strong> melalui tombol di bawah.
                                                        Selanjutnya, klik tombol <strong>"Kirim Laporan"</strong> untuk terhubung ke WhatsApp Administrator Dinas Perikanan Kabupaten Situbondo.
                                                        <br><span class="text-danger small">*Harap lampirkan file <b>reload.js</b> yang telah diunduh pada chat WhatsApp tersebut sebagai bukti sinkronisasi data.</span>
                                                    </p>
                                                    <button class="btn btn-success mt-2 px-4" id="sendWaBtn"><i class="fas fa-paper-plane me-2"></i> Kirim Laporan ke Pusat</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6"><button class="btn btn-outline-success w-100 py-4 h-100 shadow-sm" id="exportExcelBtn"><i class="fas fa-file-excel fa-2x mb-2 d-block"></i>Download Excel</button></div>
                                    <div class="col-md-6"><button class="btn btn-outline-warning w-100 py-4 h-100 shadow-sm" id="exportReloadJsBtn"><i class="fas fa-file-code fa-2x mb-2 d-block"></i>Download File Sinkronisasi Data</button></div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="v-pills-backup">
                                <h3 class="section-title">Backup & Restore</h3>
                                <div class="alert alert-warning small"><i class="fas fa-exclamation-triangle me-2"></i> <strong>Sistem Smart Restore:</strong> Data yang direstore akan <strong>DIGABUNGKAN</strong> dengan data yang ada (Merge), tidak menghapus data lama. Duplikasi NIK akan ditandai Merah.</div>
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <div class="card p-4 h-100 text-center border-primary shadow-sm">
                                            <div class="mb-3"><i class="fas fa-cloud-download-alt fa-3x text-primary"></i></div>
                                            <h5>Download Backup</h5>
                                            <p class="small text-muted mb-4">Unduh file backup data nelayan dalam format JSON yang mudah dibaca.</p>
                                            <button class="btn btn-primary w-100" id="backupDataBtn">Unduh Database Lengkap</button>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card p-4 h-100 text-center border-warning shadow-sm">
                                            <div class="mb-3"><i class="fas fa-cloud-upload-alt fa-3x text-warning"></i></div>
                                            <h5>Restore Data</h5>
                                            <p class="small text-muted mb-0">Upload file .js atau .json untuk mengembalikan data.</p>
                                            <input type="file" class="form-control my-3" id="restoreFileInput" accept=".js,.json">
                                            <button class="btn btn-warning w-100 text-white" id="restoreDataBtn" disabled>Proses Restore & Merge</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="v-pills-settings">
                                <h3 class="section-title">Pengaturan Sistem</h3>
                                <div class="card p-4 border-0 shadow-sm mb-4">
                                    <h6 class="fw-bold mb-3 border-bottom pb-2">Identitas Aplikasi</h6>
                                    <form id="settingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Nama Aplikasi (Tetap)</label>
                                                <input type="text" class="form-control" id="appName" value="SISTEM MANAJEMEN & PEMETAAN DATA PEMBERDAYAAN NELAYAN TANGKAP" readonly style="background-color: #f8f9fa; cursor: not-allowed;">
                                                <small class="text-muted">Nama aplikasi tetap tidak dapat diubah</small>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Nama Instansi (Dapat Disesuaikan)</label>
                                                <input type="text" class="form-control" id="appSubtitle" value="SIMPADAN TANGKAP - DINAS PERIKANAN SITUBONDO" placeholder="Masukkan nama instansi/desa">
                                                <small class="text-muted">Nama instansi akan muncul di header aplikasi</small>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Tampilkan Baris Per Halaman</label>
                                                <input type="number" class="form-control" id="itemsPerPageSelect" min="1" value="5" step="1">
                                                <small class="text-muted">Masukkan jumlah baris yang ingin ditampilkan per halaman (minimal 1)</small>
                                            </div>
                                        </div>

                                        <button type="submit" class="btn btn-primary">Simpan Pengaturan</button>
                                    </form>
                                </div>
                                
                                <!-- FITUR BARU: Pengaturan Pejabat Penandatangan -->
                                <div class="card p-4 border-0 shadow-sm mb-4">
                                    <h6 class="fw-bold mb-3 border-bottom pb-2">Pengaturan Pejabat Penandatangan</h6>
                                    <form id="officialForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Nama Pejabat</label>
                                                <input type="text" class="form-control" id="officialName" placeholder="Masukkan nama pejabat" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">NIP</label>
                                                <input type="text" class="form-control" id="officialNip" placeholder="Masukkan NIP pejabat" required>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-12">
                                                <label class="form-label">Jabatan</label>
                                                <input type="text" class="form-control" id="officialPosition" placeholder="Masukkan jabatan pejabat" required>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Simpan Pengaturan Pejabat</button>
                                        <small class="text-muted d-block mt-2">*Data ini akan digunakan untuk tanda tangan pada dokumen PDF resmi</small>
                                    </form>
                                </div>
                                
                                <!-- Kode Keamanan Sensor Data -->
                                <div class="card p-4 border-0 shadow-sm mb-4">
                                    <h6 class="fw-bold mb-3 border-bottom pb-2">Kode Keamanan Sensor Data</h6>
                                    <form id="sensorCodeForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Kode Keamanan Sensor Saat Ini</label>
                                                <input type="password" class="form-control" id="currentSensorCode" placeholder="Masukkan kode saat ini" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Kode Keamanan Sensor Baru</label>
                                                <input type="password" class="form-control" id="newSensorCode" placeholder="Kode baru (min. 6 digit)" required minlength="6">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Konfirmasi Kode Baru</label>
                                                <input type="password" class="form-control" id="confirmSensorCode" placeholder="Ulangi kode baru" required minlength="6">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Perbarui Kode Keamanan Sensor</button>
                                        <small class="text-muted d-block mt-2">*Kode ini digunakan untuk menonaktifkan sensor dan reset data</small>
                                    </form>
                                </div>
                                
                                <div class="card p-4 border-0 shadow-sm border-left border-4 border-danger">
                                    <h6 class="fw-bold mb-3 text-danger"><i class="fas fa-user-shield me-2"></i>Privasi & Keamanan Data</h6>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong class="d-block">Sensor Data Pribadi (NIK & No. HP)</strong>
                                            <small class="text-muted">Menyensor 4 digit terakhir dengan tanda bintang (*) pada tabel dan hasil unduhan.</small>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="privacyToggle" style="width: 3em; height: 1.5em; cursor: pointer;" checked>
                                        </div>
                                    </div>
                                    <div id="privacyStatus" class="mt-2 small text-success fw-bold">Status: Sensor Aktif (Aman)</div>
                                </div>
                            </div>

                        </div>
                        
                        <footer class="main-footer">
                            <div class="container">
                                <h5 class="footer-brand">SISTEM MANAJEMEN & PEMETAAN DATA PEMBERDAYAAN NELAYAN TANGKAP</h5>
                                <div class="footer-text">
                                    &copy; 2025 Bidang Pemberdayaan Nelayan <span class="footer-divider">|</span> Dinas Perikanan Kabupaten Situbondo
                                </div>
                                <div class="footer-links">
                                    <a href="#" style="pointer-events: none;">
                                        <i class="fas fa-phone-alt me-1"></i> Contact Center: 0878-6561-4222
                                    </a>
                                    <span class="footer-divider">|</span>
                                    <a href="mailto:info@dinasperikanansitubondo.com">
                                        <i class="fas fa-envelope me-1"></i> info@dinasperikanansitubondo.com
                                    </a>
                                </div>
                            </div>
                        </footer>

                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal fade" id="detailModal" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg">
                    <div class="modal-header modal-header-custom">
                        <h5 class="modal-title fw-bold"><i class="fas fa-id-card me-2"></i>DETAIL LENGKAP NELAYAN</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4 bg-light">
                        <div class="card border-0 shadow-sm mb-3">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 border-end">
                                        <h6 class="text-primary fw-bold mb-3">IDENTITAS PRIBADI</h6>
                                        <div class="detail-label">Nama Lengkap</div>
                                        <div class="detail-value" id="d_nama">-</div>
                                        <div class="detail-label">NIK (Nomori Induk Kependudukan)</div>
                                        <div class="detail-value font-monospace" id="d_nik">  </div>
                                        <div class="detail-label">Usia / Tahun Lahir</div>
                                        <div class="detail-value" id="d_usia">-</div>
                                        <div class="detail-label">Kontak (WhatsApp/Telp)</div>
                                        <div class="detail-value font-monospace" id="d_wa">-</div>
                                        <div class="detail-label">Domisili</div>
                                        <div class="detail-value" id="d_domisili">-</div>
                                    </div>
                                    <div class="col-md-6 ps-md-4 mt-3 mt-md-0">
                                        <h6 class="text-primary fw-bold mb-3">PROFESI & KEPEMILIKAN</h6>
                                        <div class="detail-label">Profesi</div>
                                        <div class="detail-value"><span id="d_profesi" class="badge bg-primary"></span></div>
                                        <div class="detail-label">Status</div>
                                        <div class="detail-value" id="d_status">-</div>
                                        <div class="detail-label">Alat Penangkapan Ikan (API)</div>
                                        <div class="detail-value" id="d_alatTangkap">-</div>
                                        <div class="detail-label">Usaha Sampingan</div>
                                        <div class="detail-value" id="d_usaha">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card border-0 shadow-sm mb-3" id="d_kapal_card" style="display:none;">
                            <div class="card-body bg-white border-left border-4 border-info">
                                <h6 class="text-info fw-bold mb-3"><i class="fas fa-ship me-2"></i>DATA KAPAL DIMILIKI</h6>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="detail-label">Nama Kapal</div>
                                        <div class="fw-bold" id="d_namaKapal">.</div>
                                    </div>
                                    <div class="col-6">
                                        <div class="detail-label">Jenis Kapal</div>
                                        <div class="fw-bold"><span id="d_jenisKapal"> -</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card border-0 shadow-sm mb-3">
                            <div class="card-body bg-white border-left border-4 border-success">
                                <h6 class="text-success fw-bold mb-3"><i class="fas fa-fish me-2"></i>JENIS IKAN TANGKAPAN</h6>
                                <div id="d_ikan"></div>
                            </div>
                        </div>

                        <div class="text-end text-muted small fst-italic">
                            Terakhir divalidasi: <span id="d_tgl_valid">-</span> oleh <span id="d_validator">-</span>
                        </div>
                    </div>
                    <div class="modal-footer bg-white">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                        <button type="button" class="btn btn-danger" id="btnDownloadDetailPdf"><i class="fas fa-file-pdf me-2"></i>UNDUH DOKUMEN (PDF)</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Info Jenis Ikan -->
        <div class="modal fade" id="fishInfoModal" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title fw-bold"><i class="fas fa-fish me-2"></i>Referensi Jenis Ikan Tangkapan</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Berikut adalah referensi visual jenis ikan tangkapan yang umum ditemukan di perairan Situbondo.
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <h6 class="fw-bold text-primary">Gambar Referensi 1</h6>
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simata/info%20jenis%20ikan%20tangkapan%201.jpg" 
                                     alt="Referensi Jenis Ikan 1" class="fish-modal-img img-fluid">
                                <p class="small text-muted mt-2">Ilustrasi berbagai jenis ikan tangkapan yang umum ditemui.</p>
                            </div>
                            <div class="col-md-12 mb-4">
                                <h6 class="fw-bold text-primary">Gambar Referensi 2</h6>
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simata/info%20jenis%20ikan%20tangkapan%202.jpg" 
                                     alt="Referensi Jenis Ikan 2" class="fish-modal-img img-fluid">
                                <p class="small text-muted mt-2">Klasifikasi dan ciri-ciri ikan tangkapan utama.</p>
                            </div>
                            <div class="col-md-12">
                                <h6 class="fw-bold text-primary">Gambar Referensi 3</h6>
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simata/info%20jenis%20ikan%20tangkapan%203.jpg" 
                                     alt="Referensi Jenis Ikan 3" class="fish-modal-img img-fluid">
                                <p class="small text-muted mt-2">Panduan identifikasi ikan tangkapan berdasarkan alat tangkap.</p>
                            </div>
                        </div>
                        
                        <div class="alert alert-warning mt-4">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>Tips:</strong> Gunakan referensi ini untuk memastikan ketepatan pemilihan jenis ikan tangkapan utama dalam pendataan nelayan.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="document.getElementById('v-pills-input-tab').click(); window.scrollTo(0, 0);">
                            <i class="fas fa-plus me-2"></i>Input Data Nelayan
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="fab-container" id="fabMenu">
            <button class="fab-main" id="fabMainBtn"><i class="fas fa-plus"></i></button>
            <a href="#" class="fab-item" id="fabInput" title="Input Data"><i class="fas fa-pencil-alt"></i></a>
            <a href="#" class="fab-item" id="fabFilter" title="Filter"><i class="fas fa-filter"></i></a>
            <a href="#" class="fab-item" id="fabVerify" title="Verifikasi"><i class="fas fa-check-circle"></i></a>
            <a href="#" class="fab-item" id="fabExport" title="Ekspor"><i class="fas fa-file-export"></i></a>
            <a href="#" class="fab-item" id="fabBackup" title="Backup"><i class="fas fa-cloud-download-alt"></i></a>
            <a href="#" class="fab-item" id="fabSettings" title="Pengaturan"><i class="fas fa-cog"></i></a>
            <a href="#" class="fab-item" id="fabReload" title="Reload Repo"><i class="fas fa-sync"></i></a>
        </div>
        
        <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
            <div class="toast notification-toast" role="alert">
                <div class="toast-header">
                    <strong class="me-auto" id="toastTitle">Notifikasi</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body" id="toastMessage"></div>
            </div>
        </div>
    </div>

   <!-- Loading untuk ID Card -->
<div class="idcard-loading" id="idcardLoading">
    <div class="idcard-loading-content">
        <div class="spinner-border text-primary mb-3" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <h6>Membuat ID Card...</h6>
        <p class="small text-muted">Harap tunggu sebentar</p>
    </div>
</div>

</body>
</html>
