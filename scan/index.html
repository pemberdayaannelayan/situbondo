<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR Sederhana - Tanpa API Key</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 20px; text-align: center; }
        .upload-area { border: 2px dashed #4CAF50; padding: 30px; text-align: center; margin: 20px 0; border-radius: 10px; cursor: pointer; }
        button { background: #4CAF50; color: white; border: none; padding: 12px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; margin: 5px; width: 100%; }
        #result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; min-height: 200px; white-space: pre-wrap; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± OCR Mobile Tanpa API Key</h1>
        
        <div class="upload-area" id="dropArea">
            <p>üì∏ <strong>Ambil foto atau pilih gambar</strong></p>
            <p>Format: JPG, PNG (Maks 5MB)</p>
            <input type="file" id="fileInput" accept="image/*" capture="environment" style="display: none;">
        </div>
        
        <button onclick="document.getElementById('fileInput').click()">Pilih Gambar</button>
        <button onclick="takePhoto()">Ambil Foto</button>
        <button onclick="processImage()" id="processBtn" class="hidden">Proses OCR</button>
        
        <div id="preview" class="hidden" style="margin: 20px 0; text-align: center;">
            <img id="previewImg" style="max-width: 100%; max-height: 300px;">
        </div>
        
        <div id="result"></div>
        
        <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 5px;">
            <h3>‚úÖ Kelebihan Aplikasi Ini:</h3>
            <ul>
                <li>Tidak perlu API key</li>
                <li>Tidak perlu internet (setelah pertama kali)</li>
                <li>Gambar tidak dikirim ke server mana pun</li>
                <li>Privasi terjamin</li>
            </ul>
        </div>
    </div>

    <!-- Load Tesseract.js from CDN -->
    <script src="https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
    
    <script>
        let selectedImage = null;
        
        // Setup file input
        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                loadImage(e.target.files[0]);
            }
        });
        
        // Setup drag and drop
        document.getElementById('dropArea').addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });
        
        function takePhoto() {
            // Create a temporary file input with camera capture
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.capture = 'environment'; // Use back camera
            
            input.onchange = function(e) {
                if (e.target.files[0]) {
                    loadImage(e.target.files[0]);
                }
            };
            
            input.click();
        }
        
        function loadImage(file) {
            if (!file.type.match('image.*')) {
                alert('Hanya file gambar yang diizinkan');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('Ukuran file maksimal 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                selectedImage = e.target.result;
                
                // Show preview
                document.getElementById('previewImg').src = selectedImage;
                document.getElementById('preview').classList.remove('hidden');
                document.getElementById('processBtn').classList.remove('hidden');
                
                // Scroll to process button
                document.getElementById('processBtn').scrollIntoView({behavior: 'smooth'});
            };
            reader.readAsDataURL(file);
        }
        
        async function processImage() {
            if (!selectedImage) {
                alert('Pilih gambar terlebih dahulu');
                return;
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>üîÑ Memproses gambar... Mohon tunggu...</p>';
            
            try {
                // Initialize Tesseract
                const worker = await Tesseract.createWorker({
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            resultDiv.innerHTML = `<p>üîç Mengenali teks... ${Math.round(m.progress * 100)}%</p>`;
                        }
                    }
                });
                
                // Use Indonesian language (you can change to 'eng' for English)
                await worker.loadLanguage('ind+eng');
                await worker.initialize('ind+eng');
                
                // Perform OCR
                const { data: { text } } = await worker.recognize(selectedImage);
                
                // Display result
                resultDiv.innerHTML = `
                    <h3>‚úÖ Hasil OCR:</h3>
                    <div style="background: #f9f9f9; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        ${text || 'Tidak ada teks yang terdeteksi'}
                    </div>
                    <button onclick="copyText()" style="margin-top: 10px; background: #2196F3;">üìã Salin Teks</button>
                `;
                
                // Store text for copying
                window.lastOCRText = text;
                
                await worker.terminate();
                
            } catch (error) {
                console.error('OCR Error:', error);
                resultDiv.innerHTML = '<p style="color: red;">‚ùå Error: Gagal memproses gambar. Coba gambar lain.</p>';
            }
        }
        
        function copyText() {
            if (window.lastOCRText) {
                navigator.clipboard.writeText(window.lastOCRText)
                    .then(() => alert('Teks berhasil disalin!'))
                    .catch(err => {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = window.lastOCRText;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('Teks berhasil disalin!');
                    });
            }
        }
        
        // Inform user about first load
        window.onload = function() {
            if (!localStorage.getItem('ocrFirstLoad')) {
                alert('Info: Aplikasi ini akan mengunduh library OCR saat pertama kali digunakan (sekitar 5MB). Setelah itu bisa digunakan offline.');
                localStorage.setItem('ocrFirstLoad', 'true');
            }
        };
    </script>
</body>
</html>
