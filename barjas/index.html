<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEM BANTUAN NELAYAN - KAB. SITUBONDO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            /* Palette: Luxurious Green, Blue, Orange */
            --primary-color: #005f73; /* Deep Teal Blue */
            --secondary-color: #0a9396; /* Emerald Green */
            --accent-color: #ca6702; /* Burnt Orange/Gold */
            
            --dark-blue: #001219;
            --light-bg: #f0f4f8;
            
            /* Luxurious Gradients */
            --gradient-primary: linear-gradient(135deg, #001219 0%, #005f73 50%, #0a9396 100%);
            --gradient-header: linear-gradient(120deg, #003049 0%, #005f73 40%, #0a9396 70%, #ca6702 100%);
            --gradient-secondary: linear-gradient(135deg, #0a9396, #94d2bd);
            --gradient-accent: linear-gradient(135deg, #ca6702, #ee9b00);
            
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.05);
            --shadow-md: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 25px rgba(0,0,0,0.15);
            
            --glass-effect: rgba(255, 255, 255, 0.95);
        }
        
        body {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            padding: 20px 0;
            overflow-x: hidden;
            color: #333;
        }
        
        /* Layout Container */
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--glass-effect);
            box-shadow: var(--shadow-lg);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            z-index: 10;
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        /* Header - New Luxurious Style */
        .app-header {
            background: var(--gradient-header);
            color: white;
            padding: 35px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid #ee9b00; /* Gold Line */
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.3;
        }
        
        .app-logo {
            font-size: 3.5rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .app-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.4;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
        }
        
        .app-subtitle {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 500;
            letter-spacing: 0.5px;
            margin-top: 10px;
            color: #ffecd1; /* Soft Cream */
            border-top: 1px solid rgba(255,255,255,0.2);
            display: inline-block;
            padding-top: 10px;
        }
        
        /* Navigation */
        .col-md-3.col-lg-2.bg-light {
            background-color: #f8f9fa !important;
            border-right: 1px solid #e9ecef;
        }

        .nav-pills .nav-link {
            border-radius: 10px;
            margin-bottom: 8px;
            padding: 14px 20px;
            font-weight: 600;
            color: #555;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.95rem;
            border-left: 4px solid transparent;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #e3f2fd;
            color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .nav-pills .nav-link.active {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-left: 4px solid #ee9b00;
            box-shadow: var(--shadow-md);
            transform: translateX(5px);
            color: white;
        }

        /* Content Styling */
        .section-title {
            font-family: 'Montserrat', sans-serif;
            border-left: 5px solid #ee9b00;
            padding-left: 15px;
            margin: 25px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.6rem;
            position: relative;
            background: linear-gradient(to right, rgba(238, 155, 0, 0.1), transparent);
            padding-top: 5px;
            padding-bottom: 5px;
            border-radius: 0 8px 8px 0;
        }
        
        /* Buttons */
        .btn {
            border-radius: 8px;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: 0.5px;
            padding: 10px 20px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            box-shadow: 0 4px 6px rgba(0, 95, 115, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #001219 0%, #004d40 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 95, 115, 0.4);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            color: white;
            border: none;
        }

        /* Forms */
        .form-label {
            font-weight: 600;
            color: #2b2d42;
            font-size: 0.9rem;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ced4da;
            font-size: 0.95rem;
            background-color: #fdfdfd;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(10, 147, 150, 0.2);
            background-color: white;
        }
        
        /* Tables */
        .data-table {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: none;
            white-space: nowrap;
        }
        
        .data-table th {
            background: var(--primary-color) !important; 
            background: linear-gradient(90deg, #005f73, #0a9396) !important;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            padding: 15px 10px;
            border: none;
        }
        
        .data-table td {
            border-bottom: 1px solid #e9ecef;
            padding: 12px 10px;
            font-size: 0.9rem;
        }

        .data-table tr:hover {
            background-color: #e0f2f1;
        }
        
        /* Cards & Stats */
        .card {
            border-radius: 15px;
            border: none;
            box-shadow: var(--shadow-sm);
            background: white;
        }
        
        .card-header {
            background: linear-gradient(90deg, #005f73, #001219);
            color: white;
            font-weight: 600;
            border-radius: 15px 15px 0 0 !important;
            padding: 15px 20px;
        }
        
        .stats-box {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-md);
            border-left: 5px solid var(--accent-color);
            transition: transform 0.3s;
        }
        
        .stats-box:hover {
            transform: translateY(-5px);
        }

        .stats-number {
            color: var(--primary-color);
            font-family: 'Montserrat', sans-serif;
        }
        
        /* Login Modal - Luxurious */
        .login-header {
            background: var(--gradient-header);
            border-bottom: 4px solid #ee9b00;
            padding-bottom: 20px;
            padding-top: 20px;
        }
        
        .login-header .fa-ship {
            padding: 10px;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .btn-login {
            background: linear-gradient(90deg, #005f73, #0a9396, #ee9b00);
            background-size: 200% auto;
            transition: 0.5s;
        }
        
        .btn-login:hover {
            background-position: right center;
        }

        /* Footer */
        .copyright {
            background-color: #f8f9fa;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
            font-size: 0.85rem;
        }
        
        .feature-icon {
            width: 25px;
            text-align: center;
        }

        /* Utils */
        .notification-toast { position: fixed; bottom: 20px; right: 20px; z-index: 1050; min-width: 280px; }
        .input-error { border-color: #dc3545 !important; box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2) !important; }
        .error-message { color: #dc3545; font-size: 0.8rem; margin-top: 5px; display: none; font-weight: 500; }
        .watermark { position: absolute; bottom: 10px; right: 15px; opacity: 0.8; font-size: 0.8rem; color: rgba(255,255,255,0.7); font-weight: 300; letter-spacing: 1px;}
        
        /* Floating Buttons & Smart Menu */
        @keyframes signal-pulse {
            0% { box-shadow: 0 0 0 0 rgba(238, 155, 0, 0.7), 0 0 0 0 rgba(10, 147, 150, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(238, 155, 0, 0), 0 0 0 30px rgba(10, 147, 150, 0); }
            100% { box-shadow: 0 0 0 0 rgba(238, 155, 0, 0), 0 0 0 0 rgba(10, 147, 150, 0); }
        }

        .fab-common {
            position: fixed;
            right: 25px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            z-index: 1045;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.4rem;
            border: none;
        }

        .floating-action-btn {
            bottom: 25px;
            background: var(--gradient-accent);
            animation: signal-pulse 2.5s infinite;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background: #ee9b00;
            box-shadow: 0 10px 20px rgba(238, 155, 0, 0.4);
        }

        .smart-menu-container {
            position: fixed;
            bottom: 100px;
            right: 25px;
            z-index: 1045;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 15px;
        }

        .smart-menu-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
             box-shadow: 0 5px 15px rgba(0, 95, 115, 0.4);
        }

        .smart-menu-toggle:hover {
            transform: scale(1.1);
            background: #0a9396;
        }

        .smart-menu-toggle.active {
            transform: rotate(45deg);
            background: #dc3545;
            box-shadow: 0 0 20px rgba(220, 53, 69, 0.6);
        }

        .smart-menu-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            opacity: 0;
            transform: translateY(20px) scale(0.5);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
            position: relative;
            box-shadow: var(--shadow-sm);
        }

        .smart-menu-container.active .smart-menu-item {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .smart-menu-item:hover {
            background: var(--primary-color);
            color: white;
            border-color: white;
            transform: scale(1.1);
        }

        .smart-menu-tooltip {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%) translateX(20px);
            background: rgba(0, 18, 25, 0.9);
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.3s;
            pointer-events: none;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.2);
            visibility: hidden;
        }

        .smart-menu-item:hover .smart-menu-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(0);
        }

        .smart-menu-container.active .smart-menu-item:nth-child(2) { transition-delay: 0.05s; }
        .smart-menu-container.active .smart-menu-item:nth-child(3) { transition-delay: 0.1s; }
        .smart-menu-container.active .smart-menu-item:nth-child(4) { transition-delay: 0.15s; }
        .smart-menu-container.active .smart-menu-item:nth-child(5) { transition-delay: 0.2s; }
        .smart-menu-container.active .smart-menu-item:nth-child(6) { transition-delay: 0.25s; }
        .smart-menu-container.active .smart-menu-item:nth-child(7) { transition-delay: 0.3s; }
        .smart-menu-container.active .smart-menu-item:nth-child(8) { transition-delay: 0.35s; }
        .smart-menu-container.active .smart-menu-item:nth-child(9) { transition-delay: 0.4s; }
        .smart-menu-container.active .smart-menu-item:nth-child(10) { transition-delay: 0.45s; }
        
        .mobile-menu-btn { display: none; position: fixed; top: 15px; left: 15px; z-index: 1050; background: var(--primary-color); color: white; border: none; border-radius: 50%; width: 45px; height: 45px; box-shadow: var(--shadow-lg); }
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1040; }
        
        .privacy-blurred {
            color: #6c757d;
            letter-spacing: 2px;
            font-weight: bold;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
        
        @media (max-width: 991.98px) {
            .app-container { margin: 0; border-radius: 0; }
            .col-md-3.col-lg-2 { position: fixed; left: -300px; top: 0; bottom: 0; z-index: 1050; width: 280px; transition: left 0.3s ease; overflow-y: auto; padding-top: 60px; background: white; }
            .col-md-3.col-lg-2.mobile-show { left: 0; }
            .col-md-9.col-lg-10 { width: 100%; flex: 0 0 100%; max-width: 100%; }
            .mobile-menu-btn { display: flex; align-items: center; justify-content: center; }
            .sidebar-overlay.mobile-show { display: block; }
            .app-title { font-size: 1.1rem; line-height: 1.2; }
            .app-logo { font-size: 2rem; margin-bottom: 5px; }
            .app-header { padding: 60px 15px 25px 15px; }
            .col-md-9.col-lg-10.p-5 { padding: 1.5rem !important; }
            .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .smart-menu-container { bottom: 100px; right: 20px; }
            .floating-action-btn { bottom: 20px; right: 20px; }
        }

        @media print {
            @page { size: landscape; margin: 0.5cm; }
            body * { visibility: hidden; }
            .app-container, .app-container * { visibility: visible; }
            .app-container { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none; border: none; }
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn, .smart-menu-container, .btn-group, .filter-section, .toast, .col-md-3.col-lg-2 { display: none !important; }
            .col-md-9.col-lg-10 { width: 100%; flex: 0 0 100%; max-width: 100%; padding: 0 !important; }
            .data-table th:last-child, .data-table td:last-child { display: none !important; }
            .print-header { display: block !important; text-align: center; margin-bottom: 15px; }
        }

        .whatsapp-link { color: #25D366; text-decoration: none; }
        .whatsapp-number { color: #25D366; cursor: pointer; text-decoration: underline; font-weight: 500;}
        .drive-link { color: var(--primary-color); font-weight: 600; text-decoration: none; }
        .login-shake { animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes login-shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); } 20%, 40%, 60%, 80% { transform: translateX(10px); } }
        .spinner-border-sm { width: 1rem; height: 1rem; }
        #login-particles { display: none; }
        .app-content-unauthenticated { display: none; }
        .btn-not-group { background: #6c757d; color: white; border: none; }
        .whatsapp-input-container { position: relative; }
        .whatsapp-prefix { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #6c757d; font-weight: 500; }
        .whatsapp-input { padding-left: 45px !important; }
        .preview-container { max-height: 70vh; overflow-y: auto; padding: 15px; background-color: #f9f9f9; }
        .preview-table { width: 100%; border-collapse: collapse; }
        .preview-table th, .preview-table td { padding: 8px; border: 1px solid #ddd; }
        .preview-table th { background-color: #f0f0f0; }
        
        /* New Info Style */
        .info-pill {
            background: rgba(0, 95, 115, 0.05);
            border: 1px dashed var(--primary-color);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        /* Modal Detail Data */
        .detail-modal-label {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .detail-modal-value {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 3px solid var(--secondary-color);
            margin-bottom: 15px;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .detail-col {
            flex: 1;
            padding: 0 10px;
        }

        /* Welcome Modal */
        .welcome-modal {
            background: linear-gradient(135deg, #001219 0%, #005f73 50%, #0a9396 100%);
            color: white;
        }
        
        .welcome-modal .modal-content {
            border-radius: 20px;
            overflow: hidden;
            border: 3px solid #ee9b00;
        }
        
        .welcome-modal .btn-welcome {
            background: linear-gradient(90deg, #ee9b00, #ca6702);
            color: white;
            font-weight: bold;
            padding: 12px 30px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            margin-top: 20px;
        }
        
        .welcome-modal .btn-welcome:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(238, 155, 0, 0.3);
        }

        /* Logo Garuda */
        .logo-garuda {
            width: 80px;
            height: 80px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .logo-garuda-sm {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        /* Filter Container */
        .filter-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--secondary-color);
        }
    </style>
</head>
<body>
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 20px; overflow: hidden; border: none;">
                <div class="login-header">
                    <div class="text-center mb-2">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/garuda.png" 
                             alt="Logo Garuda" class="logo-garuda">
                    </div>
                    <h2 class="text-center text-white fw-bold mb-0" style="font-family: 'Montserrat'; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">AUTHENTICATION</h2>
                    <p class="text-center text-white-50 mb-0 small">Sistem Bantuan Nelayan Kab. Situbondo</p>
                </div>
                <div class="login-body p-4">
                    <form id="loginForm">
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-key me-2 text-primary"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="securityCode" placeholder="Masukkan kode akses..." style="padding: 12px;">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger mt-2 fw-bold text-center" id="attemptsCount" style="display:none;"></div>
                            
                            <div class="info-pill mt-4">
                                <div class="small text-uppercase fw-bold text-primary mb-1" style="font-size: 0.7rem; letter-spacing: 1px;">
                                    <i class="fas fa-shield-alt me-1"></i> System Information
                                </div>
                                <div class="fw-bold text-dark" style="font-size: 0.9rem;">
                                    BIDANG PEMBERDAYAAN NELAYAN
                                </div>
                            </div>
                        </div>
                        
                        <div class="row g-2 mb-4">
                            <div class="col-12">
                                <button type="submit" class="btn btn-login text-white w-100 py-3 fw-bold shadow-sm" id="loginButton">
                                    <span class="login-button-text">MASUK SISTEM</span>
                                    <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="login-blocked-message d-none mt-3 p-3 rounded bg-danger bg-opacity-10 text-danger text-center" id="blockedMessage">
                            <i class="fas fa-ban me-2"></i>
                            <span id="blockedText">Akses diblokir sementara. </span>
                            <span class="fw-bold" id="countdown">30</span> detik.
                        </div>
                        
                        <div class="text-center mt-4 small text-muted">
                            &copy; 2025 Dinas Peternakan dan Perikanan
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Welcome Modal -->
    <div class="modal fade welcome-modal" id="welcomeModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-5">
                    <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/garuda.png" 
                         alt="Logo Garuda" class="logo-garuda mb-4">
                    <h3 class="fw-bold mb-3">Selamat Datang!</h3>
                    <p id="welcomeMessage">Selamat datang di Sistem Bantuan Nelayan Kabupaten Situbondo.</p>
                    
                    <div class="alert alert-warning mt-4" id="reloadAlert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Penting:</strong> Sebaiknya lakukan reload data terlebih dahulu untuk memastikan data terkini.
                    </div>
                    
                    <button type="button" class="btn btn-welcome w-100" id="welcomeReloadBtn">
                        <i class="fas fa-sync-alt me-2"></i> RELOAD DATA SEKARANG
                    </button>
                    
                    <button type="button" class="btn btn-outline-light w-100 mt-3" id="skipReloadBtn">
                        <i class="fas fa-forward me-2"></i> LEWATI DAN LANJUTKAN
                    </button>
                    
                    <div class="mt-4 small text-white-50">
                        <i class="fas fa-info-circle me-1"></i>
                        Tekan tombol di atas untuk memulai
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="app-content-unauthenticated" id="appContent">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/garuda.png" 
                         alt="Logo Garuda" class="logo-garuda">
                </div>
                <h1 class="app-title">SISTEM APLIKASI BANTUAN BARANG PINJAM PAKAI<br>BIDANG PEMBERDAYAAN NELAYAN</h1>
                <p class="app-subtitle">Dinas Peternakan dan Perikanan Kabupaten Situbondo</p>
                <div class="watermark">Professional Edition v2.1</div>
            </div>
            
            <div class="row g-0">
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebarMenu">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dashboard" type="button" role="tab">
                            <i class="fas fa-tachometer-alt feature-icon"></i> Dashboard
                        </button>
                        <button class="nav-link" id="v-pills-input-tab" data-bs-toggle="pill" data-bs-target="#v-pills-input" type="button" role="tab">
                            <i class="fas fa-pencil-alt feature-icon"></i> Input Data
                        </button>
                        <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button" role="tab">
                            <i class="fas fa-database feature-icon"></i> Data Bantuan
                        </button>
                        <button class="nav-link" id="v-pills-filter-tab" data-bs-toggle="pill" data-bs-target="#v-pills-filter" type="button" role="tab">
                            <i class="fas fa-filter feature-icon"></i> Filter Data
                        </button>
                        <button class="nav-link" id="v-pills-print-tab" data-bs-toggle="pill" data-bs-target="#v-pills-print" type="button" role="tab">
                            <i class="fas fa-print feature-icon"></i> Cetak Laporan
                        </button>
                        <button class="nav-link" id="v-pills-export-tab" data-bs-toggle="pill" data-bs-target="#v-pills-export" type="button" role="tab">
                            <i class="fas fa-file-export feature-icon"></i> Ekspor Data
                        </button>
                        <button class="nav-link" id="v-pills-backup-tab" data-bs-toggle="pill" data-bs-target="#v-pills-backup" type="button" role="tab">
                            <i class="fas fa-download feature-icon"></i> Backup & Restore
                        </button>
                        <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab">
                            <i class="fas fa-cog feature-icon"></i> Pengaturan
                        </button>
                        <button class="nav-link" id="btn-reload-repo" type="button">
                            <i class="fas fa-sync-alt feature-icon"></i> Reload Data
                        </button>
                        <button class="nav-link text-danger mt-3" id="v-pills-logout-tab" type="button" style="border: 1px solid #dc3545;">
                            <i class="fas fa-sign-out-alt feature-icon"></i> Keluar
                        </button>
                    </div>
                </div>
                
                <div class="col-md-9 col-lg-10 p-5">
                    <div class="tab-content" id="v-pills-tabContent">
                        
                        <div class="tab-pane fade show active" id="v-pills-dashboard" role="tabpanel">
                            <h3 class="section-title">Dashboard Overview</h3>
                            <div class="row">
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="stats-box p-4">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div class="stats-label text-muted">Total Penerima</div>
                                            <i class="fas fa-users fa-2x text-primary opacity-50"></i>
                                        </div>
                                        <div class="stats-number h2 fw-bold" id="totalPenerima">0</div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="stats-box p-4" style="border-left-color: var(--secondary-color);">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div class="stats-label text-muted">Total Bantuan (Rp)</div>
                                            <i class="fas fa-money-bill-wave fa-2x text-success opacity-50"></i>
                                        </div>
                                        <div class="stats-number h2 fw-bold text-success" id="totalBantuan">0</div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="stats-box p-4" style="border-left-color: #ffc107;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div class="stats-label text-muted">Tahun Aktif</div>
                                            <i class="fas fa-calendar-alt fa-2x text-warning opacity-50"></i>
                                        </div>
                                        <div class="stats-number h2 fw-bold text-warning" id="tahunAktif">2025</div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="stats-box p-4" style="border-left-color: #17a2b8;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div class="stats-label text-muted">Rata-rata</div>
                                            <i class="fas fa-chart-line fa-2x text-info opacity-50"></i>
                                        </div>
                                        <div class="stats-number h2 fw-bold text-info" id="rataBantuan">0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header"><i class="fas fa-chart-pie me-2"></i> Distribusi per Kecamatan</div>
                                        <div class="card-body"><canvas id="kecamatanChart" height="250"></canvas></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header"><i class="fas fa-chart-bar me-2"></i> Tren Bantuan Tahunan</div>
                                        <div class="card-body"><canvas id="tahunChart" height="250"></canvas></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header"><i class="fas fa-history me-2"></i> Transaksi Terbaru</div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table mb-0">
                                                    <thead><tr><th>Tanggal</th><th>Nama Penerima</th><th>Desa</th><th>Jenis Bantuan</th><th>Jumlah</th></tr></thead>
                                                    <tbody id="recentData"><tr><td colspan="5" class="text-center p-4">Tidak ada data</td></tr></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-input" role="tabpanel">
                            <h3 class="section-title">Input Data Bantuan</h3>
                            <div class="card">
                                <div class="card-header"><i class="fas fa-pencil-alt me-2"></i> Formulir Input Data</div>
                                <div class="card-body p-4">
                                    <form id="inputForm" novalidate>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="nama" class="form-label"><i class="fas fa-user text-primary me-2"></i> Nama Penerima</label>
                                                <input type="text" class="form-control" id="nama" required>
                                                <div class="error-message" id="namaError">Nama penerima wajib diisi.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="nik" class="form-label"><i class="fas fa-id-card text-primary me-2"></i> NIK</label>
                                                <input type="text" class="form-control" id="nik" required maxlength="16">
                                                <div class="error-message" id="nikError">NIK wajib diisi dan harus 16 digit angka.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="whatsapp" class="form-label"><i class="fab fa-whatsapp text-success me-2"></i> Nomor WhatsApp</label>
                                                <div class="whatsapp-input-container">
                                                    <span class="whatsapp-prefix">+62</span>
                                                    <input type="tel" class="form-control whatsapp-input" id="whatsapp" placeholder="8xx-xxxx-xxxx" required>
                                                </div>
                                                <div class="error-message" id="whatsappError">Nomor WhatsApp wajib diisi.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="namaKelompok" class="form-label"><i class="fas fa-users text-primary me-2"></i> Nama Kelompok</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="namaKelompok" placeholder="Opsional">
                                                    <button type="button" class="btn btn-not-group" id="btnBukanKelompok">Individu</button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="jabatan" class="form-label"><i class="fas fa-user-tag text-primary me-2"></i> Jabatan</label>
                                                <select class="form-select" id="jabatan">
                                                    <option value="Individu" selected>Individu</option>
                                                    <option value="Ketua Kelompok">Ketua Kelompok</option>
                                                    <option value="Sekretaris">Sekretaris</option>
                                                    <option value="Bendahara">Bendahara</option>
                                                    <option value="Pengawas">Pengawas</option>
                                                    <option value="Anggota">Anggota</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="tahunAnggaran" class="form-label"><i class="fas fa-calendar text-primary me-2"></i> Tahun Anggaran</label>
                                                <select class="form-select" id="tahunAnggaran"></select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="kecamatan" class="form-label"><i class="fas fa-map-marker-alt text-primary me-2"></i> Kecamatan</label>
                                                <select class="form-select" id="kecamatan" required>
                                                    <option value="">Pilih Kecamatan</option>
                                                </select>
                                                <div class="error-message" id="kecamatanError">Kecamatan wajib dipilih.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="desa" class="form-label"><i class="fas fa-map-marked-alt text-primary me-2"></i> Desa</label>
                                                <select class="form-select" id="desa" required>
                                                    <option value="">Pilih Desa</option>
                                                </select>
                                                <div class="error-message" id="desaError">Desa wajib dipilih.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="alamat" class="form-label"><i class="fas fa-home text-primary me-2"></i> Alamat Lengkap</label>
                                                <textarea class="form-control" id="alamat" rows="1"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jenisBantuan" class="form-label"><i class="fas fa-gift text-primary me-2"></i> Jenis Bantuan</label>
                                                <select class="form-select" id="jenisBantuan">
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="namaBantuan" class="form-label"><i class="fas fa-box-open text-primary me-2"></i> Nama Bantuan</label>
                                                <input type="text" class="form-control" id="namaBantuan" placeholder="Contoh: Mesin Perahu, Uang Tunai, Jaring" required>
                                                <div class="error-message" id="namaBantuanError">Nama bantuan wajib diisi.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jumlahBantuan" class="form-label"><i class="fas fa-coins text-primary me-2"></i> Jumlah Bantuan</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="jumlahBantuan" placeholder="Jumlah" required>
                                                    <select class="form-select" id="satuanBantuan" style="max-width: 120px;">
                                                        <option value="Rupiah">Rupiah</option>
                                                        <option value="Unit">Unit</option>
                                                        <option value="Paket">Paket</option>
                                                    </select>
                                                </div>
                                                <div class="error-message" id="jumlahBantuanError">Jumlah bantuan wajib diisi.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="tanggalTerima" class="form-label"><i class="fas fa-calendar-check text-primary me-2"></i> Tanggal Menerima</label>
                                                <input type="date" class="form-control" id="tanggalTerima" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="namaPetugas" class="form-label"><i class="fas fa-user-tie text-primary me-2"></i> Nama Petugas</label>
                                                <input type="text" class="form-control" id="namaPetugas" required>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="driveLink" class="form-label"><i class="fab fa-google-drive text-primary me-2"></i> Link Google Drive</label>
                                                <input type="url" class="form-control" id="driveLink" placeholder="https://drive.google.com/...">
                                                <div class="error-message" id="driveLinkError">Format URL tidak valid.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="kodeValidasi" class="form-label"><i class="fas fa-qrcode text-primary me-2"></i> Kode Validasi</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="kodeValidasi" placeholder="Klik Generate" readonly required>
                                                    <button type="button" class="btn btn-primary" id="generateKodeBtn">Generate</button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="keterangan" class="form-label"><i class="fas fa-sticky-note text-primary me-2"></i> Keterangan</label>
                                            <textarea class="form-control" id="keterangan" rows="2"></textarea>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end mt-4 pt-3 border-top">
                                            <button type="reset" class="btn btn-light me-2 text-secondary">
                                                <i class="fas fa-undo me-1"></i> Reset
                                            </button>
                                            <button type="submit" class="btn btn-primary px-4">
                                                <i class="fas fa-save me-1"></i> Simpan Data
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-data" role="tabpanel">
                            <h3 class="section-title">Database Bantuan</h3>
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
                                    <span><i class="fas fa-database me-2"></i> Daftar Penerima</span>
                                    <div class="d-flex flex-wrap gap-2 mt-2 mt-md-0">
                                        <select class="form-select form-select-sm" id="filterKecamatanData" style="width: auto;">
                                            <option value="">Semua Kecamatan</option>
                                        </select>
                                        <select class="form-select form-select-sm" id="filterDesaData" style="width: auto;">
                                            <option value="">Semua Desa</option>
                                        </select>
                                        <div class="input-group" style="max-width: 300px;">
                                            <input type="text" class="form-control form-control-sm" id="searchData" placeholder="Cari data...">
                                            <button class="btn btn-sm btn-light border" id="clearSearchBtn"><i class="fas fa-times"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table mb-0" id="dataTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th><th>Nama</th><th>NIK</th><th>WhatsApp</th><th>Kelompok</th>
                                                    <th>Jabatan</th><th>Tahun</th><th>Kecamatan</th><th>Desa</th><th>Jenis</th>
                                                    <th>Bantuan</th><th>Jumlah</th><th>Tanggal</th><th>Petugas</th><th>Dokumen</th>
                                                    <th>Validasi</th><th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dataTableBody">
                                                <tr><td colspan="17" class="text-center py-4">Memuat data...</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center p-3 border-top bg-light">
                                        <div class="text-muted small" id="tableInfo">Menampilkan 0 data</div>
                                        <nav><ul class="pagination pagination-sm mb-0" id="pagination"></ul></nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-filter" role="tabpanel">
                            <h3 class="section-title">Filter Lanjutan</h3>
                            <div class="card mb-4">
                                <div class="card-header"><i class="fas fa-filter me-2"></i> Parameter Filter</div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label class="form-label">Tahun</label>
                                            <select class="form-select" id="filterTahun"></select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Kecamatan</label>
                                            <select class="form-select" id="filterKecamatan"></select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Desa</label>
                                            <select class="form-select" id="filterDesa"></select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Jenis Bantuan</label>
                                            <select class="form-select" id="filterJenis">
                                                <option value="">Semua Jenis</option>
                                                <option value="Uang">Uang</option>
                                                <option value="Barang">Barang</option>
                                                <option value="Jasa">Jasa</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-end mt-3">
                                        <button class="btn btn-secondary me-2" id="resetFilterBtn"><i class="fas fa-undo me-1"></i> Reset</button>
                                        <button class="btn btn-primary" id="applyFilterBtn"><i class="fas fa-check me-1"></i> Terapkan</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-list me-2"></i> Hasil Filter</span>
                                    <span class="badge bg-warning text-dark" id="filterResultCount">0 Data</span>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table mb-0" id="filterTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th><th>Nama</th><th>NIK</th><th>WhatsApp</th><th>Kelompok</th>
                                                    <th>Jabatan</th><th>Tahun</th><th>Kecamatan</th><th>Desa</th><th>Jenis</th>
                                                    <th>Bantuan</th><th>Jumlah</th><th>Tanggal</th><th>Petugas</th><th>Dokumen</th><th>Validasi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="filterTableBody">
                                                <tr><td colspan="16" class="text-center py-4">Silakan terapkan filter</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-print" role="tabpanel">
                            <h3 class="section-title">Cetak Laporan</h3>
                            <div class="card">
                                <div class="card-header"><i class="fas fa-print me-2"></i> Konfigurasi Cetak</div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-4">
                                            <label class="form-label">Tahun</label>
                                            <select class="form-select" id="printTahun"></select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Kecamatan</label>
                                            <select class="form-select" id="printKecamatan"></select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Jenis Bantuan</label>
                                            <select class="form-select" id="printJenis">
                                                <option value="">Semua Jenis</option>
                                                <option value="Uang">Uang</option>
                                                <option value="Barang">Barang</option>
                                                <option value="Jasa">Jasa</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <div class="p-4 border rounded bg-light text-center h-100">
                                                <i class="fas fa-eye fa-3x text-info mb-3"></i>
                                                <h5>Pratinjau Layar</h5>
                                                <button class="btn btn-info text-white mt-2 w-100" id="previewBtn">Buka Pratinjau</button>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="p-4 border rounded bg-light text-center h-100">
                                                <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                <h5>Unduh PDF</h5>
                                                <button class="btn btn-danger mt-2 w-100" id="printPdfBtn">Download Laporan PDF</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-export" role="tabpanel">
                            <h3 class="section-title">Ekspor Data</h3>
                            <div class="card">
                                <div class="card-header"><i class="fas fa-file-export me-2"></i> Ekspor Universal</div>
                                <div class="card-body">
                                    <div class="alert alert-info mb-4">Filter data sebelum melakukan ekspor untuk hasil yang spesifik.</div>
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-4"><select class="form-select" id="exportTahun"></select></div>
                                        <div class="col-md-4"><select class="form-select" id="exportKecamatan"></select></div>
                                        <div class="col-md-4">
                                            <select class="form-select" id="exportJenis">
                                                <option value="">Semua Jenis</option>
                                                <option value="Uang">Uang</option>
                                                <option value="Barang">Barang</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-3"><button class="btn btn-success w-100 py-3" id="exportExcelBtn"><i class="fas fa-file-excel fa-lg mb-1 d-block"></i>Excel</button></div>
                                        <div class="col-md-3"><button class="btn btn-info text-white w-100 py-3" id="exportCsvBtn"><i class="fas fa-file-csv fa-lg mb-1 d-block"></i>CSV</button></div>
                                        <div class="col-md-3"><button class="btn btn-warning text-white w-100 py-3" id="exportJsonBtn"><i class="fas fa-file-code fa-lg mb-1 d-block"></i>JSON</button></div>
                                        <div class="col-md-3"><button class="btn btn-danger w-100 py-3" id="exportPdfBtn"><i class="fas fa-file-pdf fa-lg mb-1 d-block"></i>PDF</button></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-backup" role="tabpanel">
                            <h3 class="section-title">Manajemen Data & Keamanan</h3>
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header bg-primary text-white"><i class="fas fa-download me-2"></i> Backup Data (Reload.js)</div>
                                        <div class="card-body text-center">
                                            <i class="fas fa-shield-alt fa-4x text-primary mb-3"></i>
                                            <h5>Amankan Data Anda</h5>
                                            <p class="text-muted small">Mengunduh file <strong>reload.js</strong> terenkripsi otomatis untuk keperluan reload repo.</p>
                                            <button class="btn btn-primary w-100" id="backupDataBtn">Download</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header bg-success text-white"><i class="fas fa-upload me-2"></i> Restore Data</div>
                                        <div class="card-body text-center">
                                            <i class="fas fa-history fa-4x text-success mb-3"></i>
                                            <h5>Pulihkan Data</h5>
                                            <p class="text-muted small">Mengembalikan data dari file backup sebelumnya.</p>
                                            <input type="file" class="form-control mb-3" id="restoreFileInput" accept=".json,.js">
                                            <button class="btn btn-success w-100" id="restoreDataBtn" disabled>Proses Restore</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mt-4 border-danger">
                                <div class="card-header bg-danger text-white"><i class="fas fa-exclamation-triangle me-2"></i> Zona Bahaya</div>
                                <div class="card-body text-center">
                                    <h5>Reset Sistem</h5>
                                    <p class="text-danger small">Tindakan ini akan menghapus seluruh data secara permanen.</p>
                                    <button class="btn btn-outline-danger" id="resetDataBtn" data-bs-toggle="modal" data-bs-target="#confirmResetModal">Reset Data Pabrik</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-settings" role="tabpanel">
                            <h3 class="section-title">Pengaturan Sistem</h3>
                            <div class="card">
                                <div class="card-header"><i class="fas fa-cogs me-2"></i> Preferensi Aplikasi</div>
                                <div class="card-body">
                                    <form id="settingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Nama Aplikasi</label>
                                                <input type="text" class="form-control" id="appName" value="SISTEM BANTUAN NELAYAN">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Instansi</label>
                                                <input type="text" class="form-control" id="appSubtitle" value="Dinas Peternakan dan Perikanan Kab. Situbondo">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Kode Keamanan Baru</label>
                                                <div class="input-group">
                                                    <input type="password" class="form-control" id="settingSecurityCode" placeholder="Biarkan kosong jika tidak berubah">
                                                    <button class="btn btn-outline-secondary toggle-password-settings" type="button">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                                <small class="text-muted" style="display:none !important;">Default: <strong>BidangPN1945</strong></small>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Baris per Halaman</label>
                                                <select class="form-select" id="itemsPerPage">
                                                    <option value="10">10</option>
                                                    <option value="25">25</option>
                                                    <option value="50">50</option>
                                                    <option value="100">100</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Tahun Default</label>
                                                <select class="form-select" id="defaultTahun"></select>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3 p-3 bg-light border rounded">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="privacyToggle">
                                                <label class="form-check-label fw-bold" for="privacyToggle">Mode Privasi Data (Sensor NIK & HP)</label>
                                            </div>
                                            <small class="text-muted d-block mt-1">
                                                <strong>ON:</strong> NIK dan Nomor HP disensor (****). <br>
                                                <strong>OFF:</strong> Data ditampilkan penuh (Memerlukan PIN).
                                            </small>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="notifications" checked>
                                            <label class="form-check-label" for="notifications">Aktifkan Notifikasi Suara & Pop-up</label>
                                        </div>
                                        
                                        <div class="text-end">
                                            <button type="submit" class="btn btn-primary"><i class="fas fa-save me-1"></i> Simpan Perubahan</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4 border-left-primary shadow-sm">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-md-8">
                                            <h6 class="fw-bold mb-2" style="color: var(--primary-color);">SUPPORT CENTER</h6>
                                            <p class="small text-muted mb-0">Butuh bantuan teknis? Hubungi tim pengembang.</p>
                                        </div>
                                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                                            <a href="https://wa.me/6285647709114" class="btn btn-success btn-sm me-2"><i class="fab fa-whatsapp me-1"></i> WhatsApp</a>
                                            <a href="mailto:admin@anekamarket.my.id" class="btn btn-primary btn-sm"><i class="fas fa-envelope me-1"></i> Email</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4 bg-light border-0">
                                <div class="card-body">
                                    <h6 class="fw-bold text-primary">Informasi Teknis</h6>
                                    <div class="row small text-muted">
                                        <div class="col-6">Versi: 2.1.0 (Professional)</div>
                                        <div class="col-6 text-end">Database: LocalStorage Encrypted</div>
                                        <div class="col-6">Browser: <span id="browserInfo">-</span></div>
                                        <div class="col-6 text-end">Usage: <span id="storageInfo">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright text-center py-3">
                &copy; 2025 Dinas Peternakan dan Perikanan Kabupaten Situbondo - Bidang Pemberdayaan Nelayan.
            </div>
        </div>
        
        <div class="smart-menu-container" id="smartMenu">
            <button class="smart-menu-toggle pulse-effect" id="smartMenuToggle" title="Menu Pintas">
                <i class="fas fa-th-large"></i>
            </button>

            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('btn-reload-repo')">
                <i class="fas fa-sync-alt"></i>
                <span class="smart-menu-tooltip">Reload Data</span>
            </a>
            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('v-pills-settings-tab')">
                <i class="fas fa-cog"></i>
                <span class="smart-menu-tooltip">Pengaturan</span>
            </a>
            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('v-pills-backup-tab')">
                <i class="fas fa-download"></i>
                <span class="smart-menu-tooltip">Backup & Restore</span>
            </a>
            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('v-pills-export-tab')">
                <i class="fas fa-file-export"></i>
                <span class="smart-menu-tooltip">Ekspor Data</span>
            </a>
            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('v-pills-print-tab')">
                <i class="fas fa-print"></i>
                <span class="smart-menu-tooltip">Cetak Laporan</span>
            </a>
            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('v-pills-filter-tab')">
                <i class="fas fa-filter"></i>
                <span class="smart-menu-tooltip">Filter Data</span>
            </a>
            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('v-pills-data-tab')">
                <i class="fas fa-database"></i>
                <span class="smart-menu-tooltip">Data Bantuan</span>
            </a>
            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('v-pills-input-tab')">
                <i class="fas fa-pencil-alt"></i>
                <span class="smart-menu-tooltip">Input Data</span>
            </a>
            <a href="#" class="smart-menu-item" onclick="triggerSmartMenu('v-pills-dashboard-tab')">
                <i class="fas fa-tachometer-alt"></i>
                <span class="smart-menu-tooltip">Dashboard</span>
            </a>
        </div>

        <button class="floating-action-btn fab-common" id="fabBtn" title="Tambah Data Baru">
            <i class="fas fa-plus"></i>
        </button>
        
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="4000">
                <div class="toast-header">
                    <strong class="me-auto" id="toastTitle">Notifikasi</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" id="toastMessage"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal Detail Data -->
    <div class="modal fade" id="detailDataModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-eye me-2"></i> Detail Data Bantuan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="detail-modal-label">Nama Penerima</div>
                            <div class="detail-modal-value" id="detailNama">-</div>
                            
                            <div class="detail-modal-label">NIK</div>
                            <div class="detail-modal-value" id="detailNik">-</div>
                            
                            <div class="detail-modal-label">WhatsApp</div>
                            <div class="detail-modal-value" id="detailWhatsapp">-</div>
                            
                            <div class="detail-modal-label">Kelompok</div>
                            <div class="detail-modal-value" id="detailKelompok">-</div>
                            
                            <div class="detail-modal-label">Jabatan</div>
                            <div class="detail-modal-value" id="detailJabatan">-</div>
                            
                            <div class="detail-modal-label">Tahun Anggaran</div>
                            <div class="detail-modal-value" id="detailTahun">-</div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-modal-label">Kecamatan</div>
                            <div class="detail-modal-value" id="detailKecamatan">-</div>
                            
                            <div class="detail-modal-label">Desa</div>
                            <div class="detail-modal-value" id="detailDesa">-</div>
                            
                            <div class="detail-modal-label">Alamat</div>
                            <div class="detail-modal-value" id="detailAlamat">-</div>
                            
                            <div class="detail-modal-label">Jenis Bantuan</div>
                            <div class="detail-modal-value" id="detailJenisBantuan">-</div>
                            
                            <div class="detail-modal-label">Nama Bantuan</div>
                            <div class="detail-modal-value" id="detailNamaBantuan">-</div>
                            
                            <div class="detail-modal-label">Jumlah Bantuan</div>
                            <div class="detail-modal-value" id="detailJumlahBantuan">-</div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="detail-modal-label">Tanggal Menerima</div>
                            <div class="detail-modal-value" id="detailTanggal">-</div>
                            
                            <div class="detail-modal-label">Nama Petugas</div>
                            <div class="detail-modal-value" id="detailPetugas">-</div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-modal-label">Link Google Drive</div>
                            <div class="detail-modal-value" id="detailDriveLink">-</div>
                            
                            <div class="detail-modal-label">Kode Validasi</div>
                            <div class="detail-modal-value" id="detailKodeValidasi">-</div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="detail-modal-label">Keterangan</div>
                            <div class="detail-modal-value" id="detailKeterangan">-</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="confirmResetModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-danger">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Konfirmasi Reset Total</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-danger fw-bold">PERINGATAN: Semua data akan hilang permanen!</p>
                    <p>Ketik <strong>RESET</strong> untuk melanjutkan:</p>
                    <input type="text" class="form-control" id="resetConfirmationInput">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmResetBtn" disabled>Hapus Semua Data</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="previewModalTitle">Pratinjau Dokumen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="previewContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="printFromPreviewBtn"><i class="fas fa-print me-1"></i> Cetak Sekarang</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="privacyAuthModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title fs-6 fw-bold">Keamanan Sensor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" id="closePrivacyModal"></button>
                </div>
                <div class="modal-body">
                    <p class="small mb-2">Masukkan PIN untuk melihat data lengkap:</p>
                    <div class="input-group">
                        <input type="password" class="form-control text-center fw-bold" id="privacyPasswordInput" placeholder="MASUKKAN PIN" maxlength="8">
                        <button class="btn btn-outline-secondary toggle-password-privacy" type="button">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="invalid-feedback d-block text-center mt-2" id="privacyError" style="display:none !important;">PIN Salah!</div>
                </div>
                <div class="modal-footer p-2 justify-content-center">
                    <button type="button" class="btn btn-warning w-100 fw-bold" id="submitPrivacyAuth">Buka Sensor</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="universalPinModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title fs-6 fw-bold">Keamanan Otoritas</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="small mb-2">Masukkan PIN untuk melanjutkan aksi ini:</p>
                    <div class="input-group">
                        <input type="password" class="form-control text-center fw-bold" id="universalPinInput" placeholder="PIN" maxlength="8">
                    </div>
                    <div class="invalid-feedback d-block text-center mt-2" id="universalPinError" style="display:none !important;">PIN Salah!</div>
                </div>
                <div class="modal-footer p-2 justify-content-center">
                    <button type="button" class="btn btn-danger w-100 fw-bold" id="submitUniversalPin">Konfirmasi</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // --- GLOBAL VARIABLES & CONSTANTS ---
        let appData = [];
        let appSettings = {
            securityCode: 'BidangPN1945',
            itemsPerPage: 25,
            notifications: true,
            appName: 'SISTEM BANTUAN NELAYAN',
            appSubtitle: 'Dinas Peternakan dan Perikanan Kab. Situbondo',
            defaultTahun: new Date().getFullYear(),
            lastBackupDate: '-',
            privacyMode: true
        };
        let currentPage = 1;
        let filteredData = [];
        let isFilterActive = false;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        let generatedCodes = {};
        
        const SECURITY_CONSTANTS = {
            PIN: '17081945',
            DEFAULT_PASS: 'BidangPN1945'
        };

        let pendingSecurityAction = null;
        
        const kecamatanList = [
            "Arjasa", "Asembagus", "Banyuglugur", "Banyuputih", "Besuki", 
            "Bungatan", "Jangkar", "Jatibanteng", "Kapongan", "Kendit", 
            "Mangaran", "Mlandingan", "Panarukan", "Panji", "Situbondo", 
            "Suboh", "Sumbermalang"
        ];
        
        const desaList = [
            "Agel", "Alas Bayur", "Alasmalang", "Alastengah", "Arjasa", "Ardirejo", "Asembagus", 
            "Awar-awar", "Awang-awang", "Baderan", "Balung", "Bantal", "Battal", "Bayeman", "Besuki", "Bletok", "Blimbing", "Bloro", "Buduan", "Bugeman", "Bungatan", 
            "Campoan", "Cemara", "Curah Cottok", "Curah Jeru", "Curah Kalak", "Curah Suri", "Curah Tatal", "Dawuhan", "Demung", "Duwet", "Gadingan", "Gebangan", 
            "Gelung", "Gudang", "Gunung Malang", "Gunung Putri", "Jangkar", "Jatisari", "Jatibanteng", "Jetis", "Juglangan", "Kalianget", "Kalibagor", "Kalimas", 
            "Kalirejo", "Kalisari", "Kandang", "Kayu Putih", "Kayumas", "Kedungdowo", "Kedunglo", "Kembangsari", "Ketah", "Ketawan", "Kilensari", "Klampokan", 
            "Klatakan", "Kotakan", "Kumbangsari", "Kukusan", "Lamongan", "Landangan", "Langkap", "Lebeng", "Lubawang", "Mangaran", "Mimbaan", "Mlandingan Kulon", 
            "Mlandingan Wetan", "Mojodungkol", "Mojosari", "Olean", "Palangan", "Panarukan", "Panji Kidul", "Panji Lor", "Parante", "Pasir Putih", "Patemon", 
            "Patokan", "Paowan", "Peleyan", "Pesisir", "Pesanggrahan", "Pategalan", "Plalangan", "Pokaan", "Rajekwesi", "Seletreng", "Selobanteng", 
            "Selomukti", "Selowogo", "Semambung", "Semiring", "Sliwung", "Sopet", "Sumber Pinang", "Sumberanyar", "Sumberargo", "Sumberkolak", "Sumberejo", 
            "Sumbertengah", "Sumberwaru", "Tamankursi", "Tamansari", "Taman", "Talkandang", "Tanjung Glugur", "Tanjung Kamal", "Tanjung Pecinan", "Tambak Ukir", 
            "Telempong", "Tenggir", "Tepos", "Tokelan", "Tlogosari", "Trigonco", "Trebungan", "Widoropayung", "Wonokoyo", "Wonorejo", "Wringinanom"
        ].sort();
        
        // --- APPLICATION LIFECYCLE ---
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        });
        
        function initializeApp() {
            loadSettings();
            loadData();
            
            fillYearDropdowns();
            fillKecamatanDropdown();
            fillDesaDropdown();
            
            // Fill filter dropdowns for data table
            fillFilterDropdownsForDataTable();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalTerima').value = today;
            
            initializeCharts();
            setupBrowserInfo();
            updateDashboard();
            applySettingsToUI();
        }

        function setupEventListeners() {
            // Login & Auth
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Welcome Modal
            document.getElementById('welcomeReloadBtn').addEventListener('click', handleWelcomeReload);
            document.getElementById('skipReloadBtn').addEventListener('click', handleSkipReload);
            
            // Password Visibility Toggles
            const toggleHandlers = [
                { btn: '.toggle-password', input: 'securityCode' },
                { btn: '.toggle-password-settings', input: 'settingSecurityCode' },
                { btn: '.toggle-password-privacy', input: 'privacyPasswordInput' }
            ];
            
            toggleHandlers.forEach(handler => {
                document.querySelector(handler.btn).addEventListener('click', function() {
                    togglePasswordVisibility(this, handler.input);
                });
            });
            
            // Main Input Form
            document.getElementById('inputForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('inputForm').addEventListener('reset', resetForm);
            document.getElementById('btnBukanKelompok').addEventListener('click', setBukanKelompok);
            document.getElementById('generateKodeBtn').addEventListener('click', generateKodeValidasi);
            document.getElementById('jabatan').addEventListener('change', handleJabatanChange);
            document.getElementById('nik').addEventListener('input', () => {
                document.getElementById('kodeValidasi').value = '';
            });

            // Form Live Validation
            ['nama', 'nik', 'whatsapp', 'namaPetugas', 'namaBantuan', 'jumlahBantuan', 'driveLink', 'kodeValidasi', 'kecamatan', 'desa', 'tanggalTerima'].forEach(id => {
                document.getElementById(id).addEventListener('input', () => clearError(id));
            });
            
            // Data Table & Search
            document.getElementById('searchData').addEventListener('input', handleSearch);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);
            
            // Filter for Data Table
            document.getElementById('filterKecamatanData').addEventListener('change', handleDataTableFilter);
            document.getElementById('filterDesaData').addEventListener('change', handleDataTableFilter);
            
            // Advanced Filter
            document.getElementById('applyFilterBtn').addEventListener('click', applyFilter);
            document.getElementById('resetFilterBtn').addEventListener('click', resetFilter);
            
            // Print & Export Actions
            document.getElementById('printPdfBtn').addEventListener('click', printToPdf);
            document.getElementById('previewBtn').addEventListener('click', showPreview);
            document.getElementById('exportExcelBtn').addEventListener('click', () => exportData('excel'));
            document.getElementById('exportCsvBtn').addEventListener('click', () => exportData('csv'));
            document.getElementById('exportJsonBtn').addEventListener('click', () => exportData('json'));
            document.getElementById('exportPdfBtn').addEventListener('click', () => exportData('pdf'));
            
            // System Management
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreFileInput').addEventListener('change', enableRestoreButton);
            document.getElementById('restoreDataBtn').addEventListener('click', restoreData);
            document.getElementById('resetConfirmationInput').addEventListener('input', enableResetButton);
            
            // Refactored Reset Listener (Double Security)
            document.getElementById('confirmResetBtn').addEventListener('click', function() {
                const inputVal = document.getElementById('resetConfirmationInput').value;
                if(inputVal === 'RESET') {
                    bootstrap.Modal.getInstance(document.getElementById('confirmResetModal')).hide();
                    requestHighSecurityAction(() => {
                        performFactoryReset();
                    });
                }
            });
            
            // Settings Form
            document.getElementById('settingsForm').addEventListener('submit', handleSaveSettings);
            
            // Privacy Toggle Logic
            document.getElementById('privacyToggle').addEventListener('click', handlePrivacyToggle);
            document.getElementById('submitPrivacyAuth').addEventListener('click', checkPrivacyPassword);
            document.getElementById('closePrivacyModal').addEventListener('click', cancelPrivacyChange);
            
            // Universal PIN Logic
            document.getElementById('submitUniversalPin').addEventListener('click', handleUniversalPinSubmit);
            
            // UI Helpers
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleMobileMenu);
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 992 && document.getElementById('sidebarMenu').classList.contains('mobile-show')) {
                        toggleMobileMenu();
                    }
                });
            });

            document.getElementById('fabBtn').addEventListener('click', () => document.getElementById('v-pills-input-tab').click());
            document.getElementById('jenisBantuan').addEventListener('change', updateSatuanBantuan);
            document.getElementById('printFromPreviewBtn').addEventListener('click', () => window.print());
            document.getElementById('v-pills-logout-tab').addEventListener('click', logout);
            
            document.getElementById('btn-reload-repo').addEventListener('click', handleReloadFromRepo);

            // Smart Menu Logic
            setupSmartMenu();

            window.addEventListener('beforeunload', autoBackupData);
        }

        // --- SMART MENU LOGIC ---
        function setupSmartMenu() {
            const smartMenuToggle = document.getElementById('smartMenuToggle');
            const smartMenuContainer = document.getElementById('smartMenu');
            
            smartMenuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                this.classList.toggle('active');
                smartMenuContainer.classList.toggle('active');
            });

            // Close smart menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!smartMenuContainer.contains(e.target)) {
                    smartMenuToggle.classList.remove('active');
                    smartMenuContainer.classList.remove('active');
                }
            });
        }

        function triggerSmartMenu(targetId) {
            const targetEl = document.getElementById(targetId);
            if (targetEl) {
                targetEl.click();
                // Close menu after selection
                document.getElementById('smartMenuToggle').classList.remove('active');
                document.getElementById('smartMenu').classList.remove('active');
            }
        }
        
        function fillYearDropdowns() {
            const yearSelects = ['tahunAnggaran', 'filterTahun', 'printTahun', 'exportTahun', 'defaultTahun'];
            const currentYear = new Date().getFullYear();

            yearSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                
                if (!['tahunAnggaran', 'defaultTahun'].includes(selectId)) {
                    select.add(new Option('Semua Tahun', ''));
                }
                
                for (let year = 2020; year <= 2090; year++) {
                    select.add(new Option(year, year));
                }
                
                select.value = (selectId === 'tahunAnggaran') ? currentYear : (selectId === 'defaultTahun' ? appSettings.defaultTahun : '');
            });
        }
        
        function fillKecamatanDropdown() {
            ['kecamatan', 'filterKecamatan', 'printKecamatan', 'exportKecamatan'].forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                const defaultText = selectId === 'kecamatan' ? 'Pilih Kecamatan' : 'Semua Kecamatan';
                select.add(new Option(defaultText, ''));
                kecamatanList.forEach(kec => select.add(new Option(kec, kec)));
            });
        }
        
        function fillDesaDropdown() {
            ['desa', 'filterDesa'].forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                const defaultText = selectId === 'desa' ? 'Pilih Desa' : 'Semua Desa';
                select.add(new Option(defaultText, ''));
                desaList.forEach(desa => select.add(new Option(desa, desa)));
            });
        }
        
        function fillFilterDropdownsForDataTable() {
            // Fill kecamatan filter for data table
            const kecFilter = document.getElementById('filterKecamatanData');
            kecFilter.innerHTML = '';
            kecFilter.add(new Option('Semua Kecamatan', ''));
            kecamatanList.forEach(kec => kecFilter.add(new Option(kec, kec)));
            
            // Fill desa filter for data table
            const desaFilter = document.getElementById('filterDesaData');
            desaFilter.innerHTML = '';
            desaFilter.add(new Option('Semua Desa', ''));
            desaList.forEach(desa => desaFilter.add(new Option(desa, desa)));
        }

        // --- AUTHENTICATION ---
        function handleLogin(e) {
            e.preventDefault();
            if (isBlocked) return showNotification('Akses diblokir sementara karena terlalu banyak percobaan.', 'error');
            
            const securityCodeInput = document.getElementById('securityCode').value;
            const loginButton = document.getElementById('loginButton');
            
            loginButton.disabled = true;
            document.getElementById('loginSpinner').classList.remove('d-none');
            document.querySelector('.login-button-text').textContent = 'Memverifikasi...';
            
            setTimeout(() => {
                if (securityCodeInput === appSettings.securityCode) {
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    if (loginModal) loginModal.hide();
                    
                    showWelcomeMessage();
                } else {
                    loginAttempts++;
                    updateAttemptsCount();
                    
                    const loginForm = document.getElementById('loginForm');
                    loginForm.classList.add('login-shake');
                    setTimeout(() => loginForm.classList.remove('login-shake'), 600);
                    
                    if (loginAttempts >= 3) {
                        blockAccess();
                    } else {
                        showNotification(`Kode keamanan salah. Sisa percobaan: ${3 - loginAttempts}.`, 'error');
                    }
                }

                loginButton.disabled = false;
                document.getElementById('loginSpinner').classList.add('d-none');
                document.querySelector('.login-button-text').textContent = 'MASUK SISTEM';
            }, 500);
        }
        
        function showWelcomeMessage() {
            const welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
            const welcomeMessage = document.getElementById('welcomeMessage');
            
            const hours = new Date().getHours();
            let greeting = '';
            if (hours < 11) greeting = 'Pagi';
            else if (hours < 15) greeting = 'Siang';
            else if (hours < 19) greeting = 'Sore';
            else greeting = 'Malam';
            
            welcomeMessage.innerHTML = `
                <strong>Selamat ${greeting}!</strong><br>
                Selamat datang di Sistem Bantuan Nelayan Kabupaten Situbondo.<br>
                <small class="text-white-75">Login sebagai Administrator - Akses penuh</small>
            `;
            
            welcomeModal.show();
        }
        
        function handleWelcomeReload() {
            const welcomeModal = bootstrap.Modal.getInstance(document.getElementById('welcomeModal'));
            if (welcomeModal) welcomeModal.hide();
            
            handleReloadFromRepo();
            
            setTimeout(() => {
                document.getElementById('appContent').style.display = 'block';
                showNotification('Selamat datang! Sistem siap digunakan.', 'success');
            }, 1000);
        }
        
        function handleSkipReload() {
            const welcomeModal = bootstrap.Modal.getInstance(document.getElementById('welcomeModal'));
            if (welcomeModal) welcomeModal.hide();
            
            document.getElementById('appContent').style.display = 'block';
            showNotification('Selamat datang! Sistem siap digunakan.', 'success');
        }
        
        function togglePasswordVisibility(btn, inputId) {
            const passwordInput = document.getElementById(inputId);
            const icon = btn.querySelector('i');
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            icon.classList.toggle('fa-eye', !isPassword);
            icon.classList.toggle('fa-eye-slash', isPassword);
        }
        
        function updateAttemptsCount() {
            const attemptsEl = document.getElementById('attemptsCount');
            const blockedMessage = document.getElementById('blockedMessage');
            
            attemptsEl.style.display = loginAttempts > 0 && !isBlocked ? 'block' : 'none';
            attemptsEl.textContent = `Percobaan gagal: ${loginAttempts}/3`;
            blockedMessage.classList.toggle('d-none', !isBlocked);
        }
        
        function blockAccess() {
            isBlocked = true;
            updateAttemptsCount();
            showNotification('Akses diblokir selama 30 detik.', 'error');
            
            let countdown = 30;
            const countdownElement = document.getElementById('countdown');
            countdownElement.textContent = countdown;
            
            blockTimeout = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(blockTimeout);
                    isBlocked = false;
                    loginAttempts = 0;
                    updateAttemptsCount();
                }
            }, 1000);
        }
        
        function logout() {
            autoBackupData();
            if (confirm('Apakah Anda yakin ingin keluar?')) {
                document.getElementById('appContent').style.display = 'none';
                document.getElementById('securityCode').value = '';
                new bootstrap.Modal(document.getElementById('loginModal')).show();
                showNotification('Anda telah berhasil logout.', 'info');
            }
        }
        
        // --- SECURITY & PRIVACY LOGIC ---
        function requestHighSecurityAction(callback) {
            pendingSecurityAction = callback;
            document.getElementById('universalPinInput').value = '';
            document.getElementById('universalPinError').style.display = 'none';
            new bootstrap.Modal(document.getElementById('universalPinModal')).show();
        }

        function handleUniversalPinSubmit() {
            const pin = document.getElementById('universalPinInput').value;
            if (pin === SECURITY_CONSTANTS.PIN) {
                bootstrap.Modal.getInstance(document.getElementById('universalPinModal')).hide();
                if (pendingSecurityAction) {
                    pendingSecurityAction();
                    pendingSecurityAction = null;
                }
            } else {
                document.getElementById('universalPinError').style.display = 'block';
            }
        }

        function handlePrivacyToggle(e) {
            const toggle = e.target;
            
            // Jika user baru saja meng-uncheck (ingin mematikan sensor)
            if (!toggle.checked) {
                // Tahan dulu secara visual (tetapkan kembali ke true sampai password benar)
                toggle.checked = true;
                
                // Buka modal minta password
                document.getElementById('privacyPasswordInput').value = '';
                document.getElementById('privacyError').style.display = 'none';
                const authModal = new bootstrap.Modal(document.getElementById('privacyAuthModal'));
                authModal.show();
            } else {
                // Jika user baru saja men-check (ingin menyalakan sensor)
                appSettings.privacyMode = true;
                saveSettings();
                renderDataTable();
                renderFilterTable();
                showNotification('Sensor Data diaktifkan.', 'success');
            }
        }

        function checkPrivacyPassword() {
            const input = document.getElementById('privacyPasswordInput').value;
            
            if (input === SECURITY_CONSTANTS.PIN) { 
                appSettings.privacyMode = false;
                saveSettings();
                
                document.getElementById('privacyToggle').checked = false;
                const modalEl = document.getElementById('privacyAuthModal');
                const modal = bootstrap.Modal.getInstance(modalEl);
                modal.hide();
                
                renderDataTable();
                renderFilterTable();
                showNotification('Sensor Data dinonaktifkan. NIK dan No HP terlihat.', 'warning');
            } else {
                document.getElementById('privacyError').style.display = 'block';
                document.getElementById('privacyPasswordInput').classList.add('is-invalid');
            }
        }

        function cancelPrivacyChange() {
            document.getElementById('privacyToggle').checked = true;
        }

        function formatPrivacy(value) {
            if (!appSettings.privacyMode) return value;
            if (!value) return '-';
            const str = String(value);
            if (str.length <= 4) return '****';
            return str.slice(0, -4) + '****';
        }
        
        // --- FITUR DETAIL DATA ---
        function showDetailData(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            // Apply privacy mode
            const nikDisplay = formatPrivacy(data.nik);
            const whatsappDisplay = data.whatsapp ? `+62 ${formatPrivacy(data.whatsapp)}` : '-';
            
            // Fill modal with data
            document.getElementById('detailNama').textContent = data.nama || '-';
            document.getElementById('detailNik').textContent = nikDisplay;
            document.getElementById('detailWhatsapp').textContent = whatsappDisplay;
            document.getElementById('detailKelompok').textContent = data.namaKelompok || '-';
            document.getElementById('detailJabatan').textContent = data.jabatan || '-';
            document.getElementById('detailTahun').textContent = data.tahunAnggaran || '-';
            document.getElementById('detailKecamatan').textContent = data.kecamatan || '-';
            document.getElementById('detailDesa').textContent = data.desa || '-';
            document.getElementById('detailAlamat').textContent = data.alamat || '-';
            document.getElementById('detailJenisBantuan').textContent = data.jenisBantuan || '-';
            document.getElementById('detailNamaBantuan').textContent = data.namaBantuan || '-';
            document.getElementById('detailJumlahBantuan').textContent = `${formatNumber(data.jumlahBantuan)} ${data.satuanBantuan}`;
            document.getElementById('detailTanggal').textContent = formatDate(data.tanggalTerima) || '-';
            document.getElementById('detailPetugas').textContent = data.namaPetugas || '-';
            
            // Handle Google Drive link
            const driveLink = data.driveLink || '-';
            if (driveLink !== '-' && driveLink.startsWith('http')) {
                document.getElementById('detailDriveLink').innerHTML = `<a href="${driveLink}" target="_blank" class="drive-link">${driveLink}</a>`;
            } else {
                document.getElementById('detailDriveLink').textContent = driveLink;
            }
            
            document.getElementById('detailKodeValidasi').textContent = data.kodeValidasi || '-';
            document.getElementById('detailKeterangan').textContent = data.keterangan || '-';
            
            // Show modal
            const detailModal = new bootstrap.Modal(document.getElementById('detailDataModal'));
            detailModal.show();
        }
        
        // --- FORM HANDLING & VALIDATION ---
        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                showNotification('Harap perbaiki data yang salah pada formulir.', 'error');
                return;
            }
            
            const editId = document.getElementById('inputForm').getAttribute('data-edit-id');
            const isEditing = !!editId;

            const formData = {
                id: isEditing ? parseInt(editId) : Date.now(),
                nama: document.getElementById('nama').value.trim(),
                nik: document.getElementById('nik').value.trim(),
                whatsapp: document.getElementById('whatsapp').value.replace(/\D/g, ''),
                namaKelompok: document.getElementById('namaKelompok').value.trim() || 'Individu',
                jabatan: document.getElementById('jabatan').value,
                tahunAnggaran: document.getElementById('tahunAnggaran').value,
                kecamatan: document.getElementById('kecamatan').value,
                desa: document.getElementById('desa').value,
                alamat: document.getElementById('alamat').value.trim(),
                jenisBantuan: document.getElementById('jenisBantuan').value,
                namaBantuan: document.getElementById('namaBantuan').value.trim(),
                jumlahBantuan: document.getElementById('jumlahBantuan').value,
                satuanBantuan: document.getElementById('satuanBantuan').value,
                tanggalTerima: document.getElementById('tanggalTerima').value,
                namaPetugas: document.getElementById('namaPetugas').value.trim(),
                driveLink: document.getElementById('driveLink').value.trim(),
                kodeValidasi: document.getElementById('kodeValidasi').value,
                keterangan: document.getElementById('keterangan').value.trim(),
                tanggalInput: isEditing 
                    ? appData.find(item => item.id === parseInt(editId)).tanggalInput 
                    : new Date().toISOString()
            };
            
            if (isEditing) {
                const index = appData.findIndex(item => item.id === parseInt(editId));
                if (index > -1) {
                    appData[index] = formData;
                    showNotification('Data berhasil diperbarui!', 'success');
                }
            } else {
                appData.push(formData);
                showNotification('Data berhasil disimpan!', 'success');
            }
            
            saveData();
            resetForm();
            updateDashboard();
            renderDataTable();
            new bootstrap.Tab(document.getElementById('v-pills-data-tab')).show();
        }

        function resetForm() {
            document.getElementById('inputForm').reset();
            document.getElementById('inputForm').removeAttribute('data-edit-id');
            document.getElementById('jabatan').value = 'Individu';
            document.getElementById('namaKelompok').value = '';
            document.getElementById('tahunAnggaran').value = appSettings.defaultTahun;
            document.getElementById('tanggalTerima').value = new Date().toISOString().split('T')[0];
            document.getElementById('kodeValidasi').value = '';
            document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
        }

        function setError(id, message) {
            document.getElementById(id).classList.add('input-error');
            const errorEl = document.getElementById(`${id}Error`);
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
            }
        }

        function clearError(id) {
            document.getElementById(id).classList.remove('input-error');
            const errorEl = document.getElementById(`${id}Error`);
            if (errorEl) errorEl.style.display = 'none';
        }

        function validateForm() {
            let isValid = true;
            const requiredFields = ['nama', 'nik', 'whatsapp', 'namaPetugas', 'namaBantuan', 'jumlahBantuan', 'kodeValidasi', 'kecamatan', 'desa', 'tanggalTerima'];
            requiredFields.forEach(id => {
                if (!document.getElementById(id).value.trim()) {
                    setError(id, 'Kolom ini wajib diisi.');
                    isValid = false;
                }
            });

            const nik = document.getElementById('nik').value.trim();
            if (nik && !/^\d{16}$/.test(nik)) {
                setError('nik', 'NIK harus terdiri dari 16 digit angka.');
                isValid = false;
            } else if (isNikExists(nik)) {
                setError('nik', 'NIK ini sudah terdaftar di sistem.');
                isValid = false;
            }

            const whatsapp = document.getElementById('whatsapp').value.replace(/\D/g, '');
            if (whatsapp && !/^\d{9,13}$/.test(whatsapp)) {
                setError('whatsapp', 'Nomor WhatsApp tidak valid (9-13 digit).');
                isValid = false;
            }

            const driveLink = document.getElementById('driveLink').value.trim();
            if (driveLink && !/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(driveLink)) {
                setError('driveLink', 'Format URL Google Drive tidak valid.');
                isValid = false;
            }

            return isValid;
        }

        function isNikExists(nik) {
            const editId = document.getElementById('inputForm').getAttribute('data-edit-id');
            return appData.some(data => data.nik === nik && data.id !== (editId ? parseInt(editId) : null));
        }
        
        function setBukanKelompok() {
            document.getElementById('namaKelompok').value = 'Individu';
            document.getElementById('jabatan').value = 'Individu';
        }

        function handleJabatanChange() {
            const jabatan = document.getElementById('jabatan').value;
            const namaKelompok = document.getElementById('namaKelompok');
            if (jabatan === 'Individu') {
                namaKelompok.value = 'Individu';
            } else if (namaKelompok.value.toLowerCase() === 'individu') {
                namaKelompok.value = '';
            }
        }
        
        function generateKodeValidasi() {
            const nikInput = document.getElementById('nik');
            const nik = nikInput.value.trim();
            clearError('nik');

            if (!/^\d{16}$/.test(nik)) {
                setError('nik', 'Isi NIK dengan 16 digit angka sebelum generate kode.');
                showNotification('NIK tidak valid untuk generate kode.', 'error');
                return;
            }
            if (isNikExists(nik)) {
                setError('nik', 'NIK ini sudah terdaftar, tidak bisa generate kode baru.');
                showNotification('NIK sudah terdaftar.', 'error');
                return;
            }

            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 5; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            document.getElementById('kodeValidasi').value = result;
            clearError('kodeValidasi');
            showNotification('Kode validasi berhasil digenerate.', 'success');
        }
        
        function updateSatuanBantuan() {
            const jenis = document.getElementById('jenisBantuan').value;
            const satuanSelect = document.getElementById('satuanBantuan');
            const options = {
                'Uang': ['Rupiah'],
                'Barang': ['Unit', 'Paket', 'Set', 'Buah', 'Ekor'],
                'Jasa': ['Jam', 'Hari', 'Paket', 'Kegiatan']
            };
            satuanSelect.innerHTML = (options[jenis] || []).map(opt => `<option value="${opt}">${opt}</option>`).join('');
        }
        
        // --- DATA PERSISTENCE ---
        function loadData() {
            try {
                const savedData = localStorage.getItem('barjasData');
                appData = savedData ? JSON.parse(savedData) : [];
                const savedCodes = localStorage.getItem('barjasGeneratedCodes');
                generatedCodes = savedCodes ? JSON.parse(savedCodes) : {};
            } catch (e) {
                console.error("Gagal memuat data:", e);
                appData = [];
                generatedCodes = {};
            }
            renderDataTable();
        }
        
        function saveData() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
            localStorage.setItem('barjasGeneratedCodes', JSON.stringify(generatedCodes));
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('barjasSettings');
            if (savedSettings) {
                try {
                    const loaded = JSON.parse(savedSettings);
                    Object.assign(appSettings, loaded);
                    // SECURITY FIX: Jika kode keamanan kosong atau tidak valid, paksa kembali ke default
                    if (!appSettings.securityCode || appSettings.securityCode.trim() === '') {
                        appSettings.securityCode = SECURITY_CONSTANTS.DEFAULT_PASS;
                        console.warn("Kode keamanan direset ke default karena kosong.");
                    }
                } catch(e) {
                     appSettings.securityCode = SECURITY_CONSTANTS.DEFAULT_PASS; // Force default on error
                }
            } else {
                 appSettings.securityCode = SECURITY_CONSTANTS.DEFAULT_PASS; // Init default
            }
        }

        function saveSettings() {
            localStorage.setItem('barjasSettings', JSON.stringify(appSettings));
        }

        function applySettingsToUI() {
            document.getElementById('itemsPerPage').value = appSettings.itemsPerPage;
            document.getElementById('notifications').checked = appSettings.notifications;
            document.getElementById('appName').value = appSettings.appName;
            document.getElementById('appSubtitle').value = appSettings.appSubtitle;
            document.getElementById('defaultTahun').value = appSettings.defaultTahun;
            document.getElementById('privacyToggle').checked = appSettings.privacyMode;
        }

        function handleSaveSettings(e) {
            e.preventDefault();
            
            const newSecurityCode = document.getElementById('settingSecurityCode').value;
            if (newSecurityCode && newSecurityCode.trim() !== "") {
                appSettings.securityCode = newSecurityCode;
            } else {
                // Jangan ubah jika kosong, biarkan yang lama
            }
            
            appSettings.itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            appSettings.notifications = document.getElementById('notifications').checked;
            appSettings.appName = document.getElementById('appName').value;
            appSettings.appSubtitle = document.getElementById('appSubtitle').value;
            appSettings.defaultTahun = document.getElementById('defaultTahun').value;

            saveSettings();
            applySettingsToUI();
            showNotification('Pengaturan berhasil disimpan.', 'success');
            renderDataTable();
            
            document.querySelector('.app-title').innerHTML = appSettings.appName.replace(/\n/g, '<br>');
            document.querySelector('.app-subtitle').textContent = appSettings.appSubtitle;
            
            // Clear password field for security
            document.getElementById('settingSecurityCode').value = '';
        }
        
        // --- DATA TABLE ---
        function renderDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            tableBody.innerHTML = '';
            
            const dataToRender = isFilterActive ? filteredData : appData;
            const itemsPerPage = parseInt(appSettings.itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, dataToRender.length);
            
            if (dataToRender.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="18" class="text-center py-4">Tidak ada data</td></tr>`;
                document.getElementById('tableInfo').textContent = 'Menampilkan 0 dari 0 data';
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            for (let i = startIndex; i < endIndex; i++) {
                const data = dataToRender[i];
                const row = document.createElement('tr');
                
                const nikDisplay = formatPrivacy(data.nik);
                const whatsappRaw = data.whatsapp ? `0${data.whatsapp}` : '-';
                const whatsappDisplay = formatPrivacy(whatsappRaw);
                
                const whatsappLink = appSettings.privacyMode ? 'javascript:void(0)' : `https://wa.me/62${data.whatsapp}`;
                const whatsappClass = appSettings.privacyMode ? 'text-muted text-decoration-none' : 'whatsapp-number';
                const privacyClass = appSettings.privacyMode ? 'privacy-blurred' : '';
                
                // Tombol aksi
                let actionButtons = `
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-info text-white" onclick="showDetailData(${data.id})" title="Lihat Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-warning text-white" onclick="editData(${data.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteData(${data.id})" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td class="fw-bold text-primary">${data.nama}</td>
                    <td class="${privacyClass}">${nikDisplay}</td>
                    <td><a href="${whatsappLink}" target="${appSettings.privacyMode ? '_self' : '_blank'}" class="${whatsappClass}">${whatsappDisplay}</a></td>
                    <td>${data.namaKelompok || '-'}</td>
                    <td>${data.jabatan || '-'}</td>
                    <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan}</td>
                    <td>${data.desa}</td>
                    <td><span class="badge bg-info">${data.jenisBantuan}</span></td>
                    <td>${data.namaBantuan || '-'}</td>
                    <td class="fw-bold">${formatNumber(data.jumlahBantuan)} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td>
                    <td>${data.namaPetugas || '-'}</td>
                    <td>${data.driveLink ? `<a href="${data.driveLink}" class="drive-link" target="_blank"><i class="fas fa-external-link-alt"></i> Buka</a>` : '-'}</td>
                    <td><span class="badge bg-secondary">${data.kodeValidasi}</span></td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            }
            
            document.getElementById('tableInfo').textContent = `Menampilkan ${startIndex + 1} - ${endIndex} dari ${dataToRender.length} data`;
            updatePagination(dataToRender.length);
        }
        
        function updatePagination(totalItems) {
            const itemsPerPage = parseInt(appSettings.itemsPerPage);
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationEl = document.getElementById('pagination');
            paginationEl.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            const createPageItem = (page, text, disabled = false, active = false) => {
                const li = document.createElement('li');
                li.className = `page-item ${disabled ? 'disabled' : ''} ${active ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${page}); return false;">${text}</a>`;
                return li;
            };

            paginationEl.appendChild(createPageItem(currentPage - 1, '<i class="fas fa-chevron-left"></i>', currentPage === 1));

            const maxPagesToShow = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
            if (endPage - startPage + 1 < maxPagesToShow) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationEl.appendChild(createPageItem(i, i, false, i === currentPage));
            }

            paginationEl.appendChild(createPageItem(currentPage + 1, '<i class="fas fa-chevron-right"></i>', currentPage === totalPages));
        }
        
        function changePage(page) {
            const dataToRender = isFilterActive ? filteredData : appData;
            const totalPages = Math.ceil(dataToRender.length / parseInt(appSettings.itemsPerPage));
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderDataTable();
            }
        }
        
        function handleSearch() {
            const searchTerm = document.getElementById('searchData').value.toLowerCase();
            const filterKecamatan = document.getElementById('filterKecamatanData').value;
            const filterDesa = document.getElementById('filterDesaData').value;
            
            isFilterActive = !!searchTerm || !!filterKecamatan || !!filterDesa;
            
            filteredData = appData.filter(d => {
                const matchesSearch = !searchTerm || Object.values(d).some(v => 
                    String(v).toLowerCase().includes(searchTerm)
                );
                const matchesKecamatan = !filterKecamatan || d.kecamatan === filterKecamatan;
                const matchesDesa = !filterDesa || d.desa === filterDesa;
                
                return matchesSearch && matchesKecamatan && matchesDesa;
            });
            
            currentPage = 1;
            renderDataTable();
        }
        
        function handleDataTableFilter() {
            handleSearch();
        }
        
        function clearSearch() {
            document.getElementById('searchData').value = '';
            document.getElementById('filterKecamatanData').value = '';
            document.getElementById('filterDesaData').value = '';
            handleSearch();
        }
        
        // --- FILTER ---
        function applyFilter() {
            const filters = {
                tahun: document.getElementById('filterTahun').value,
                kecamatan: document.getElementById('filterKecamatan').value,
                desa: document.getElementById('filterDesa').value,
                jenis: document.getElementById('filterJenis').value,
            };
            
            filteredData = appData.filter(d => 
                (!filters.tahun || d.tahunAnggaran == filters.tahun) &&
                (!filters.kecamatan || d.kecamatan === filters.kecamatan) &&
                (!filters.desa || d.desa === filters.desa) &&
                (!filters.jenis || d.jenisBantuan === filters.jenis)
            );
            
            renderFilterTable();
            document.getElementById('filterResultCount').textContent = `${filteredData.length} Data`;
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }
        
        function resetFilter() {
            ['filterTahun', 'filterKecamatan', 'filterDesa', 'filterJenis'].forEach(id => document.getElementById(id).value = '');
            filteredData = [];
            renderFilterTable();
            document.getElementById('filterResultCount').textContent = '0 Data';
            showNotification('Filter direset.', 'info');
        }
        
        function renderFilterTable() {
            const tableBody = document.getElementById('filterTableBody');
            tableBody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="16" class="text-center py-4">Tidak ada data yang sesuai</td></tr>`;
                return;
            }
            
            filteredData.forEach((data, i) => {
                const nikDisplay = formatPrivacy(data.nik);
                const whatsappRaw = data.whatsapp ? `0${data.whatsapp}` : '-';
                const whatsappDisplay = formatPrivacy(whatsappRaw);
                const privacyClass = appSettings.privacyMode ? 'privacy-blurred' : '';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i + 1}</td> <td>${data.nama}</td> 
                    <td class="${privacyClass}">${nikDisplay}</td> 
                    <td>${whatsappDisplay}</td>
                    <td>${data.namaKelompok || '-'}</td> <td>${data.jabatan || '-'}</td> <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan}</td> <td>${data.desa}</td> <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td> <td>${formatNumber(data.jumlahBantuan)} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td> <td>${data.namaPetugas || '-'}</td>
                    <td>${data.driveLink ? 'Ya' : 'Tidak'}</td> <td>${data.kodeValidasi}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // --- CRUD ACTIONS ---
        function editData(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            Object.keys(data).forEach(key => {
                const el = document.getElementById(key);
                if (el) el.value = data[key];
            });

            const whatsappInput = document.getElementById('whatsapp');
            whatsappInput.value = data.whatsapp; 
            
            document.getElementById('inputForm').setAttribute('data-edit-id', id);
            new bootstrap.Tab(document.getElementById('v-pills-input-tab')).show();
            window.scrollTo(0, 0);
            showNotification('Mode edit aktif. Klik "Simpan Data" setelah selesai.', 'info');
        }
        
        function deleteData(id) {
            if (confirm('Konfirmasi: Anda yakin ingin menghapus data ini?')) {
                requestHighSecurityAction(() => {
                    appData = appData.filter(item => item.id !== id);
                    saveData();
                    showNotification('Data berhasil dihapus.', 'success');
                    updateDashboard();
                    renderDataTable();
                });
            }
        }
        
        // --- DASHBOARD ---
        function updateDashboard() {
            document.getElementById('totalPenerima').textContent = formatNumber(appData.length);
            
            const uangData = appData.filter(d => d.jenisBantuan === 'Uang');
            const totalBantuan = uangData.reduce((sum, d) => sum + (parseFloat(d.jumlahBantuan) || 0), 0);
            document.getElementById('totalBantuan').textContent = `Rp ${formatNumber(totalBantuan)}`;
            
            const tahunCount = appData.reduce((acc, d) => ({...acc, [d.tahunAnggaran]: (acc[d.tahunAnggaran] || 0) + 1}), {});
            const tahunAktif = Object.keys(tahunCount).reduce((a, b) => tahunCount[a] > tahunCount[b] ? a : b, appSettings.defaultTahun);
            document.getElementById('tahunAktif').textContent = tahunAktif;
            
            const rataBantuan = uangData.length > 0 ? totalBantuan / uangData.length : 0;
            document.getElementById('rataBantuan').textContent = `Rp ${formatNumber(rataBantuan.toFixed(0))}`;
            
            updateCharts();
            updateRecentData();
        }
        
        function updateRecentData() {
            const recentDataContainer = document.getElementById('recentData');
            recentDataContainer.innerHTML = '';
            const recent = [...appData].sort((a, b) => new Date(b.tanggalInput) - new Date(a.tanggalInput)).slice(0, 5);
            
            if (recent.length === 0) {
                recentDataContainer.innerHTML = `<tr><td colspan="5" class="text-center">Tidak ada data</td></tr>`;
                return;
            }
            
            recent.forEach(d => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(d.tanggalInput)}</td> <td>${d.nama}</td> <td>${d.desa}</td>
                    <td>${d.jenisBantuan}</td> <td>${formatNumber(d.jumlahBantuan)} ${d.satuanBantuan}</td>
                `;
                recentDataContainer.appendChild(row);
            });
        }
        
        function initializeCharts() {
            Chart.defaults.font.family = "'Inter', sans-serif";
            const pieCtx = document.getElementById('kecamatanChart')?.getContext('2d');
            if (pieCtx) {
                window.kecamatanChart = new Chart(pieCtx, { type: 'pie', options: { responsive: true, plugins: { legend: { position: 'right' } } } });
            }
            const barCtx = document.getElementById('tahunChart')?.getContext('2d');
            if (barCtx) {
                window.tahunChart = new Chart(barCtx, { type: 'bar', options: { responsive: true, scales: { y: { beginAtZero: true } } } });
            }
        }
        
        function updateCharts() {
            if (!appData || appData.length === 0) return;

            const kecamatanData = appData.reduce((acc, d) => ({...acc, [d.kecamatan]: (acc[d.kecamatan] || 0) + 1}), {});
            if (window.kecamatanChart) {
                window.kecamatanChart.data = {
                    labels: Object.keys(kecamatanData),
                    datasets: [{ data: Object.values(kecamatanData), backgroundColor: ['#005f73', '#0a9396', '#94d2bd', '#e9d8a6', '#ee9b00', '#ca6702', '#bb3e03', '#ae2012', '#9b2226'] }]
                };
                window.kecamatanChart.update();
            }
            
            const tahunData = appData.reduce((acc, d) => ({...acc, [d.tahunAnggaran]: (acc[d.tahunAnggaran] || 0) + 1}), {});
            const sortedYears = Object.keys(tahunData).sort();
            if (window.tahunChart) {
                window.tahunChart.data = {
                    labels: sortedYears,
                    datasets: [{ label: 'Jumlah Penerima', data: sortedYears.map(year => tahunData[year]), backgroundColor: '#0a9396' }]
                };
                window.tahunChart.update();
            }
        }
        
        // --- PRINT & EXPORT ---
        function getFilteredDataForExport(prefix) {
            const filters = {
                tahun: document.getElementById(`${prefix}Tahun`).value,
                kecamatan: document.getElementById(`${prefix}Kecamatan`).value,
                jenis: document.getElementById(`${prefix}Jenis`).value,
            };
            
            if (!filters.tahun && !filters.kecamatan && !filters.jenis) return appData;

            return appData.filter(d => 
                (!filters.tahun || d.tahunAnggaran == filters.tahun) &&
                (!filters.kecamatan || d.kecamatan === filters.kecamatan) &&
                (!filters.jenis || d.jenisBantuan === filters.jenis)
            );
        }

        function printToPdf() {
            const dataToPrint = getFilteredDataForExport('print');
            if (dataToPrint.length === 0) return showNotification('Tidak ada data untuk dicetak sesuai filter.', 'warning');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape', 'pt', 'a4');
            
            doc.setFontSize(16);
            doc.text(appSettings.appName, doc.internal.pageSize.getWidth() / 2, 40, { align: 'center' });
            doc.setFontSize(12);
            doc.text(appSettings.appSubtitle, doc.internal.pageSize.getWidth() / 2, 60, { align: 'center' });
            
            const cols = ["No", "Nama", "NIK", "Desa", "Kecamatan", "Nama Bantuan", "Jumlah", "Tanggal"];
            const rows = dataToPrint.map((d, i) => [
                i + 1, d.nama, 
                formatPrivacy(d.nik), 
                d.desa, d.kecamatan, d.namaBantuan || '-',
                `${formatNumber(d.jumlahBantuan)} ${d.satuanBantuan}`, formatDate(d.tanggalTerima)
            ]);
            
            doc.autoTable({ head: [cols], body: rows, startY: 80, theme: 'grid', headStyles: { fillColor: [0, 95, 115] } });
            doc.save(`laporan_nelayan_${new Date().toISOString().slice(0,10)}.pdf`);
            showNotification('Laporan PDF berhasil diunduh.', 'success');
        }
        
        function showPreview() {
            const dataToPreview = getFilteredDataForExport('print');
            if (dataToPreview.length === 0) return showNotification('Tidak ada data untuk pratinjau sesuai filter.', 'warning');

            document.getElementById('previewModalTitle').textContent = `Pratinjau Laporan (${dataToPreview.length} data)`;
            let content = `
                <div class="print-header text-center mb-4">
                    <h4>${appSettings.appName}</h4>
                    <p class="mb-1">${appSettings.appSubtitle}</p>
                    <p class="text-muted">Tanggal: ${formatDate(new Date().toISOString())}</p>
                </div>
                <table class="preview-table"><thead><tr>
                    <th>No</th><th>Nama</th><th>NIK</th><th>Desa</th><th>Nama Bantuan</th><th>Jumlah</th><th>Tanggal</th>
                </tr></thead><tbody>`;

            dataToPreview.forEach((d, i) => {
                content += `<tr>
                    <td>${i + 1}</td><td>${d.nama}</td><td>${formatPrivacy(d.nik)}</td><td>${d.desa}</td>
                    <td>${d.namaBantuan}</td><td>${formatNumber(d.jumlahBantuan)} ${d.satuanBantuan}</td><td>${formatDate(d.tanggalTerima)}</td>
                </tr>`;
            });

            content += `</tbody></table>`;
            document.getElementById('previewContent').innerHTML = content;
            new bootstrap.Modal(document.getElementById('previewModal')).show();
        }

        function exportData(format) {
            const dataToExport = getFilteredDataForExport('export');
            if (dataToExport.length === 0) return showNotification('Tidak ada data untuk diekspor sesuai filter.', 'warning');

            const timestamp = new Date().toISOString().slice(0, 10);
            const filename = `data_nelayan_${timestamp}`;

            switch(format) {
                case 'excel':
                    const ws = XLSX.utils.json_to_sheet(dataToExport);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Data');
                    XLSX.writeFile(wb, `${filename}.xlsx`);
                    break;
                case 'csv':
                    const csvWs = XLSX.utils.json_to_sheet(dataToExport);
                    const csv = XLSX.utils.sheet_to_csv(csvWs);
                    downloadFile(csv, 'text/csv', `${filename}.csv`);
                    break;
                case 'json':
                    downloadFile(JSON.stringify(dataToExport, null, 2), 'application/json', `${filename}.json`);
                    break;
                case 'pdf':
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('landscape', 'pt', 'a4');
                    doc.text('DATA BANTUAN NELAYAN', doc.internal.pageSize.getWidth()/2, 40, {align: 'center'});
                    doc.autoTable({ body: dataToExport, startY: 60, theme: 'grid', headStyles: { fillColor: [0, 95, 115] } });
                    doc.save(`${filename}.pdf`);
                    break;
            }
            showNotification(`Data berhasil diekspor ke format ${format.toUpperCase()}.`, 'success');
        }

        function downloadFile(content, mimeType, filename) {
            const blob = new Blob([content], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- BACKUP (RELOAD.JS) & RESTORE ---
        function autoBackupData() {
            if (appData.length === 0) return;
            appSettings.lastBackupDate = new Date().toLocaleDateString('id-ID');
            saveSettings();
        }

        function backupData() {
            if (appData.length === 0) return showNotification('Tidak ada data untuk dibackup.', 'warning');
            
            // 1. Siapkan data JSON
            const dataToBackup = { appData, appSettings, generatedCodes };
            
            // 2. Enkripsi ke Base64 (sama seperti sebelumnya)
            const encryptedString = btoa(unescape(encodeURIComponent(JSON.stringify(dataToBackup))));
            
            // 3. Buat konten file JS with NEW APP NAME
            const timestamp = new Date().toLocaleString('id-ID');
            const appNameFull = "APLIKASI BARJAS BIDANG PEMBERDAYAAN NELAYAN";
            
            const fileContent = `/* PETUNJUK PENGGUNAAN RELOAD REPO:
    1. Ini adalah file backup otomatis dari Aplikasi.
    2. Jangan ubah kode di dalam tanda petik dua ("...") di bawah.
    3. Upload file ini ke hosting tempat aplikasi berjalan untuk fitur Reload Data.
    
    APP NAME : ${appNameFull}
    TANGGAL  : ${timestamp}
*/

window.BARJAS_BACKUP_ENCRYPTED = "${encryptedString}";
`;

            // 4. Download sebagai reload.js
            downloadFile(fileContent, 'text/javascript', 'reload.js');
            
            // Update timestamp
            appSettings.lastBackupDate = new Date().toLocaleDateString('id-ID');
            saveSettings();
            applySettingsToUI();
            showNotification('Backup file (reload.js) berhasil diunduh.', 'success');
        }
        
        function handleReloadFromRepo() {
            if(!confirm("Apakah Anda yakin ingin me-reload data dari repository? Data lokal akan digabungkan dengan data baru.")) return;
            const btn = document.getElementById('btn-reload-repo');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin feature-icon"></i> Loading...';
            btn.disabled = true;

            const oldScript = document.getElementById('reload-script');
            if(oldScript) oldScript.remove();

            const script = document.createElement('script');
            script.id = 'reload-script';
            script.src = './reload.js?v=' + new Date().getTime(); 

            script.onload = function() {
                try {
                    if (window.BARJAS_BACKUP_ENCRYPTED) {
                        const rawContent = window.BARJAS_BACKUP_ENCRYPTED;
                        let restored;
                        try {
                            if (typeof rawContent === 'string') {
                                restored = JSON.parse(decodeURIComponent(escape(atob(rawContent))));
                            } else {
                                restored = rawContent;
                            }
                        } catch (decryptionError) {
                            throw new Error("Gagal mendekripsi data.");
                        }
                        
                        // LOGIKA MERGE DATA
                        if(restored && restored.appData && Array.isArray(restored.appData)) {
                            
                            const existingIds = new Set(appData.map(item => item.id));
                            let addedCount = 0;

                            restored.appData.forEach(newItem => {
                                if (!existingIds.has(newItem.id)) {
                                    appData.push(newItem);
                                    existingIds.add(newItem.id); 
                                    addedCount++;
                                }
                            });

                            if(restored.generatedCodes) {
                                generatedCodes = { ...restored.generatedCodes, ...generatedCodes }; 
                            }

                            saveData();
                            saveSettings();
                            applySettingsToUI();
                            updateDashboard();
                            renderDataTable();
                            
                            if (addedCount > 0) {
                                showNotification(`Berhasil reload! ${addedCount} data baru ditambahkan.`, 'success');
                            } else {
                                showNotification('Reload selesai. Tidak ada data baru yang ditemukan.', 'info');
                            }

                        } else {
                            throw new Error('Format data tidak valid.');
                        }
                    } else {
                        throw new Error('Variabel backup tidak ditemukan di reload.js.');
                    }
                } catch (e) {
                    showNotification('Error: ' + e.message, 'error');
                } finally {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    delete window.BARJAS_BACKUP_ENCRYPTED;
                }
            };

            script.onerror = function() {
                showNotification('Gagal memuat file reload.js. Pastikan file ada di folder yang sama.', 'error');
                btn.innerHTML = originalText;
                btn.disabled = false;
            };
            document.body.appendChild(script);
        }

        function enableRestoreButton() {
            document.getElementById('restoreDataBtn').disabled = !this.files.length;
        }
        
        function restoreData() {
            const file = document.getElementById('restoreFileInput').files[0];
            if (!file || !confirm('PENTING: Restore akan menimpa semua data. Lanjutkan?')) return;
            
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const content = e.target.result;
                    let restored;
                    
                    // Cek apakah file reload.js (mengandung window.BARJAS...) atau JSON biasa
                    if (content.includes('window.BARJAS_BACKUP_ENCRYPTED')) {
                        // Extract string dalam tanda petik
                        const match = content.match(/window\.BARJAS_BACKUP_ENCRYPTED\s*=\s*"([^"]+)"/);
                        if (match && match[1]) {
                            restored = JSON.parse(decodeURIComponent(escape(atob(match[1]))));
                        } else {
                            throw new Error("Format reload.js tidak valid.");
                        }
                    } else {
                        // Coba parse sebagai JSON biasa (legacy backup)
                        try {
                            restored = JSON.parse(decodeURIComponent(escape(atob(content))));
                        } catch (err) {
                            restored = JSON.parse(content);
                        }
                    }

                    if (restored && restored.appData && restored.appSettings) {
                        appData = restored.appData;
                        Object.assign(appSettings, restored.appSettings);
                        
                        // PASTIKAN KODE KEAMANAN TETAP DEFAULT JIKA KOSONG SETELAH RESTORE
                         if (!appSettings.securityCode || appSettings.securityCode.trim() === '') {
                             appSettings.securityCode = SECURITY_CONSTANTS.DEFAULT_PASS;
                         }

                        generatedCodes = restored.generatedCodes || {};
                        saveData();
                        saveSettings();
                        applySettingsToUI();
                        document.getElementById('restoreFileInput').value = '';
                        document.getElementById('restoreDataBtn').disabled = true;
                        updateDashboard();
                        renderDataTable();
                        showNotification('Data berhasil direstore.', 'success');
                    } else {
                        throw new Error("Struktur data tidak valid.");
                    }
                } catch (error) {
                    console.error(error);
                    showNotification('Gagal merestore data. File mungkin rusak.', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function enableResetButton() {
            document.getElementById('confirmResetBtn').disabled = this.value !== 'RESET';
        }
        
        function performFactoryReset() {
            appData = [];
            generatedCodes = {};
            // Reset Settings tapi pertahankan default password
            appSettings.securityCode = SECURITY_CONSTANTS.DEFAULT_PASS;
            saveData();
            saveSettings();
            
            document.getElementById('resetConfirmationInput').value = '';
            updateDashboard();
            renderDataTable();
            showNotification('Data telah direset!', 'warning');
        }

        // --- UTILS ---
        function setupBrowserInfo() {
            const agent = navigator.userAgent;
            let browserName = "Unknown";
            if (agent.indexOf("Firefox") > -1) browserName = "Firefox";
            else if (agent.indexOf("Chrome") > -1) browserName = "Chrome";
            else if (agent.indexOf("Safari") > -1) browserName = "Safari";
            document.getElementById('browserInfo').textContent = browserName;
            try {
                const usedStorage = (JSON.stringify(localStorage).length / 1024).toFixed(2);
                document.getElementById('storageInfo').textContent = `${usedStorage} KB`;
            } catch (e) {
                document.getElementById('storageInfo').textContent = 'Error';
            }
        }
        
        function toggleMobileMenu() {
            document.getElementById('sidebarMenu').classList.toggle('mobile-show');
            document.getElementById('sidebarOverlay').classList.toggle('mobile-show');
        }
        
        function showNotification(message, type = 'info') {
            if (!appSettings.notifications) return;
            const toastEl = document.querySelector('.notification-toast');
            const toastHeader = toastEl.querySelector('.toast-header');
            const toastTitle = document.getElementById('toastTitle');
            document.getElementById('toastMessage').textContent = message;
            
            const styles = {
                success: { bg: 'bg-success-subtle', text: 'text-success-emphasis', title: 'Berhasil' },
                error: { bg: 'bg-danger-subtle', text: 'text-danger-emphasis', title: 'Gagal' },
                warning: { bg: 'bg-warning-subtle', text: 'text-warning-emphasis', title: 'Peringatan' },
                info: { bg: 'bg-primary-subtle', text: 'text-primary-emphasis', title: 'Informasi' }
            };
            
            toastHeader.className = `toast-header ${styles[type].bg} ${styles[type].text}`;
            toastTitle.textContent = styles[type].title;
            new bootstrap.Toast(toastEl).show();
        }
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });
        }
        
        function formatNumber(num) {
            if (isNaN(num)) return num; 
            return new Intl.NumberFormat('id-ID').format(num);
        }
    </script>
</body>
</html>
