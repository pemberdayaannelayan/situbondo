<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Bidang Pemberdayaan Nelayan - Dinas Perikanan Situbondo</title>
    <meta name="description" content="Website resmi Bidang Pemberdayaan Nelayan Dinas Perikanan Kabupaten Situbondo. Layanan pengajuan KUSUKA, SIMATA, Bantuan Sarpras, dan Pengaduan Nelayan secara online.">
    <meta name="keywords" content="Dinas Perikanan Situbondo, SIMATA Situbondo, Peta Nelayan, Pemberdayaan Nelayan, Kartu KUSUKA, Bantuan Kapal, Pengaduan Nelayan, Layanan Nelayan">
    <meta name="author" content="Dinas Perikanan Situbondo">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#1a237e">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.dinasperikanansitubondo.com/">
    <meta property="og:title" content="Layanan Pemberdayaan Nelayan - Situbondo">
    <meta property="og:description" content="Akses mudah data KUSUKA, SIMATA, Bantuan Sarpras, dan Saluran Aspirasi Masyarakat Pesisir Situbondo.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1583212292454-1fe6229603b7?q=80&w=2074&auto=format&fit=crop">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Satisfy&display=swap" rel="stylesheet">
    
    <!-- Font Awesome & AOS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        /* ============================================
           VARIABLES & RESET
        ============================================ */
        :root {
            /* Professional Marine Color Palette */
            --primary-blue: #1a237e;
            --primary-dark: #0c4a6e;
            --secondary-blue: #283593;
            --accent-blue: #1976d2;
            --accent-dark: #1565c0;
            --ocean-teal: #0284c7;
            --sunset-orange: #f59e0b;
            --sunset-dark: #d97706;
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ff6b6b;
            
            /* Neutral Colors */
            --light-bg: #f8fafc;
            --white: #ffffff;
            --off-white: #f0f9ff;
            --text-main: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --border-light: #cbd5e1;
            
            /* Typography */
            --font-heading: 'Outfit', sans-serif;
            --font-body: 'Plus Jakarta Sans', sans-serif;
            --font-signature: 'Satisfy', cursive;
            
            /* Effects */
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 20px 50px rgba(0, 0, 0, 0.15);
            --shadow-xl: 0 25px 60px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            color: var(--text-secondary);
            background-color: var(--light-bg);
            overflow-x: hidden;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            color: var(--text-main);
            font-weight: 700;
            line-height: 1.2;
        }

        p {
            margin-bottom: 1rem;
        }

        a {
            text-decoration: none;
            color: inherit;
            transition: var(--transition);
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        section {
            padding: 100px 0;
        }

        .container {
            max-width: 1400px;
        }

        /* ============================================
           UTILITY CLASSES
        ============================================ */
        .gradient-text {
            background: linear-gradient(135deg, var(--sunset-orange), var(--sunset-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gradient-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
        }

        .gradient-ocean {
            background: linear-gradient(135deg, var(--ocean-teal), var(--accent-blue));
        }

        .text-gradient-primary {
            color: var(--primary-blue);
        }

        .text-gradient-accent {
            color: var(--accent-blue);
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-header .subtitle {
            display: inline-block;
            color: var(--sunset-orange);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .section-header h2 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }

        .section-header .divider {
            width: 80px;
            height: 4px;
            background: linear-gradient(to right, var(--sunset-orange), var(--sunset-dark));
            margin: 0 auto 1.5rem;
            border-radius: 2px;
        }

        .section-header .description {
            max-width: 700px;
            margin: 0 auto;
            color: var(--text-muted);
        }

        /* ============================================
           NAVBAR - ENHANCED DESIGN
        ============================================ */
        .navbar {
            padding: 1rem 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: var(--shadow-sm);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
            transition: var(--transition);
        }

        .navbar.scrolled {
            padding: 0.75rem 0;
            box-shadow: var(--shadow-md);
            background: rgba(255, 255, 255, 0.95);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0;
        }

        .navbar-brand img {
            height: 60px;
            width: auto;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .navbar-brand:hover img {
            transform: scale(1.05);
        }

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .brand-text h5 {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--primary-blue);
            margin: 0;
            line-height: 1.2;
        }

        .brand-text span {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent-blue);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .navbar-toggler {
            border: none;
            padding: 0.5rem;
            font-size: 1.25rem;
            color: var(--primary-blue);
        }

        .navbar-toggler:focus {
            box-shadow: none;
            outline: none;
        }

        .navbar-nav {
            gap: 0.5rem;
            align-items: center;
        }

        .nav-link {
            font-weight: 600;
            color: var(--text-main) !important;
            padding: 0.5rem 1rem !important;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            position: relative;
        }

        .nav-link:hover {
            color: var(--accent-blue) !important;
            background: rgba(2, 132, 199, 0.05);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: linear-gradient(to right, var(--sunset-orange), var(--accent-blue));
            transition: width 0.3s ease;
            border-radius: 1px;
        }

        .nav-link:hover::after {
            width: 80%;
        }

        .btn-cta {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(2, 132, 199, 0.3);
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(2, 132, 199, 0.4);
            color: white;
        }

        .btn-cta::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-cta:hover::before {
            left: 100%;
        }

        /* ============================================
           HERO SECTION - REDESIGNED
        ============================================ */
        .hero-section {
            min-height: 100vh;
            background: linear-gradient(rgba(10, 25, 47, 0.85), rgba(10, 25, 47, 0.9)), 
                        url('https://images.unsplash.com/photo-1583212292454-1fe6229603b7?q=80&w=2074&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            align-items: center;
            position: relative;
            padding-top: 140px;
            color: white;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            padding: 4rem 0;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 2rem;
            transition: var(--transition);
        }

        .hero-badge:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .hero-badge i {
            color: var(--sunset-orange);
        }

        .slogan-signature {
            font-family: var(--font-signature);
            font-size: 4rem;
            color: white;
            margin-bottom: 1rem;
            line-height: 1;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        .connector-text {
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 300;
            margin: 0 0.5rem;
            vertical-align: middle;
        }

        .hero-description {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 3rem;
            max-width: 800px;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn-outline-light {
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            transition: var(--transition);
            background: transparent;
        }

        .btn-outline-light:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: white;
            transform: translateY(-2px);
        }

        /* ============================================
           SERVICES SECTION - IMPROVED CARDS
        ============================================ */
        .services-section {
            background: var(--light-bg);
        }

        .service-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            height: 100%;
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: inherit;
            position: relative;
            overflow: hidden;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }

        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-xl);
            border-color: var(--accent-blue);
        }

        .service-card:hover::before {
            transform: scaleX(1);
        }

        .service-logo {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin: 0 auto 2rem;
            transition: transform 0.4s ease;
        }

        .service-card:hover .service-logo {
            transform: scale(1.1);
        }

        .service-card h4 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-blue);
        }

        .service-card p {
            color: var(--text-muted);
            margin-bottom: 2rem;
            flex-grow: 1;
        }

        .service-link {
            color: var(--accent-blue);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .service-card:hover .service-link {
            color: var(--primary-blue);
            transform: translateX(5px);
        }

        /* Gallery Thumbnail Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 0.5rem;
            margin: 2rem 0;
            height: 200px;
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-sm);
            cursor: pointer;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(2, 132, 199, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gallery-item:hover .gallery-overlay {
            opacity: 1;
        }

        /* ============================================
           MAP SECTION - COMPLETELY REDESIGNED
        ============================================ */
        .map-section {
            background: linear-gradient(135deg, var(--off-white) 0%, #e0f2fe 100%);
            position: relative;
        }

        .map-container {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
            margin-top: 2rem;
        }

        .map-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            padding: 2.5rem 3rem;
            position: relative;
            overflow: hidden;
        }

        .map-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }

        .map-title {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .map-title i {
            color: var(--sunset-orange);
            font-size: 2.5rem;
            filter: drop-shadow(0 0 10px rgba(245, 158, 11, 0.5));
        }

        .map-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin-bottom: 2rem;
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .meta-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1.25rem;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .meta-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }

        .meta-card i {
            font-size: 1.5rem;
            color: var(--sunset-orange);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .meta-content h4 {
            font-size: 1.75rem;
            margin: 0;
            color: white;
        }

        .meta-content p {
            margin: 0.25rem 0 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .map-body {
            display: flex;
            min-height: 700px;
        }

        .map-sidebar {
            flex: 0 0 400px;
            background: white;
            border-right: 1px solid var(--border-color);
            padding: 2rem;
            overflow-y: auto;
        }

        .map-tabs {
            display: flex;
            background: var(--light-bg);
            border-radius: var(--radius-md);
            padding: 0.5rem;
            margin-bottom: 2rem;
        }

        .map-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .map-tab.active {
            background: white;
            color: var(--primary-blue);
            box-shadow: var(--shadow-sm);
        }

        .map-tab:hover:not(.active) {
            color: var(--accent-blue);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-box {
            position: relative;
            margin-bottom: 2rem;
        }

        .search-box input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--light-bg);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
            background: white;
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .stats-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
            transition: var(--transition);
        }

        .stats-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-5px);
        }

        .stats-card h4 {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--primary-blue);
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .stats-card h4 i {
            color: var(--sunset-orange);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1.5rem 1rem;
            background: linear-gradient(135deg, var(--off-white), var(--light-bg));
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .stat-item:hover {
            background: var(--light-bg);
            border-color: var(--accent-blue);
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
            font-family: var(--font-heading);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        .desa-list-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .desa-header {
            padding: 1rem 1.5rem;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
            color: white;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .desa-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .desa-item:hover {
            background: var(--off-white);
            padding-left: 2rem;
        }

        .desa-item.active {
            background: var(--light-bg);
            border-left: 4px solid var(--accent-blue);
        }

        .desa-name {
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.25rem;
        }

        .desa-count {
            background: var(--accent-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .map-area {
            flex: 1;
            position: relative;
            background: var(--light-bg);
        }

        #statistikMap {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            position: absolute;
            top: 2rem;
            right: 2rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .control-btn {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--primary-dark), var(--accent-dark));
        }

        .map-legend {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-width: 250px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 0.75rem;
            border: 3px solid white;
            box-shadow: var(--shadow-sm);
        }

        .map-footer {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            padding: 2rem 3rem;
            border-top: 1px solid var(--border-color);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .footer-badge {
            background: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            color: var(--primary-blue);
        }

        /* ============================================
           FORM SECTION - ENHANCED DESIGN
        ============================================ */
        .form-section {
            background: white;
        }

        .form-wrapper {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
        }

        .form-sidebar {
            background: linear-gradient(160deg, var(--primary-blue), var(--secondary-blue));
            padding: 3rem;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .form-logo {
            width: 180px;
            height: auto;
            margin: 0 auto 2rem;
            display: block;
        }

        .form-sidebar h3 {
            color: white;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .form-sidebar p {
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 2rem;
        }

        .feature-list {
            margin-top: 2rem;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .feature-item i {
            color: var(--sunset-orange);
            font-size: 1.25rem;
            width: 24px;
        }

        .form-content {
            padding: 3rem;
        }

        .form-content h4 {
            color: var(--text-main);
            margin-bottom: 2rem;
        }

        .form-label {
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-control {
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 0.875rem 1rem;
            font-size: 1rem;
            transition: var(--transition);
            width: 100%;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
            background: white;
        }

        .btn-submit {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--radius-md);
            font-weight: 700;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-size: 1.1rem;
            transition: var(--transition);
            margin-top: 1rem;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, #1ebc57, #0d7d6f);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 211, 102, 0.3);
            color: white;
        }

        /* ============================================
           FOOTER - REDESIGNED
        ============================================ */
        footer {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            position: relative;
            margin-top: 4rem;
        }

        .footer-wave {
            line-height: 0;
            width: 100%;
            background: white;
        }

        .footer-wave svg {
            display: block;
            width: 100%;
            height: 100px;
            fill: var(--primary-blue);
        }

        .footer-main {
            padding: 4rem 0 3rem;
        }

        .footer-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .footer-brand i {
            font-size: 2.5rem;
            color: white;
        }

        .footer-links h5 {
            color: white;
            margin-bottom: 1.5rem;
            position: relative;
            display: inline-block;
        }

        .footer-links h5::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -8px;
            width: 40px;
            height: 3px;
            background: var(--sunset-orange);
            border-radius: 2px;
        }

        .footer-links ul {
            list-style: none;
            padding: 0;
        }

        .footer-links li {
            margin-bottom: 0.75rem;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
            padding-left: 0.5rem;
        }

        .contact-info {
            margin-top: 2rem;
        }

        .contact-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .contact-icon {
            background: rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--sunset-orange);
            flex-shrink: 0;
        }

        .copyright {
            background: rgba(0, 0, 0, 0.2);
            padding: 1.5rem 0;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ============================================
           LOADING & MODAL
        ============================================ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 6px solid var(--light-bg);
            border-top: 6px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            background: white;
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.3s ease-out;
            max-width: 400px;
            border-left: 4px solid var(--accent-blue);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ============================================
           RESPONSIVE DESIGN
        ============================================ */
        @media (max-width: 1400px) {
            .container {
                max-width: 100%;
                padding: 0 2rem;
            }
        }

        @media (max-width: 1200px) {
            .hero-title {
                font-size: 3rem;
            }
            
            .map-body {
                flex-direction: column;
            }
            
            .map-sidebar {
                flex: none;
                width: 100%;
                max-height: 500px;
            }
            
            .map-area {
                height: 500px;
            }
        }

        @media (max-width: 992px) {
            section {
                padding: 80px 0;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .slogan-signature {
                font-size: 3rem;
            }
            
            .section-header h2 {
                font-size: 2rem;
            }
            
            .form-wrapper {
                flex-direction: column;
            }
            
            .form-sidebar, .form-content {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1.5rem;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .slogan-signature {
                font-size: 2.5rem;
            }
            
            .hero-buttons {
                flex-direction: column;
            }
            
            .hero-buttons .btn {
                width: 100%;
            }
            
            .metadata-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            
            .gallery-grid {
                height: 150px;
            }
        }

        @media (max-width: 576px) {
            section {
                padding: 60px 0;
            }
            
            .hero-title {
                font-size: 1.75rem;
            }
            
            .slogan-signature {
                font-size: 2rem;
            }
            
            .section-header h2 {
                font-size: 1.75rem;
            }
            
            .service-card {
                padding: 2rem 1.5rem;
            }
            
            .service-logo {
                width: 100px;
                height: 100px;
            }
            
            .map-header {
                padding: 2rem 1.5rem;
            }
            
            .control-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .form-sidebar, .form-content {
                padding: 2rem 1.5rem;
            }
        }
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div class="loading-screen hidden" id="loadingScreen">
        <div class="spinner"></div>
        <h2 style="color: var(--primary-blue); margin-bottom: 1rem;">Memuat Peta Statistik</h2>
        <p style="color: var(--text-muted); max-width: 400px; text-align: center;">
            Sedang memuat data statistik nelayan Kabupaten Situbondo...
        </p>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg" id="mainNav">
        <div class="container">
            <a class="navbar-brand" href="https://www.dinasperikanansitubondo.com">
                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/LOGO%20KABUPATEN%20SITUBONDO.png" alt="Logo Kabupaten Situbondo">
                <div class="brand-text">
                    <h5>DINAS PERIKANAN</h5>
                    <span>KAB. SITUBONDO</span>
                </div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="https://www.dinasperikanansitubondo.com">Beranda</a></li>
                    <li class="nav-item"><a class="nav-link" href="#layanan">Layanan</a></li>
                    <li class="nav-item"><a class="nav-link" href="#statistik">Peta Data</a></li>
                    <li class="nav-item"><a class="nav-link" href="#aduan">Pengaduan</a></li>
                    <li class="nav-item ms-lg-3">
                        <a href="#aduan" class="btn btn-cta">
                            <i class="fas fa-headset me-2"></i> Hubungi Kami
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge" data-aos="fade-up">
                    <i class="fas fa-water"></i>
                    <span>Dinas Perikanan Situbondo</span>
                </div>
                
                <div class="slogan-signature" data-aos="fade-up" data-aos-delay="100">
                    Pemberdayaan Nelayan
                </div>
                
                <h1 class="hero-title" data-aos="fade-up" data-aos-delay="200">
                    Dari Hulu ke Hilir 
                    <span class="connector-text">untuk</span><br>
                    <span class="gradient-text">Situbondo Naik Kelas</span>
                </h1>
                
                <p class="hero-description" data-aos="fade-up" data-aos-delay="300">
                    Program kegiatan Bidang Bina Pemberdayaan Nelayan yang merujuk pada rantai nilai perikanan, mulai dari kegiatan penangkapan ikan di laut (hulu) hingga proses pengolahan, distribusi, pemasaran, hingga akhirnya sampai ke konsumen (hilir), dengan tujuan meningkatkan kesejahteraan nelayan melalui basis data terintegrasi, pemberdayaan, dan dukungan infrastruktur.
                </p>
                
                <div class="hero-buttons" data-aos="fade-up" data-aos-delay="400">
                    <a href="#layanan" class="btn btn-cta">
                        <i class="fas fa-compass me-2"></i> Layanan Kami
                    </a>
                    <a href="https://portaldata.kkp.go.id/" target="_blank" class="btn btn-outline-light">
                        <i class="fas fa-external-link-alt me-2"></i> Portal Data KKP
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="layanan" class="services-section">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <span class="subtitle">Menu Layanan</span>
                <h2>Akses Program Nelayan</h2>
                <div class="divider"></div>
                <p class="description">Pilih menu di bawah ini untuk mengakses layanan digital dan program bantuan pemerintah.</p>
            </div>

            <div class="row g-4">
                <!-- KUSUKA -->
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="100">
                    <a href="https://portaldata.kkp.go.id/" target="_blank" class="service-card">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/kusuka.png" alt="KUSUKA" class="service-logo">
                        <h4>Kartu KUSUKA</h4>
                        <p>Akses Portal Data KKP untuk pendaftaran dan cek status identitas pelaku usaha perikanan.</p>
                        <span class="service-link">
                            Buka Portal <i class="fas fa-arrow-right"></i>
                        </span>
                    </a>
                </div>

                <!-- SIMATA -->
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="150">
                    <a href="#statistik" class="service-card">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/logoku.png" alt="SIMATA" class="service-logo">
                        <h4>SIMATA</h4>
                        <p>Sistem Manajemen & Pemetaan Data. Monitoring data nelayan dan potensi tangkapan dalam satu peta.</p>
                        <span class="service-link">
                            Lihat Peta Data <i class="fas fa-arrow-right"></i>
                        </span>
                    </a>
                </div>

                <!-- KILAT -->
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="200">
                    <a href="https://www.dinasperikanansitubondo.com/kilat" target="_blank" class="service-card">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/kilat.png" alt="KILAT" class="service-logo">
                        <h4>KILAT</h4>
                        <p>Kamera Interaktif Lacak Aktifitas Terkini. Dokumentasi kegiatan dengan watermark lokasi dan waktu otomatis.</p>
                        <span class="service-link">
                            Akses Kamera <i class="fas fa-arrow-right"></i>
                        </span>
                    </a>
                </div>

                <!-- SISMAT -->
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="250">
                    <a href="https://www.dinasperikanansitubondo.com/sismat" target="_blank" class="service-card">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/surat.png" alt="SISMAT" class="service-logo">
                        <h4>SISMAT</h4>
                        <p>Sistem Manajemen Surat. Layanan administrasi dan persuratan digital dinas perikanan.</p>
                        <span class="service-link">
                            Buka Aplikasi <i class="fas fa-arrow-right"></i>
                        </span>
                    </a>
                </div>

                <!-- Bantuan Sarpras -->
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="300">
                    <a href="https://www.dinasperikanansitubondo.com/barjas" target="_blank" class="service-card">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/kapal.png" alt="Bantuan Sarpras" class="service-logo">
                        <h4>Bantuan Sarpras</h4>
                        <p>Informasi dan pengajuan bantuan sarana prasarana seperti mesin, jaring, dan perahu nelayan.</p>
                        <span class="service-link">
                            Akses Aplikasi <i class="fas fa-arrow-right"></i>
                        </span>
                    </a>
                </div>

                <!-- Peraturan KKP -->
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="350">
                    <a href="https://www.dinasperikanansitubondo.com/peraturankkp" class="service-card">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/peraturan.png" alt="Peraturan KKP" class="service-logo">
                        <h4>Peraturan KKP</h4>
                        <p>Akses kumpulan peraturan dan kebijakan Kementerian Kelautan dan Perikanan.</p>
                        <span class="service-link">
                            Lihat Peraturan <i class="fas fa-arrow-right"></i>
                        </span>
                    </a>
                </div>

                <!-- Galeri Kegiatan -->
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="400">
                    <div class="service-card" onclick="window.open('https://www.dinasperikanansitubondo.com/kegiatan/', '_blank')">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/galeri.png" alt="Galeri" class="service-logo">
                        <h4>Galeri Kegiatan</h4>
                        <p>Lihat dokumentasi kegiatan lapangan, pelatihan, dan program pemberdayaan nelayan Situbondo.</p>
                        
                        <div class="gallery-grid">
                            <!-- Foto 1-9 -->
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(0)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto1.jpeg" alt="Kegiatan 1" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(1)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto2.jpeg" alt="Kegiatan 2" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(2)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto3.jpeg" alt="Kegiatan 3" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(3)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto4.jpeg" alt="Kegiatan 4" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(4)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto5.jpeg" alt="Kegiatan 5" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(5)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto6.jpeg" alt="Kegiatan 6" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(6)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto7.jpeg" alt="Kegiatan 7" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(7)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto8.jpeg" alt="Kegiatan 8" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                            <div class="gallery-item" onclick="event.stopPropagation(); openLightbox(8)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto9.jpeg" alt="Kegiatan 9" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus fa-lg"></i>
                                </div>
                            </div>
                        </div>
                        
                        <span class="service-link">
                            Lihat Galeri Lengkap <i class="fas fa-arrow-right"></i>
                        </span>
                    </div>
                </div>

                <!-- Layanan Aduan -->
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="450">
                    <a href="#aduan" class="service-card">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/layanan%20info.png" alt="Layanan Aduan" class="service-logo">
                        <h4>Layanan Aduan</h4>
                        <p>Sampaikan aspirasi, keluhan, atau permohonan informasi langsung kepada dinas secara online.</p>
                        <span class="service-link">
                            Isi Formulir <i class="fas fa-arrow-down"></i>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Map Statistics Section -->
    <section id="statistik" class="map-section">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <span class="subtitle">Data Statistik</span>
                <h2>Peta Statistik Nelayan Kab. Situbondo</h2>
                <div class="divider"></div>
                <p class="description">Visualisasi Data Bantuan Nelayan Berbasis Peta Digital - Sistem Pemantauan Terintegrasi</p>
            </div>

            <div class="map-container" data-aos="fade-up" data-aos-delay="100">
                <div class="map-header">
                    <div class="map-title">
                        <i class="fas fa-map-marked-alt"></i>
                        <h2>Peta Statistik Nelayan Kab. Situbondo</h2>
                    </div>
                    <p class="map-subtitle">Visualisasi Data Bantuan Nelayan Berbasis Peta Digital - Sistem Pemantauan Terintegrasi</p>
                    
                    <div class="metadata-grid">
                        <div class="meta-card">
                            <i class="fas fa-calendar-alt"></i>
                            <div class="meta-content">
                                <h4 id="lastUpdate">9 Desember 2025</h4>
                                <p>Terakhir Update</p>
                            </div>
                        </div>
                        <div class="meta-card">
                            <i class="fas fa-village"></i>
                            <div class="meta-content">
                                <h4 id="totalDesa">27</h4>
                                <p>Total Desa</p>
                            </div>
                        </div>
                        <div class="meta-card">
                            <i class="fas fa-users"></i>
                            <div class="meta-content">
                                <h4 id="totalPenerima">393</h4>
                                <p>Total Penerima</p>
                            </div>
                        </div>
                        <div class="meta-card">
                            <i class="fas fa-box"></i>
                            <div class="meta-content">
                                <h4 id="totalBantuan">424</h4>
                                <p>Total Bantuan</p>
                            </div>
                        </div>
                        <div class="meta-card">
                            <i class="fas fa-sync-alt"></i>
                            <div class="meta-content">
                                <h4 id="autoReloadStatus">Aktif</h4>
                                <p>Auto-update</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="map-body">
                    <div class="map-sidebar">
                        <div class="map-tabs">
                            <div class="map-tab active" data-tab="stats">Statistik</div>
                            <div class="map-tab" data-tab="desa">Daftar Desa</div>
                            <div class="map-tab" data-tab="charts">Grafik</div>
                        </div>

                        <!-- Stats Tab -->
                        <div class="tab-content active" id="stats-tab">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchDesa" placeholder="Cari desa atau kecamatan...">
                            </div>

                            <div class="stats-card">
                                <h4><i class="fas fa-chart-bar"></i> Ringkasan Statistik</h4>
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-value" id="summaryDesa">27</div>
                                        <div class="stat-label">Desa Terdata</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="summaryPenerima">393</div>
                                        <div class="stat-label">Penerima Bantuan</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="summaryBarang">424</div>
                                        <div class="stat-label">Bantuan Barang</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="summaryUang">0</div>
                                        <div class="stat-label">Bantuan Uang</div>
                                    </div>
                                </div>
                            </div>

                            <div class="stats-card">
                                <h4><i class="fas fa-star"></i> Top 5 Desa Penerima</h4>
                                <div id="topDesaList"></div>
                            </div>
                        </div>

                        <!-- Desa Tab -->
                        <div class="tab-content" id="desa-tab">
                            <div class="desa-list-container">
                                <div class="desa-header">
                                    <span>Nama Desa</span>
                                    <span>Penerima</span>
                                </div>
                                <div id="desaList"></div>
                            </div>
                        </div>

                        <!-- Charts Tab -->
                        <div class="tab-content" id="charts-tab">
                            <div class="stats-card">
                                <h4><i class="fas fa-chart-pie"></i> Distribusi Bantuan</h4>
                                <div style="height: 200px;">
                                    <canvas id="bantuanChart"></canvas>
                                </div>
                            </div>

                            <div class="stats-card">
                                <h4><i class="fas fa-chart-line"></i> Tren Tahun Distribusi</h4>
                                <div style="height: 200px;">
                                    <canvas id="tahunChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="map-area">
                        <div id="statistikMap"></div>

                        <div class="map-controls">
                            <button class="control-btn" id="reloadBtn">
                                <i class="fas fa-sync-alt"></i> Update Data
                            </button>
                            <button class="control-btn" id="resetViewBtn">
                                <i class="fas fa-globe-asia"></i> Reset Peta
                            </button>
                            <button class="control-btn" id="fullscreenBtn">
                                <i class="fas fa-expand"></i> Layar Penuh
                            </button>
                        </div>

                        <div class="map-legend">
                            <h5><i class="fas fa-map-pin"></i> Kepadatan Penerima</h5>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: var(--danger);"></div>
                                <span>Tinggi (50 penerima)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: var(--warning);"></div>
                                <span>Sedang (20-49 penerima)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: var(--success);"></div>
                                <span>Rendah (19 penerima)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="map-footer">
                    <div class="footer-content">
                        <div class="footer-badge">
                            <i class="fas fa-fish"></i>
                            <span>Sistem Bantuan Nelayan Kab. Situbondo</span>
                        </div>
                        <div>
                            <div class="footer-badge me-2">
                                <i class="fas fa-database"></i>
                                <span>Sumber Data: Dinas Perikanan Kab. Situbondo</span>
                            </div>
                            <div class="footer-badge">
                                <i class="fas fa-code"></i>
                                <span>Aplikasi Peta Statistik v3.0</span>
                            </div>
                        </div>
                        <div class="footer-badge">
                            <i class="fas fa-sync-alt"></i>
                            <span>Auto-update: <strong id="footerReloadStatus">Aktif</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Form Section -->
    <section id="aduan" class="form-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xl-10">
                    <div class="form-wrapper" data-aos="zoom-in">
                        <div class="row g-0">
                            <div class="col-lg-4 form-sidebar">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/logo%20pemberdayaan%20nelayan.png" 
                                     alt="Logo Pemberdayaan Nelayan" class="form-logo">
                                <h3>Pusat Bantuan</h3>
                                <p>Data yang Anda kirimkan akan diteruskan ke sistem WhatsApp Center kami. Privasi pelapor dijamin aman.</p>
                                
                                <div class="feature-list">
                                    <div class="feature-item">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Respon Cepat</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-user-shield"></i>
                                        <span>Data Aman</span>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fab fa-whatsapp"></i>
                                        <span>Langsung ke Admin</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-8 form-content">
                                <h4>Formulir Pengaduan</h4>
                                <form id="waForm" onsubmit="kirimKeWA(event)">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Nama Lengkap <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="nama" placeholder="Nama Sesuai KTP" required>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <label class="form-label">NIK (16 Digit) <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="nik" placeholder="Masukkan NIK" required>
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label">Nomor WhatsApp <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="whatsapp" placeholder="0812xxxx" required>
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label">Email <small>(Opsional)</small></label>
                                            <input type="email" class="form-control" id="email" placeholder="nama@email.com">
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">Alamat Lengkap <span class="text-danger">*</span></label>
                                            <textarea class="form-control" id="alamat" rows="2" placeholder="Desa, Kecamatan, Kabupaten..." required></textarea>
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">Isi Laporan / Perihal <span class="text-danger">*</span></label>
                                            <textarea class="form-control" id="perihal" rows="4" placeholder="Tuliskan detail laporan Anda di sini..." required></textarea>
                                        </div>

                                        <div class="col-12">
                                            <button type="submit" class="btn-submit">
                                                <i class="fab fa-whatsapp fa-lg"></i> KIRIM SEKARANG
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-wave">
            <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
                <path d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
        </div>

        <div class="container footer-main">
            <div class="row gy-5">
                <div class="col-lg-5">
                    <div class="footer-brand">
                        <i class="fas fa-ship"></i>
                        <div>
                            <h4>DINAS PERIKANAN</h4>
                            <small>KABUPATEN SITUBONDO</small>
                        </div>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.9);">
                        Berkomitmen untuk memajukan sektor perikanan tangkap dan memberdayakan masyarakat pesisir melalui pelayanan yang transparan, akuntabel, dan inovatif.
                    </p>
                    <div class="d-flex gap-2 mt-4">
                        <a href="#" class="btn btn-outline-light rounded-circle" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="btn btn-outline-light rounded-circle" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://www.dinasperikanansitubondo.com" class="btn btn-outline-light rounded-circle" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-globe"></i>
                        </a>
                    </div>
                </div>

                <div class="col-lg-3">
                    <div class="footer-links">
                        <h5>Tautan Cepat</h5>
                        <ul>
                            <li><a href="#"><i class="fas fa-chevron-right fa-xs"></i> Beranda</a></li>
                            <li><a href="#layanan"><i class="fas fa-chevron-right fa-xs"></i> Layanan Kami</a></li>
                            <li><a href="#statistik"><i class="fas fa-chevron-right fa-xs"></i> SIMATA</a></li>
                            <li><a href="#aduan"><i class="fas fa-chevron-right fa-xs"></i> Pengaduan</a></li>
                            <li><a href="https://situbondokab.go.id/" target="_blank"><i class="fas fa-chevron-right fa-xs"></i> Pemkab Situbondo</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="footer-links">
                        <h5>Kontak Kami</h5>
                        <div class="contact-info">
                            <div class="contact-item">
                                <div class="contact-icon"><i class="fas fa-map-marker-alt"></i></div>
                                <div>
                                    <span class="d-block fw-bold">Alamat Kantor</span>
                                    <small>Jl. PB Sudirman No.77 C, Situbondo, Jawa Timur 68312</small>
                                </div>
                            </div>
                            <div class="contact-item">
                                <div class="contact-icon"><i class="fas fa-phone-alt"></i></div>
                                <div>
                                    <span class="d-block fw-bold">Telepon / WhatsApp</span>
                                    <small>0878-6561-4222</small>
                                </div>
                            </div>
                            <div class="contact-item">
                                <div class="contact-icon"><i class="fas fa-clock"></i></div>
                                <div>
                                    <span class="d-block fw-bold">Jam Pelayanan</span>
                                    <small>Senin - Jumat: 08.00 - 15.00 WIB</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-md-start mb-2 mb-md-0">
                        &copy; 2025 <strong>Dinas Perikanan Situbondo</strong>. All Rights Reserved.
                    </div>
                    <div class="col-md-6 text-md-end">
                        <small>Bidang Pemberdayaan Nelayan</small>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal for Village Details -->
    <div class="modal fade" id="villageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Detail Desa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="zoomToLocation">Zoom ke Lokasi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div class="modal fade" id="lightboxModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Galeri Kegiatan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="lightboxImage" src="" alt="" class="img-fluid">
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" id="prevBtn">
                        <i class="fas fa-chevron-left"></i> Sebelumnya
                    </button>
                    <span id="imageCounter"></span>
                    <button type="button" class="btn btn-secondary" id="nextBtn">
                        Selanjutnya <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
        // ============================================
        // CONFIGURATION & INITIALIZATION
        // ============================================
        const CONFIG = {
            autoReload: true,
            reloadInterval: 300000, // 5 menit (300,000 ms)
            maxMarkers: 100,
            defaultZoom: 10,
            situbondoCenter: [-7.7069, 113.6347],
            mapTiles: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            mapAttribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        };

        // State Management
        const AppState = {
            map: null,
            markers: [],
            layerGroup: null,
            villageData: [],
            charts: { bantuan: null, tahun: null },
            currentVillageId: null,
            autoReloadInterval: null,
            updateCount: 0,
            currentLightboxIndex: 0,
            lightboxImages: [
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto1.jpeg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto2.jpeg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto3.jpeg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto4.jpeg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto5.jpeg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto6.jpeg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto7.jpeg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto8.jpeg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto9.jpeg'
            ]
        };

        // ============================================
        // INITIALIZATION FUNCTIONS
        // ============================================
        function initializeApp() {
            initializeAOS();
            initializeMap();
            initializeEventListeners();
            setupAutoUpdate();
            loadData();
            
            // Initial DOM setup
            updateUIElements();
            showNotification('Sistem siap digunakan', 'success');
        }

        function initializeAOS() {
            AOS.init({
                once: true,
                offset: 100,
                duration: 800,
                easing: 'ease-out-cubic'
            });
        }

        function initializeMap() {
            AppState.map = L.map('statistikMap').setView(CONFIG.situbondoCenter, CONFIG.defaultZoom);
            
            L.tileLayer(CONFIG.mapTiles, {
                attribution: CONFIG.mapAttribution,
                maxZoom: 18,
                minZoom: 8
            }).addTo(AppState.map);
            
            AppState.layerGroup = L.layerGroup().addTo(AppState.map);
            L.control.scale({ position: 'bottomleft' }).addTo(AppState.map);
        }

        function initializeEventListeners() {
            // Navbar scroll effect
            window.addEventListener('scroll', handleScroll);
            
            // Map controls
            document.getElementById('reloadBtn').addEventListener('click', reloadData);
            document.getElementById('resetViewBtn').addEventListener('click', resetMapView);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            
            // Map tabs
            document.querySelectorAll('.map-tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            // Search
            document.getElementById('searchDesa').addEventListener('input', handleSearch);
            
            // Lightbox
            document.getElementById('prevBtn').addEventListener('click', () => navigateLightbox(-1));
            document.getElementById('nextBtn').addEventListener('click', () => navigateLightbox(1));
            
            // Form submission
            document.getElementById('waForm').addEventListener('submit', handleFormSubmit);
            
            // Fullscreen change
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        }

        // ============================================
        // DATA MANAGEMENT
        // ============================================
        function loadData() {
            showLoading(true);
            
            // Try to load from window object first
            if (window.DATA_PETA_STATISTIK) {
                processData(window.DATA_PETA_STATISTIK);
                showLoading(false);
                return;
            }
            
            // Load from external file
            loadDataFile();
        }

        function loadDataFile() {
            const timestamp = Date.now();
            const script = document.createElement('script');
            script.src = `datapeta.js?t=${timestamp}`;
            
            script.onload = function() {
                if (window.DATA_PETA_STATISTIK) {
                    processData(window.DATA_PETA_STATISTIK);
                } else {
                    showNotification('Format data tidak valid', 'error');
                    console.error('Data tidak ditemukan');
                }
                showLoading(false);
            };
            
            script.onerror = function() {
                showNotification('Gagal memuat data', 'error');
                console.error('Gagal memuat file datapeta.js');
                showLoading(false);
                
                // Retry after 10 seconds
                setTimeout(loadDataFile, 10000);
            };
            
            document.head.appendChild(script);
        }

        function processData(data) {
            try {
                AppState.villageData = data.data || [];
                
                // Update metadata
                updateMetadata(data.metadata);
                
                // Update UI
                updateSummaryStats(data.summary);
                updateVillageList(AppState.villageData);
                updateTopVillages(AppState.villageData);
                updateCharts(AppState.villageData);
                updateMapMarkers(AppState.villageData);
                
                // Update UI elements
                updateUIElements();
                
                // Show success notification
                if (AppState.updateCount > 0) {
                    showNotification('Data berhasil diperbarui', 'success');
                }
                
                AppState.updateCount++;
            } catch (error) {
                console.error('Error processing data:', error);
                showNotification('Error memproses data', 'error');
            }
        }

        function reloadData() {
            // Remove old script
            const oldScripts = document.querySelectorAll('script[src^="datapeta.js"]');
            oldScripts.forEach(script => script.remove());
            
            showLoading(true);
            loadDataFile();
        }

        // ============================================
        // MAP FUNCTIONS
        // ============================================
        function updateMapMarkers(villages) {
            // Clear existing markers
            AppState.layerGroup.clearLayers();
            AppState.markers = [];
            
            // Limit markers for performance
            const displayData = villages.slice(0, CONFIG.maxMarkers);
            
            displayData.forEach(village => {
                if (!village.koordinat || !village.koordinat.lat || !village.koordinat.lng) {
                    return;
                }
                
                const markerColor = getColorByRecipients(village.jumlahPenerima);
                const markerIcon = createMarkerIcon(village.jumlahPenerima, markerColor);
                
                const marker = L.marker([village.koordinat.lat, village.koordinat.lng], {
                    icon: markerIcon,
                    title: `${village.desa}, ${village.kecamatan}`
                });
                
                marker.bindPopup(createPopupContent(village));
                marker.on('click', () => highlightVillage(village.id));
                
                marker.addTo(AppState.layerGroup);
                
                AppState.markers.push({
                    id: village.id,
                    marker: marker,
                    village: village
                });
            });
            
            // Fit bounds if markers exist
            if (AppState.markers.length > 0) {
                const bounds = L.latLngBounds(AppState.markers.map(m => m.marker.getLatLng()));
                AppState.map.fitBounds(bounds, { padding: [50, 50], maxZoom: 12 });
            }
        }

        function createMarkerIcon(count, color) {
            return L.divIcon({
                html: `
                    <div style="
                        background: ${color};
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        border: 3px solid white;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        font-size: 14px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-family: var(--font-heading);
                    ">
                        ${count}
                    </div>
                `,
                className: 'custom-marker',
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });
        }

        function createPopupContent(village) {
            return `
                <div style="max-width: 300px; padding: 10px;">
                    <h4 style="margin: 0 0 10px 0; color: var(--primary-blue);">
                        ${village.desa}, ${village.kecamatan}
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <p style="margin: 5px 0;">
                            <i class="fas fa-users" style="color: var(--accent-blue);"></i>
                            <strong>Penerima:</strong> ${village.jumlahPenerima} orang
                        </p>
                        <p style="margin: 5px 0;">
                            <i class="fas fa-box" style="color: var(--sunset-orange);"></i>
                            <strong>Bantuan:</strong> ${village.totalBantuanBarang} unit
                        </p>
                        <p style="margin: 5px 0;">
                            <i class="fas fa-calendar" style="color: var(--success);"></i>
                            <strong>Tahun:</strong> ${village.tahunDistribusi.map(t => t.tahun).join(', ')}
                        </p>
                    </div>
                    <button onclick="showVillageDetail('${village.id}')" style="
                        width: 100%;
                        padding: 10px;
                        background: linear-gradient(135deg, var(--accent-blue), var(--primary-blue));
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: bold;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'" 
                    onmouseout="this.style.transform='translateY(0)'">
                        <i class="fas fa-info-circle"></i> Lihat Detail
                    </button>
                </div>
            `;
        }

        function getColorByRecipients(count) {
            if (count >= 50) return 'var(--danger)';
            if (count >= 20) return 'var(--warning)';
            return 'var(--success)';
        }

        function highlightVillage(villageId) {
            // Reset all markers
            AppState.markers.forEach(m => {
                const markerEl = m.marker.getElement();
                if (markerEl) {
                    markerEl.style.transform = 'scale(1)';
                    markerEl.style.zIndex = '1';
                }
            });
            
            // Highlight selected marker
            const selected = AppState.markers.find(m => m.id === villageId);
            if (selected) {
                const markerEl = selected.marker.getElement();
                if (markerEl) {
                    markerEl.style.transform = 'scale(1.2)';
                    markerEl.style.zIndex = '1000';
                    markerEl.style.boxShadow = '0 0 20px rgba(0,0,0,0.5)';
                    
                    // Scroll to village in list
                    highlightVillageInList(villageId);
                }
            }
        }

        function resetMapView() {
            AppState.map.setView(CONFIG.situbondoCenter, CONFIG.defaultZoom);
            
            // Reset highlights
            AppState.markers.forEach(m => {
                const markerEl = m.marker.getElement();
                if (markerEl) {
                    markerEl.style.transform = 'scale(1)';
                    markerEl.style.zIndex = '1';
                }
                m.marker.closePopup();
            });
            
            // Reset list highlights
            document.querySelectorAll('.desa-item').forEach(item => {
                item.classList.remove('active');
            });
        }

        // ============================================
        // CHART FUNCTIONS
        // ============================================ 
        function updateCharts(villages) {
            updateDistributionChart(villages);
            updateYearChart(villages);
        }

        function updateDistributionChart(villages) {
            const ctx = document.getElementById('bantuanChart').getContext('2d');
            
            if (AppState.charts.bantuan) {
                AppState.charts.bantuan.destroy();
            }
            
            const counts = [0, 0, 0];
            villages.forEach(village => {
                if (village.jumlahPenerima >= 50) counts[0]++;
                else if (village.jumlahPenerima >= 20) counts[1]++;
                else counts[2]++;
            });
            
            AppState.charts.bantuan = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Tinggi (50)', 'Sedang (20-49)', 'Rendah (19)'],
                    datasets: [{
                        data: counts,
                        backgroundColor: ['var(--danger)', 'var(--warning)', 'var(--success)'],
                        borderWidth: 2,
                        borderColor: 'white'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'var(--text-muted)',
                                font: { size: 12 }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        function updateYearChart(villages) {
            const ctx = document.getElementById('tahunChart').getContext('2d');
            
            if (AppState.charts.tahun) {
                AppState.charts.tahun.destroy();
            }
            
            const yearMap = {};
            villages.forEach(village => {
                village.tahunDistribusi.forEach(year => {
                    yearMap[year.tahun] = (yearMap[year.tahun] || 0) + year.jumlah;
                });
            });
            
            const years = Object.keys(yearMap).sort();
            const data = years.map(year => yearMap[year]);
            
            AppState.charts.tahun = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Jumlah Penerima',
                        data: data,
                        backgroundColor: 'rgba(25, 118, 210, 0.8)',
                        borderColor: '#1976d2',
                        borderWidth: 2,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'var(--text-muted)'
                            },
                            grid: {
                                color: 'rgba(203, 213, 225, 0.5)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'var(--text-muted)'
                            },
                            grid: {
                                color: 'rgba(203, 213, 225, 0.5)'
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleFont: { family: 'var(--font-heading)' }
                        }
                    }
                }
            });
        }

        // ============================================
        // UI FUNCTIONS
        // ============================================
        function updateMetadata(metadata) {
            document.getElementById('lastUpdate').textContent = metadata.lastUpdate;
            document.getElementById('totalDesa').textContent = metadata.totalDesa;
            document.getElementById('totalPenerima').textContent = metadata.totalPenerima;
            document.getElementById('totalBantuan').textContent = metadata.totalBantuan || 0;
        }

        function updateSummaryStats(summary) {
            document.getElementById('summaryDesa').textContent = summary.totalDesa || 0;
            document.getElementById('summaryPenerima').textContent = summary.totalPenerima || 0;
            document.getElementById('summaryBarang').textContent = summary.totalBantuanBarang || 0;
            document.getElementById('summaryUang').textContent = summary.totalBantuanUang || 0;
        }

        function updateVillageList(villages) {
            const container = document.getElementById('desaList');
            container.innerHTML = '';
            
            const sorted = [...villages].sort((a, b) => b.jumlahPenerima - a.jumlahPenerima);
            
            sorted.forEach(village => {
                const item = document.createElement('div');
                item.className = 'desa-item';
                item.dataset.id = village.id;
                
                item.innerHTML = `
                    <div>
                        <div class="desa-name">${village.desa}, ${village.kecamatan}</div>
                        <small style="color: var(--text-muted);">${village.tahunDistribusi.map(t => t.tahun).join(', ')}</small>
                    </div>
                    <div class="desa-count">${village.jumlahPenerima}</div>
                `;
                
                item.addEventListener('click', () => {
                    AppState.currentVillageId = village.id;
                    showVillageDetail(village.id);
                    zoomToVillage(village.id);
                });
                
                container.appendChild(item);
            });
        }

        function updateTopVillages(villages) {
            const container = document.getElementById('topDesaList');
            container.innerHTML = '';
            
            const top5 = [...villages]
                .sort((a, b) => b.jumlahPenerima - a.jumlahPenerima)
                .slice(0, 5);
            
            top5.forEach((village, index) => {
                const item = document.createElement('div');
                item.className = 'desa-item';
                
                item.innerHTML = `
                    <div>
                        <div class="desa-name">
                            <span style="
                                background: ${getRankColor(index)};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 0.8rem;
                                margin-right: 8px;
                            ">${index + 1}</span>
                            ${village.desa}, ${village.kecamatan}
                        </div>
                        <div style="display: flex; gap: 15px; font-size: 0.875rem; color: var(--text-muted);">
                            <span><i class="fas fa-users"></i> ${village.jumlahPenerima}</span>
                            <span><i class="fas fa-box"></i> ${village.totalBantuanBarang}</span>
                        </div>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); showVillageDetail('${village.id}')">
                        <i class="fas fa-info"></i>
                    </button>
                `;
                
                container.appendChild(item);
            });
        }

        function getRankColor(index) {
            switch(index) {
                case 0: return '#FFD700'; // Gold
                case 1: return '#C0C0C0'; // Silver
                case 2: return '#CD7F32'; // Bronze
                default: return 'var(--primary-blue)';
            }
        }

        function highlightVillageInList(villageId) {
            document.querySelectorAll('.desa-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.id === villageId) {
                    item.classList.add('active');
                    item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        }

        function showVillageDetail(villageId) {
            const village = AppState.villageData.find(v => v.id === villageId);
            if (!village) return;
            
            AppState.currentVillageId = villageId;
            
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = `${village.desa}, ${village.kecamatan}`;
            
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong><i class="fas fa-users text-primary"></i> Jumlah Penerima:</strong>
                            <p class="fs-4 fw-bold">${village.jumlahPenerima} orang</p>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-box text-warning"></i> Total Bantuan Barang:</strong>
                            <p class="fs-4 fw-bold">${village.totalBantuanBarang} unit</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong><i class="fas fa-tags text-success"></i> Jenis Bantuan:</strong>
                            <p>${village.jenisBantuan.map(b => b.jenis).join(', ')}</p>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-calculator text-info"></i> Rata-rata Bantuan:</strong>
                            <p class="fs-4 fw-bold">${village.rataBantuan.toFixed(2)} unit/orang</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <strong><i class="fas fa-calendar text-danger"></i> Tahun Distribusi:</strong>
                    <div class="d-flex flex-wrap gap-2 mt-2">
                        ${village.tahunDistribusi.map(t => 
                            `<span class="badge bg-primary">${t.tahun} (${t.jumlah})</span>`
                        ).join('')}
                    </div>
                </div>
                
                <div class="mt-3">
                    <strong><i class="fas fa-layer-group text-secondary"></i> Kelompok Distribusi:</strong>
                    <div class="d-flex flex-wrap gap-2 mt-2">
                        ${village.kelompokDistribusi.map(k => 
                            `<span class="badge bg-info">${k.kelompok} (${k.jumlah})</span>`
                        ).join('')}
                    </div>
                </div>
                
                <div class="mt-3">
                    <strong><i class="fas fa-map-marker-alt text-success"></i> Koordinat:</strong>
                    <p class="mt-1">Latitude: ${village.koordinat.lat}, Longitude: ${village.koordinat.lng}</p>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('villageModal'));
            modal.show();
        }

        function zoomToVillage(villageId) {
            const marker = AppState.markers.find(m => m.id === villageId);
            if (marker) {
                AppState.map.setView(marker.marker.getLatLng(), 13);
                marker.marker.openPopup();
                highlightVillage(villageId);
            }
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function setupAutoUpdate() {
            if (!CONFIG.autoReload) return;
            
            AppState.autoReloadInterval = setInterval(() => {
                reloadData();
                showNotification('Data diperbarui secara otomatis', 'info');
            }, CONFIG.reloadInterval);
            
            updateUIElements();
        }

        function switchTab(tabName) {
            // Update tabs
            document.querySelectorAll('.map-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `${tabName}-tab`);
            });
        }

        function handleSearch(e) {
            const query = e.target.value.toLowerCase();
            const items = document.querySelectorAll('#desaList .desa-item');
            
            items.forEach(item => {
                const name = item.querySelector('.desa-name').textContent.toLowerCase();
                item.style.display = name.includes(query) ? 'flex' : 'none';
            });
        }

        function handleScroll() {
            const nav = document.getElementById('mainNav');
            if (window.scrollY > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }
        }

        function toggleFullscreen() {
            const container = document.querySelector('.map-container');
            
            if (!document.fullscreenElement) {
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.mozRequestFullScreen) {
                    container.mozRequestFullScreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }

        function handleFullscreenChange() {
            const btn = document.getElementById('fullscreenBtn');
            const isFullscreen = !!document.fullscreenElement;
            
            btn.innerHTML = isFullscreen 
                ? '<i class="fas fa-compress"></i> Keluar Layar Penuh'
                : '<i class="fas fa-expand"></i> Layar Penuh';
        }

        function showLoading(show) {
            const loading = document.getElementById('loadingScreen');
            if (show) {
                loading.classList.remove('hidden');
            } else {
                setTimeout(() => loading.classList.add('hidden'), 500);
            }
        }

        function showNotification(message, type = 'info') {
            const container = document.createElement('div');
            container.className = `notification ${type}`;
            container.innerHTML = `
                <i class="fas fa-${getNotificationIcon(type)}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(container);
            
            setTimeout(() => {
                container.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => container.remove(), 300);
            }, 4000);
        }

        function getNotificationIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                default: return 'info-circle';
            }
        }

        function updateUIElements() {
            const minutes = Math.floor(CONFIG.reloadInterval / 60000);
            document.getElementById('autoReloadStatus').textContent = CONFIG.autoReload ? 'Aktif' : 'Nonaktif';
            document.getElementById('footerReloadStatus').textContent = CONFIG.autoReload ? 'Aktif' : 'Nonaktif';
        }

        // ============================================
        // LIGHTBOX FUNCTIONS
        // ============================================
        function openLightbox(index) {
            AppState.currentLightboxIndex = index;
            updateLightbox();
            
            const modal = new bootstrap.Modal(document.getElementById('lightboxModal'));
            modal.show();
        }

        function updateLightbox() {
            const img = document.getElementById('lightboxImage');
            const counter = document.getElementById('imageCounter');
            
            img.src = AppState.lightboxImages[AppState.currentLightboxIndex];
            counter.textContent = `${AppState.currentLightboxIndex + 1} / ${AppState.lightboxImages.length}`;
        }

        function navigateLightbox(direction) {
            let newIndex = AppState.currentLightboxIndex + direction;
            
            if (newIndex < 0) newIndex = AppState.lightboxImages.length - 1;
            if (newIndex >= AppState.lightboxImages.length) newIndex = 0;
            
            AppState.currentLightboxIndex = newIndex;
            updateLightbox();
        }

        // ============================================
        // FORM FUNCTIONS
        // ============================================
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = {
                nama: document.getElementById('nama').value,
                nik: document.getElementById('nik').value,
                whatsapp: document.getElementById('whatsapp').value,
                email: document.getElementById('email').value || '-',
                alamat: document.getElementById('alamat').value,
                perihal: document.getElementById('perihal').value
            };
            
            // Validate NIK (16 digits)
            if (formData.nik.length !== 16) {
                showNotification('NIK harus 16 digit', 'error');
                return;
            }
            
            // Validate phone number
            if (formData.whatsapp.length < 10) {
                showNotification('Nomor WhatsApp tidak valid', 'error');
                return;
            }
            
            sendToWhatsApp(formData);
        }

        function sendToWhatsApp(data) {
            const phone = '6287865614222';
            const message = `
*LAPORAN PENGADUAN NELAYAN*
--------------------------------
*Nama:* ${data.nama}
*NIK:* ${data.nik}
*Alamat:* ${data.alamat}
*No. WA:* ${data.whatsapp}
*Email:* ${data.email}
--------------------------------
*Perihal / Isi Laporan:*
${data.perihal}
            `.trim();
            
            const url = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
            
            // Reset form
            document.getElementById('waForm').reset();
            showNotification('Formulir berhasil dikirim', 'success');
        }

        // ============================================
        // INITIALIZE APP
        // ============================================
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // Global functions for HTML onclick
        window.openLightbox = openLightbox;
        window.showVillageDetail = showVillageDetail;
        window.zoomToVillage = zoomToVillage;
        window.kirimKeWA = handleFormSubmit; // For backward compatibility
    </script>
</body>
</html>
