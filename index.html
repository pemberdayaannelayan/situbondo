<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Bidang Pemberdayaan Nelayan - Dinas Peternakan dan Perikanan Situbondo</title>
    <meta name="description" content="Website resmi Bidang Pemberdayaan Nelayan Dinas Peternakan dan Perikanan Kabupaten Situbondo. Layanan pengajuan KUSUKA, SIMPADAN TANGKAP, Bantuan Sarpras, dan Pengaduan Nelayan secara online.">
    <meta name="keywords" content="Dinas Peternakan dan Perikanan Situbondo, SIMPADAN TANGKAP Situbondo, Peta Nelayan, Pemberdayaan Nelayan, Kartu KUSUKA, Bantuan Kapal, Pengaduan Nelayan, Layanan Nelayan">
    <meta name="author" content="Dinas Peternakan dan Perikanan Situbondo">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#f97316">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.dinasperikanansitubondo.com/">
    <meta property="og:title" content="Layanan Pemberdayaan Nelayan - Situbondo">
    <meta property="og:description" content="Akses mudah data KUSUKA, SIMPADAN TANGKAP, Bantuan Sarpras, dan Saluran Aspirasi Masyarakat Pesisir Situbondo.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1583212292454-1fe6229603b7?q=80&w=2074&auto=format&fit=crop">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Leaflet CSS untuk peta -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Chart.js untuk statistik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Satisfy&display=swap" rel="stylesheet">
    
    <!-- Font Awesome & AOS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    
</head>
<body>

    <!-- Loading Screen -->
    <div class="loading hidden" id="loadingScreen">
        <div class="spinner"></div>
        <h2 style="color: var(--primary); margin-bottom: 10px;">Memuat Peta Statistik</h2>
        <p style="color: var(--gray-color); max-width: 400px; text-align: center;">
            Sedang memuat data statistik nelayan Kabupaten Situbondo...
        </p>
    </div>

    <nav class="navbar navbar-expand-lg fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-3" href="#">
                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/LOGO%20KABUPATEN%20SITUBONDO.png" alt="Logo Pemerintah Kabupaten Situbondo">
                <div class="brand-text d-flex flex-column">
                    <h5 class="fw-bold mb-0" style="font-size: 1.1rem; line-height: 1.2;">DINAS PETERNAKAN DAN PERIKANAN</h5>
                    <span class="fw-bold" style="font-size: 0.75rem; letter-spacing: 2px; text-transform: uppercase; color: var(--primary);">KABUPATEN SITUBONDO</span>
                </div>
                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/naikkelas.png" alt="Situbondo Naik Kelas" style="height: 55px; margin-left: 10px;">
                <!-- Foto Bupati dan Wakil Bupati di Header -->
                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto%20bupati%20dan%20wakil%20bupati.png" 
                     alt="Bupati dan Wakil Bupati Situbondo" 
                     class="bupati-navbar-img"
                     style="height: 45px; margin-left: 10px; border-radius: 8px; border: 2px solid var(--primary); transition: all 0.3s ease;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav align-items-center gap-2">
                    <li class="nav-item"><a class="nav-link active" href="#home">Beranda</a></li>
                    <li class="nav-item"><a class="nav-link" href="#layanan">Layanan</a></li>
                    
                    <li class="nav-item ms-lg-3">
                        <a href="#aduan" class="btn btn-cta">Hubungi Kami</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section id="home" class="hero-section">
        <div class="hero-overlay"></div>
        <div class="container hero-content">
            <div class="row">
                <div class="col-lg-7" data-aos="fade-right">
                    <!-- Foto Bupati dan Wakil Bupati di Hero Section dengan animasi -->
                    <div class="bupati-profile-animated">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto%20bupati%20dan%20wakil%20bupati.png" 
                             alt="Bupati dan Wakil Bupati Situbondo" 
                             class="bupati-hero-photo">
                        <div class="bupati-hero-info">
                            <h4>Yusuf Rio Wahyu Prayogo, S.Sos., M.SM.</h4>
                            <p class="bupati-title">BUPATI SITUBONDO</p>
                            <h4 style="margin-top: 15px;">Ulfiyah, S.Pd.I.</h4>
                            <p class="bupati-title">WAKIL BUPATI SITUBONDO</p>
                        </div>
                    </div>
                    
                    <div class="slogan-signature">
                        Pemberdayaan Nelayan
                    </div>
                    <h1 class="display-3 fw-bold mb-4" style="color: var(--text-main);">
                        Dari Hulu ke Hilir <span class="connector-text">untuk</span> <br>
                        <span class="text-orange-gradient">Situbondo Naik Kelas</span>
                    </h1>
                    
                    <p class="lead mb-5" style="color: var(--text-sub); font-weight: 500;">
                        Program kegiatan Bidang Bina Pemberdayaan Nelayan yg merujuk pada rantai nilai perikanan, mulai dari kegiatan penangkapan ikan di laut (hulu) hingga proses pengolahan, distribusi, pemasaran, hingga akhirnya sampai ke konsumen (hilir), yang tujuannya meningkatkan kesejahteraan nelayan melalui data basis  nelayan yang terintegrasi, pemberdayaan, dan dukungan infrastruktur agar nelayan tidak tertinggal dan memiliki perlindungan sosial.
                    </p>
                    <div class="d-flex gap-3">
                        <a href="#layanan" class="btn btn-cta px-4 py-3 shadow btn-pulse-primary">Layanan Kami</a>
                        <a href="https://portaldata.kkp.go.id/" target="_blank" class="btn btn-outline-primary px-4 py-3 rounded-pill fw-bold btn-pulse-outline" style="border-width: 2px;">Portal Data KKP</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="layanan" class="py-5">
        <div class="container py-5">
            <div class="text-center mb-5 section-header" data-aos="fade-up">
                <span class="text-primary fw-bold text-uppercase letter-spacing-2">Menu Layanan</span>
                <h2 class="display-6 mt-2">Akses Program Nelayan</h2>
                <div style="width: 80px; height: 4px; background: #f59e0b; margin: 15px auto; border-radius: 2px;"></div>
                <p class="text-muted col-lg-6 mx-auto">Pilih menu di bawah ini untuk mengakses layanan digital dan program bantuan pemerintah.</p>
            </div>

            <div class="row g-4">
                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="100">
                    <a href="https://portaldata.kkp.go.id/" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://portaldata.kkp.go.id/" data-title="Kartu KUSUKA - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://portaldata.kkp.go.id/" data-title="Kartu KUSUKA - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/kusuka.png" alt="Logo KUSUKA" class="menu-logo">
                        <h4 class="fw-bold mb-3">Kartu KUSUKA</h4>
                        <p class="text-muted">Akses Portal Data KKP untuk pendaftaran dan cek status identitas pelaku usaha perikanan (KUSUKA).</p>
                        <span class="card-link-text">Buka Portal <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>

                 <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="190">
                    <a href="https://srikandi.arsip.go.id/auth/login" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://srikandi.arsip.go.id/auth/login" data-title="SRIKANDI - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://srikandi.arsip.go.id/auth/login" data-title="SRIKANDI - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/logo-srikandi.png" alt="Logo SRIKANDI" class="menu-logo">
                        <h4 class="fw-bold mb-3">SRIKANDI</h4>
                        <p class="text-muted">Sistem Informasi Kearsipan Dinamis Terintegrasi.</p>
                        <span class="card-link-text">Buka Aplikasi <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>

                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="150">
                     <a href="https://www.dinasperikanansitubondo.com/simpadan/peta" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://www.dinasperikanansitubondo.com/simpadan" data-title="SIMPADAN TANGKAP - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://www.dinasperikanansitubondo.com/simpadan" data-title="SIMPADAN TANGKAP - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/logoku.png" alt="Logo SIMPADAN TANGKAP" class="menu-logo">
                        <h4 class="fw-bold mb-3">SIMPADAN TANGKAP</h4>
                        <p class="text-muted">Sistem Manajemen & Pemetaan Data Pemberdayaan Nelayan Tangkap.</p>
                        <span class="card-link-text">Lihat Peta Data <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>

                <!-- MENU BARU: PDF SMARTCONVERT -->
                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="250">
                    <a href="https://pdfcandy.com/" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://pdfcandy.com/" data-title="PDF SMARTCONVERT - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://pdfcandy.com/" data-title="PDF SMARTCONVERT - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/pdf-smart.png" alt="Logo PDF SMARTCONVERT" class="menu-logo">
                        <h4 class="fw-bold mb-3">PDF SMARTCONVERT</h4>
                        <p class="text-muted">Konversi PDF ke berbagai format (Word, Excel, JPG, dll) dan sebaliknya secara online.</p>
                        <span class="card-link-text">Buka Aplikasi <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>
                
                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="170">
                    <a href="https://www.dinasperikanansitubondo.com/kilat" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://www.dinasperikanansitubondo.com/kilat" data-title="KILAT - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://www.dinasperikanansitubondo.com/kilat" data-title="KILAT - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/kilat.png" alt="Logo KILAT" class="menu-logo">
                        <h4 class="fw-bold mb-3">KILAT</h4>
                        <p class="text-muted">Kamera Interaktif Lacak Aktifitas Terkini. Aplikasi dokumentasi kegiatan dengan watermark lokasi dan waktu otomatis.</p>
                        <span class="card-link-text">Akses Kamera <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>
               
                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="200">
                    <a href="https://www.dinasperikanansitubondo.com/barjas" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://www.dinasperikanansitubondo.com/barjas" data-title="Bantuan Sarpras - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://www.dinasperikanansitubondo.com/barjas" data-title="Bantuan Sarpras - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/kapal.png" alt="Logo Bantuan Sarpras" class="menu-logo">
                        <h4 class="fw-bold mb-3">Bantuan Sarpras</h4>
                        <p class="text-muted">Informasi dan pengajuan bantuan sarana prasarana seperti mesin, jaring, dan perahu nelayan.</p>
                        <span class="card-link-text">Akses Aplikasi <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>

                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="210">
                    <a href="https://www.dinasperikanansitubondo.com/peraturankkp" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://www.dinasperikanansitubondo.com/peraturankkp" data-title="Peraturan Kemen-KP - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://www.dinasperikanansitubondo.com/peraturankkp" data-title="Peraturan Kemen-KP - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/peraturan.png" alt="Logo Peraturan Kemen-KP" class="menu-logo">
                        <h4 class="fw-bold mb-3">Peraturan Kemen-KP</h4>
                        <p class="text-muted">Akses kumpulan peraturan dan kebijakan Kementerian Kelautan dan Perikanan yang berlaku untuk nelayan dan pelaku usaha perikanan.</p>
                        <span class="card-link-text">Lihat Peraturan <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>
               
                <!-- MENU BARU: UMKM Situbondo -->
                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="240">
                    <a href="https://www.dinasperikanansitubondo.com/umkm" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://www.dinasperikanansitubondo.com/umkm" data-title="UMKM Situbondo - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://www.dinasperikanansitubondo.com/umkm" data-title="UMKM Situbondo - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://github.com/anekamarket/my.id/blob/main/LOGO%20UMKM%20SITUBONDO.png?raw=true" alt="Logo UMKM Situbondo" class="menu-logo">
                        <h4 class="fw-bold mb-3">UMKM Situbondo</h4>
                        <p class="text-muted">Layanan gratis untuk seluruh UMKM Situbondo, prioritas masyarakat pesisir. Dukungan pengembangan usaha mikro, kecil, dan menengah di bidang perikanan.</p>
                        <span class="card-link-text">Akses Layanan <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>

                <!-- MENU BARU: APLIKASI UMKM LINK -->
                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="260">
                    <a href="https://www.aplikasiusaha.com/umkm" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://www.aplikasiusaha.com/umkm" data-title="APLIKASI UMKM LINK - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://www.aplikasiusaha.com/umkm" data-title="APLIKASI UMKM LINK - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/umkm-link.png" alt="Logo UMKM LINK" class="menu-logo">
                        <h4 class="fw-bold mb-3">APLIKASI UMKM LINK</h4>
                        <p class="text-muted">Sistem kasir digital terintegrasi untuk pencatatan transaksi dan manajemen keuangan UMKM. Akses dengan kredensial: <strong>Username: admin</strong>, <strong>Password: Situbondo-Naik-Kelas</strong>.</p>
                        <span class="card-link-text">Akses Aplikasi <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>

                 <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="230">
                    <a href="https://www.dinasperikanansitubondo.com/kegiatan/" target="_blank" class="service-card">
                        <!-- Tombol Share yang Diperbaiki -->
                        <div class="share-btn-container">
                            <button class="share-btn share-btn-copy" data-url="https://www.dinasperikanansitubondo.com/kegiatan/" data-title="Galeri Kegiatan - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Salin Link">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="share-btn share-btn-whatsapp" data-url="https://www.dinasperikanansitubondo.com/kegiatan/" data-title="Galeri Kegiatan - Dinas Peternakan dan Perikanan Situbondo" data-tooltip="Bagikan via WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/galeri.png" alt="Logo Galeri" class="menu-logo">
                        <h4 class="fw-bold mb-3">Galeri Kegiatan</h4>
                        <p class="text-muted">Lihat dokumentasi kegiatan lapangan, pelatihan, dan program pemberdayaan nelayan Situbondo.</p>
                        
                        <!-- Grid Thumbnail Galeri dengan Lightbox -->
                        <div class="gallery-thumbnail-container">
                            <!-- Foto 1 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(0)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto1.jpeg" alt="Kegiatan 1" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <!-- Foto 2 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(1)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto2.jpeg" alt="Kegiatan 2" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <!-- Foto 3 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(2)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto3.jpeg" alt="Kegiatan 3" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <!-- Foto 4 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(3)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto4.jpeg" alt="Kegiatan 4" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <!-- Foto 5 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(4)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto5.jpeg" alt="Kegiatan 5" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <!-- Foto 6 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(5)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto6.jpeg" alt="Kegiatan 6" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <!-- Foto 7 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(6)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto7.jpeg" alt="Kegiatan 7" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <!-- Foto 8 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(7)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto8.jpeg" alt="Kegiatan 8" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                            <!-- Foto 9 -->
                            <div class="gallery-thumbnail-item" onclick="event.stopPropagation(); openLightbox(8)">
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto9.jpeg" alt="Kegiatan 9" loading="lazy">
                                <div class="gallery-overlay">
                                    <i class="fas fa-search-plus"></i>
                                </div>
                            </div>
                        </div>
                        
                        <span class="card-link-text">Lihat Galeri Lengkap <i class="fas fa-arrow-right"></i></span>
                    </a>
                </div>
                
                <div class="col-xl-4 col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="330">
                    <a href="#aduan" class="service-card">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/layanan%20info.png" alt="Logo Layanan Aduan" class="menu-logo">
                        <h4 class="fw-bold mb-3">Layanan Aduan</h4>
                        <p class="text-muted">Sampaikan aspirasi, keluhan, atau permohonan informasi langsung kepada dinas secara online.</p>
                        <span class="card-link-text">Isi Formulir <i class="fas fa-arrow-down"></i></span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Peta Statistik Section -->
    <section id="statistik" class="peta-section">
        <div class="container">
            <div class="text-center mb-5 section-header" data-aos="fade-up">
                <span class="text-primary fw-bold text-uppercase letter-spacing-2">Data Statistik</span>
                <h2 class="display-6 mt-2">Peta Data Bantuan Nelayan Kabupaten Situbondo</h2>
                <div style="width: 80px; height: 4px; background: #f59e0b; margin: 15px auto; border-radius: 2px;"></div>
                <p class="text-muted col-lg-6 mx-auto">Visualisasi Data Bantuan Nelayan Berbasis Peta Digital - Sistem Pemantauan Terintegrasi</p>
            </div>

            <div class="peta-statistik-container">
                <div class="peta-statistik-header">
                    <div class="header-bg"></div>
                    <div class="header-content">
                        <h1 class="peta-statistik-title"><i class="fas fa-map-marked-alt"></i> Statistik Data Bantuan Nelayan Kabupaten Situbondo</h1>
                        <div class="peta-subtitle">Visualisasi Data Bantuan Nelayan Berbasis Peta Digital - Sistem Pemantauan Terintegrasi</div>
                        <div class="metadata">
                            <div class="meta-item"><i class="fas fa-calendar-alt"></i> Terakhir Update: <span id="lastUpdate">9 Desember 2025</span></div>
                            <div class="meta-item"><i class="fas fa-village"></i> Total Desa: <span id="totalDesa">27</span></div>
                            <div class="meta-item"><i class="fas fa-users"></i> Total Penerima: <span id="totalPenerima">393</span></div>
                            <div class="meta-item"><i class="fas fa-box"></i> Total Bantuan: <span id="totalBantuan">424</span> Unit</div>
                            <div class="meta-item"><i class="fas fa-sync-alt"></i> Auto-update: <span id="autoReloadStatus">Aktif</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="peta-content d-flex">
                    <div class="peta-sidebar">
                        <div class="tabs">
                            <div class="tab active" data-tab="stats">Statistik</div>
                            <div class="tab" data-tab="desa">Daftar Desa</div>
                            <div class="tab" data-tab="charts">Grafik</div>
                        </div>
                        
                        <div class="tab-content active" id="stats-tab">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="searchDesa" placeholder="Cari desa atau kecamatan...">
                            </div>
                            
                            <div class="stats-box">
                                <div class="stats-title"><i class="fas fa-chart-bar"></i> Ringkasan Statistik</div>
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-value" id="summaryDesa">27</div>
                                        <div class="stat-label">Desa Terdata</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="summaryPenerima">393</div>
                                        <div class="stat-label">Penerima Bantuan</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="summaryBarang">424</div>
                                        <div class="stat-label">Bantuan Barang</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="summaryUang">0</div>
                                        <div class="stat-label">Bantuan Uang</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stats-box">
                                <div class="stats-title"><i class="fas fa-star"></i> Top 5 Desa Penerima</div>
                                <div id="topDesaList">
                                    <!-- Akan diisi oleh JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="desa-tab">
                            <div class="stats-box">
                                <div class="stats-title"><i class="fas fa-list"></i> Daftar Desa/Kelurahan</div>
                                <div class="desa-list-header">
                                    <span>Nama Desa</span>
                                    <span>Penerima</span>
                                </div>
                                <div class="desa-list" id="desaList">
                                    <!-- Akan diisi oleh JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="charts-tab">
                            <div class="stats-box">
                                <div class="stats-title"><i class="fas fa-chart-pie"></i> Distribusi Bantuan</div>
                                <div class="chart-container">
                                    <canvas id="bantuanChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="stats-box">
                                <div class="stats-title"><i class="fas fa-chart-line"></i> Tren Tahun Distribusi</div>
                                <div class="chart-container">
                                    <canvas id="tahunChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="peta-map-container">
                        <div id="statistikMap"></div>
                        
                        <div class="peta-controls">
                            <!-- TOMBOL BARU: Cek Detail Data Peta -->
                            <a href="https://www.dinasperikanansitubondo.com/petabantuan" target="_blank" class="control-btn btn-detail-peta" id="detailDataBtn">
                                <i class="fas fa-info-circle"></i> <span class="btn-text">Cek Detail Data Peta</span>
                            </a>
                            <!-- TOMBOL BARU: Reload Data -->
                            <button class="control-btn btn-reload-data" id="reloadDataBtn">
                                <i class="fas fa-download"></i> <span class="btn-text">Reload Data</span>
                            </button>
                            <button class="control-btn" id="reloadBtn">
                                <i class="fas fa-sync-alt"></i> <span class="btn-text">Update Data</span>
                            </button>
                            <button class="control-btn" id="resetViewBtn">
                                <i class="fas fa-globe-asia"></i> <span class="btn-text">Reset Peta</span>
                            </button>
                            <button class="control-btn" id="fullscreenBtn">
                                <i class="fas fa-expand"></i> <span class="btn-text">Layar Penuh</span>
                            </button>
                        </div>
                        
                        <div class="peta-legend">
                            <div class="legend-title"><i class="fas fa-map-pin"></i> Kepadatan Penerima</div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: var(--danger-color);"></div>
                                <div class="legend-label">Tinggi (≥ 50 penerima)</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: var(--warning-color);"></div>
                                <div class="legend-label">Sedang (20-49 penerima)</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background-color: var(--success-color);"></div>
                                <div class="legend-label">Rendah (≤ 19 penerima)</div>
                            </div>
                        </div>
                        
                        <div class="auto-update-info">
                            <i class="fas fa-sync-alt"></i> Data diperbarui setiap <span id="reloadInterval">300</span> detik (5 menit)
                        </div>
                    </div>
                </div>
                
                <div class="peta-footer">
                    <div class="peta-footer-content">
                        <div class="peta-footer-logo">
                            <i class="fas fa-ship"></i> Dinas Peternakan dan Perikanan Situbondo
                        </div>
                        <div class="footer-info">
                            <div class="footer-info-item">
                                <i class="fas fa-map-marker-alt"></i> Data Center: Jl. PB Sudirman No.77 C, Situbondo
                            </div>
                            <div class="footer-info-item">
                                <i class="fas fa-clock"></i> Terakhir Update: <span id="footerUpdate">9 Desember 2025 pukul 23.35</span>
                            </div>
                            <div class="footer-info-item">
                                <i class="fas fa-clock"></i> Auto-update: <span id="footerReloadStatus" style="color: #22c55e; font-weight: bold;">Aktif</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="aduan" class="aduan-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xl-10">
                    <div class="form-container" data-aos="zoom-in">
                        <div class="row g-0">
                            <div class="col-lg-4 info-panel d-flex flex-column justify-content-center">
                                <!-- LOGO PEMBERDAYAAN NELAYAN DIATAS TEKS -->
                                <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/logo%20pemberdayaan%20nelayan.png" alt="Logo Pemberdayaan Nelayan" class="info-panel-logo">
                                
                                <h3 class="fw-bold mb-4 text-center">Pusat Bantuan</h3>
                                <p class="mb-4 text-center">Data yang Anda kirimkan akan diteruskan ke sistem WhatsApp Center kami. Privasi pelapor dijamin aman.</p>
                                
                                <div class="mt-4">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-check-circle text-warning me-3 fa-lg"></i>
                                        <span class="fw-bold">Respon Cepat</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-user-shield text-warning me-3 fa-lg"></i>
                                        <span class="fw-bold">Data Aman</span>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <i class="fab fa-whatsapp text-warning me-3 fa-lg"></i>
                                        <span class="fw-bold">Langsung ke Admin</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-8 form-panel">
                                <h4 class="fw-bold mb-4 text-dark">Formulir Pengaduan</h4>
                                <form id="waForm" onsubmit="kirimKeWA(event)">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Nama Lengkap <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="nama" placeholder="Nama Sesuai KTP" required>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <label class="form-label">NIK (16 Digit) <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="nik" placeholder="Masukkan NIK" required>
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label">Nomor WhatsApp <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="whatsapp" placeholder="0812xxxx" required>
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label">Email <small class="text-muted fw-normal">(Opsional)</small></label>
                                            <input type="email" class="form-control" id="email" placeholder="nama@email.com">
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">Alamat Lengkap <span class="text-danger">*</span></label>
                                            <textarea class="form-control" id="alamat" rows="2" placeholder="Desa, Kecamatan, Kabupaten..." required></textarea>
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">Isi Laporan / Perihal <span class="text-danger">*</span></label>
                                            <textarea class="form-control" id="perihal" rows="4" placeholder="Tuliskan detail laporan Anda di sini..." required></textarea>
                                        </div>

                                        <div class="col-12 mt-4">
                                            <button type="submit" class="btn btn-wa">
                                                <i class="fab fa-whatsapp fa-lg"></i> KIRIM SEKARANG
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-wave">
            <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
                <path fill-opacity="1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
        </div>

        <div class="container footer-content">
            <div class="row gy-5">
                <div class="col-lg-5 col-md-12">
                    <div class="d-flex align-items-center gap-3 mb-4">
                        <i class="fas fa-ship fa-3x text-white"></i> 
                        <div>
                            <h4 class="text-white mb-0 fw-bold" style="font-size: 1.3rem; line-height: 1.2;">DINAS PETERNAKAN DAN PERIKANAN</h4>
                            <small class="text-white" style="letter-spacing: 2px; font-weight: 600;">KABUPATEN SITUBONDO</small>
                        </div>
                    </div>
                    <p class="pe-lg-5 text-white" style="line-height: 1.8;">
                        Berkomitmen untuk memajukan sektor perikanan tangkap dan memberdayakan masyarakat pesisir melalui pelayanan yang transparan, akuntabel, dan inovatif.
                    </p>
                    <div class="social-media-icons">
                        <a href="#" class="social-icon">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fas fa-globe"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <h5 class="text-white">Tautan Cepat</h5>
                    <ul class="list-unstyled footer-links mt-3">
                        <li><a href="#home" class="text-white"><i class="fas fa-chevron-right fa-xs"></i> Beranda</a></li>
                        <li><a href="#layanan" class="text-white"><i class="fas fa-chevron-right fa-xs"></i> Layanan Kami</a></li>
                        <li><a href="#statistik" class="text-white"><i class="fas fa-chevron-right fa-xs"></i> SIMPADAN TANGKAP</a></li>
                        <li><a href="https://www.dinasperikanansitubondo.com/kegiatan/" target="_blank" class="text-white"><i class="fas fa-chevron-right fa-xs"></i> Dokumentasi Kegiatan</a></li>
                        <li><a href="https://www.dinasperikanansitubondo.com/peraturankkp" target="_blank" class="text-white"><i class="fas fa-chevron-right fa-xs"></i> Peraturan KKP</a></li>
                        <li><a href="https://situbondokab.go.id/" target="_blank" class="text-white"><i class="fas fa-chevron-right fa-xs"></i> Pemkab Situbondo</a></li>
                    </ul>
                </div>

                <div class="col-lg-4 col-md-6">
                    <h5 class="text-white">Kontak Kami</h5>
                    <div class="mt-3">
                        <!-- Alamat Kantor dengan efek klik yang diperbaiki -->
                        <div class="contact-item clickable" id="alamatKantor">
                            <div class="contact-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="contact-item-content">
                                <span class="text-white">Alamat Kantor</span>
                                <small class="text-white">Jl. PB Sudirman No.77 C, Situbondo, Jawa Timur 68312</small>
                            </div>
                        </div>
                        <!-- Nomor WhatsApp dengan efek klik yang diperbaiki -->
                        <div class="contact-item clickable" id="whatsappContact">
                            <div class="contact-icon">
                                <i class="fas fa-phone-alt"></i>
                            </div>
                            <div class="contact-item-content">
                                <span class="text-white">Telepon / WhatsApp</span>
                                <small class="text-white">0878-6561-4222</small>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="contact-item-content">
                                <span class="text-white">Jam Pelayanan</span>
                                <small class="text-white">Senin - Jumat: 08.00 - 15.00 WIB</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-md-start mb-2 mb-md-0 text-white">
                        &copy; 2025 <strong class="text-white">Dinas Peternakan dan Perikanan Situbondo</strong>. All Rights Reserved.
                    </div>
                    <div class="col-md-6 text-md-end text-white">
                        <small>Bidang Pemberdayaan Nelayan</small>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Detail Modal untuk Peta Statistik -->
    <div class="detail-modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Detail Desa</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Akan diisi oleh JavaScript -->
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div class="modal fade lightbox-modal" id="lightboxModal" tabindex="-1" aria-labelledby="lightboxModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="lightboxModalLabel">Galeri Kegiatan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <img id="lightboxImage" src="" alt="Kegiatan" class="lightbox-image">
                </div>
                <div class="modal-footer">
                    <div class="lightbox-nav">
                        <button type="button" class="lightbox-nav-btn" id="prevBtn">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button type="button" class="lightbox-nav-btn" id="nextBtn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="lightbox-counter">
                        <span id="currentIndex">1</span> / <span id="totalImages">9</span>
                    </div>
                    <div class="lightbox-zoom-controls">
                        <button type="button" class="lightbox-nav-btn" id="zoomInBtn">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button type="button" class="lightbox-nav-btn" id="zoomOutBtn">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button type="button" class="lightbox-nav-btn" id="resetZoomBtn">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS untuk peta -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script>
        // ============================================
        // SISTEM PETA STATISTIK NELAYAN - VERSI MOBILE FRIENDLY
        // ============================================
        
        // Inisialisasi variabel global untuk peta statistik
        let statistikMap;
        let statistikMarkers = [];
        let statistikMarkerLayerGroup;
        let dataDesa = [];
        let autoReloadInterval;
        let updateCount = 0;
        let bantuanChart = null;
        let tahunChart = null;
        let isFullscreen = false;
        
        // Konfigurasi aplikasi
        const APP_CONFIG = {
            autoReload: true,
            reloadInterval: 300000, // 300 detik (5 menit)
            showNotifications: true,
            defaultMapZoom: 10,
            situbondoCenter: [-7.7069, 113.6347],
            maxMarkers: 100
        };
        
        // Data contoh untuk peta statistik (akan diganti dengan data sebenarnya dari datapeta.js)
        const SAMPLE_DATA = {
            metadata: {
                lastUpdate: "9 Desember 2025 pukul 23.35",
                totalDesa: 27,
                totalPenerima: 393
            },
            summary: {
                totalBantuanBarang: 424,
                totalBantuanUang: 0
            },
            data: [
                {
                    id: "1",
                    desa: "Panarukan",
                    kecamatan: "Panarukan",
                    jumlahPenerima: 45,
                    totalBantuanBarang: 50,
                    rataBantuan: 1.11,
                    koordinat: { lat: -7.7069, lng: 113.6347 },
                    tahunDistribusi: [
                        { tahun: "2023", jumlah: 20 },
                        { tahun: "2024", jumlah: 25 }
                    ],
                    jenisBantuan: [
                        { jenis: "Jaring", jumlah: 30 },
                        { jenis: "Perahu", jumlah: 5 },
                        { jenis: "Mesin", jumlah: 15 }
                    ],
                    kelompokDistribusi: [
                        { kelompok: "Nelayan Tradisional", jumlah: 30 },
                        { kelompok: "Nelayan Modern", jumlah: 15 }
                    ]
                },
                {
                    id: "2",
                    desa: "Mimbaan",
                    kecamatan: "Panarukan",
                    jumlahPenerima: 35,
                    totalBantuanBarang: 40,
                    rataBantuan: 1.14,
                    koordinat: { lat: -7.7167, lng: 113.6500 },
                    tahunDistribusi: [
                        { tahun: "2023", jumlah: 15 },
                        { tahun: "2024", jumlah: 20 }
                    ],
                    jenisBantuan: [
                        { jenis: "Jaring", jumlah: 25 },
                        { jenis: "Perahu", jumlah: 3 },
                        { jenis: "Mesin", jumlah: 12 }
                    ],
                    kelompokDistribusi: [
                        { kelompok: "Nelayan Tradisional", jumlah: 25 },
                        { kelompok: "Nelayan Modern", jumlah: 10 }
                    ]
                }
            ]
        };
        
        // Fungsi untuk mendeteksi perangkat mobile
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   window.innerWidth <= 768;
        }
        
        // Fungsi untuk menginisialisasi peta statistik
        function initStatistikMap() {
            try {
                // Inisialisasi peta
                statistikMap = L.map('statistikMap').setView(APP_CONFIG.situbondoCenter, APP_CONFIG.defaultMapZoom);
                
                // Tambahkan tile layer (peta dasar)
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenstreetMap</a> contributors',
                    maxZoom: 18,
                    minZoom: 8
                }).addTo(statistikMap);
                
                // Tambahkan layer group untuk marker
                statistikMarkerLayerGroup = L.layerGroup().addTo(statistikMap);
                
                // Tambahkan kontrol skala
                L.control.scale({position: 'bottomleft'}).addTo(statistikMap);
                
                // Setup event listeners
                setupEventListeners();
                
                // Load data pertama kali
                loadData();
                
                // Setup auto-update jika diaktifkan
                if (APP_CONFIG.autoReload) {
                    setupAutoUpdate();
                }
                
                // Optimasi untuk mobile
                if (isMobileDevice()) {
                    optimizeForMobile();
                }
            } catch (error) {
                console.error('Error inisialisasi peta:', error);
                showNotification('Gagal menginisialisasi peta. Silakan refresh halaman.', 'error');
            }
        }
        
        // Optimasi untuk perangkat mobile
        function optimizeForMobile() {
            try {
                // Nonaktifkan drag and zoom untuk mobile jika diperlukan
                statistikMap.dragging.enable();
                statistikMap.touchZoom.enable();
                statistikMap.doubleClickZoom.enable();
                statistikMap.scrollWheelZoom.enable();
                
                // Atur zoom yang lebih sesuai untuk mobile
                statistikMap.setZoom(APP_CONFIG.defaultMapZoom - 1);
                
                // Perbaikan untuk tampilan mobile
                const mapContainer = document.getElementById('statistikMap');
                if (mapContainer) {
                    mapContainer.style.height = '350px';
                }
                
                // Sembunyikan teks tombol di mobile untuk menghemat ruang
                const btnTexts = document.querySelectorAll('.btn-text');
                btnTexts.forEach(text => {
                    if (window.innerWidth <= 400) {
                        text.style.display = 'none';
                    }
                });
            } catch (error) {
                console.error('Error optimizing for mobile:', error);
            }
        }
        
        // Fungsi untuk setup event listeners peta statistik
        function setupEventListeners() {
            try {
                // Tombol update
                document.getElementById('reloadBtn').addEventListener('click', updateData);
                
                // Tombol reset view
                document.getElementById('resetViewBtn').addEventListener('click', resetView);
                
                // Tombol fullscreen
                document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
                
                // Tombol Reload Data Baru
                document.getElementById('reloadDataBtn').addEventListener('click', reloadDataFromFile);
                
                // Tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Hapus class active dari semua tab
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        // Tambah class active ke tab yang diklik
                        this.classList.add('active');
                        
                        // Tampilkan konten tab yang sesuai
                        const tabId = this.getAttribute('data-tab');
                        const tabContent = document.getElementById(`${tabId}-tab`);
                        if (tabContent) {
                            tabContent.classList.add('active');
                        }
                    });
                });
                
                // Pencarian desa
                const searchInput = document.getElementById('searchDesa');
                if (searchInput) {
                    searchInput.addEventListener('input', function(e) {
                        filterDesaList(e.target.value);
                    });
                }
                
                // Modal close
                const modalClose = document.getElementById('modalClose');
                if (modalClose) {
                    modalClose.addEventListener('click', closeModal);
                }
                
                // Close modal dengan klik di luar
                const detailModal = document.getElementById('detailModal');
                if (detailModal) {
                    detailModal.addEventListener('click', function(e) {
                        if (e.target === this) {
                            closeModal();
                        }
                    });
                }
                
                // Close modal dengan ESC
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closeModal();
                    }
                });
                
                // Fullscreen change event
                document.addEventListener('fullscreenchange', handleFullscreenChange);
                document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
                document.addEventListener('mozfullscreenchange', handleFullscreenChange);
                document.addEventListener('MSFullscreenChange', handleFullscreenChange);
                
                // Touch events untuk mobile
                setupTouchEvents();
            } catch (error) {
                console.error('Error setup event listeners:', error);
            }
        }
        
        // Setup touch events untuk mobile
        function setupTouchEvents() {
            // Mencegah zoom halaman saat berinteraksi dengan peta
            const petaContainer = document.querySelector('.peta-map-container');
            if (petaContainer) {
                petaContainer.addEventListener('touchstart', function(e) {
                    if (e.touches.length > 1) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
            
            // Mencegah highlight biru pada tap
            document.addEventListener('touchstart', function() {}, { passive: true });
        }
        
        // Fungsi untuk setup auto-update
        function setupAutoUpdate() {
            try {
                // Update UI untuk menunjukkan auto-update aktif
                const autoReloadStatus = document.getElementById('autoReloadStatus');
                const footerReloadStatus = document.getElementById('footerReloadStatus');
                const reloadInterval = document.getElementById('reloadInterval');
                
                if (autoReloadStatus) autoReloadStatus.textContent = 'Aktif';
                if (footerReloadStatus) footerReloadStatus.textContent = 'Aktif';
                if (reloadInterval) reloadInterval.textContent = APP_CONFIG.reloadInterval / 1000;
                
                // Clear interval sebelumnya jika ada
                if (autoReloadInterval) {
                    clearInterval(autoReloadInterval);
                }
                
                // Setup interval untuk auto-update
                autoReloadInterval = setInterval(() => {
                    try {
                        updateData();
                        updateCount++;
                        
                        // Tampilkan notifikasi setiap 5 update
                        if (updateCount % 5 === 0 && APP_CONFIG.showNotifications) {
                            showNotification(`Data telah diperbarui ${updateCount} kali`, 'info');
                        }
                    } catch (error) {
                        console.error('Error dalam auto-update:', error);
                    }
                }, APP_CONFIG.reloadInterval);
                
                // Tampilkan notifikasi
                if (APP_CONFIG.showNotifications) {
                    showNotification(`Auto-update diaktifkan. Data akan diperbarui setiap ${APP_CONFIG.reloadInterval/1000} detik.`, 'info');
                }
            } catch (error) {
                console.error('Error setup auto-update:', error);
            }
        }
        
        // Fungsi untuk memuat data
        function loadData() {
            // Tampilkan loading
            showLoading(true);
            
            // Gunakan data sample sebagai fallback
            setTimeout(() => {
                processData(SAMPLE_DATA);
                showLoading(false);
                
                // Coba load data dari file jika ada
                loadDataFile();
            }, 1000);
        }
        
        // Fungsi untuk load data file
        function loadDataFile() {
            try {
                // Coba load dari datapeta.js
                if (typeof DATA_PETA_STATISTIK !== 'undefined') {
                    processData(DATA_PETA_STATISTIK);
                    return;
                }
                
                // Jika tidak ada, coba load dari file
                const script = document.createElement('script');
                script.src = 'datapeta.js';
                script.onload = function() {
                    if (typeof DATA_PETA_STATISTIK !== 'undefined') {
                        processData(DATA_PETA_STATISTIK);
                    }
                };
                script.onerror = function() {
                    console.log('File datapeta.js tidak ditemukan, menggunakan data sample');
                };
                document.head.appendChild(script);
            } catch (error) {
                console.error('Error loading data file:', error);
            }
        }
        
        // Fungsi untuk reload data dari file eksternal (reload.html atau reload.js)
        async function reloadDataFromFile() {
            try {
                showLoading(true);
                showNotification('Sedang memuat data dari file eksternal...', 'info');
                
                // Coba ambil data dari reload.js terlebih dahulu
                const response = await fetch('reload.js?t=' + new Date().getTime());
                if (response.ok) {
                    const jsContent = await response.text();
                    
                    // Coba ekstrak data dari file JavaScript
                    try {
                        // Eksekusi kode JavaScript (harus berhati-hati dengan keamanan)
                        eval(jsContent);
                        
                        // Cek apakah ada data yang tersedia
                        if (typeof RELOAD_DATA !== 'undefined') {
                            processData(RELOAD_DATA);
                            showNotification('Data berhasil dimuat dari file reload.js', 'success');
                        } else {
                            // Coba parse sebagai JSON jika tidak ada variabel RELOAD_DATA
                            const jsonMatch = jsContent.match(/const\s+RELOAD_DATA\s*=\s*(\{[\s\S]*?\});/);
                            if (jsonMatch) {
                                const data = JSON.parse(jsonMatch[1]);
                                processData(data);
                                showNotification('Data berhasil dimuat dari file reload.js', 'success');
                            } else {
                                throw new Error('Format data tidak dikenali');
                            }
                        }
                    } catch (evalError) {
                        console.error('Error parsing data dari reload.js:', evalError);
                        
                        // Coba ambil dari reload.html sebagai fallback
                        await loadReloadHTML();
                    }
                } else {
                    // Jika reload.js tidak ada, coba reload.html
                    await loadReloadHTML();
                }
            } catch (error) {
                console.error('Error reloading data dari file:', error);
                showNotification('Gagal memuat data dari file eksternal. Menggunakan data yang tersedia.', 'error');
                processData(SAMPLE_DATA);
            } finally {
                showLoading(false);
            }
        }
        
        // Fungsi untuk load data dari reload.html
        async function loadReloadHTML() {
            try {
                const response = await fetch('reload.html?t=' + new Date().getTime());
                if (response.ok) {
                    const htmlContent = await response.text();
                    
                    // Coba ekstrak data dari HTML
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlContent, 'text/html');
                    
                    // Cari elemen dengan data yang diperlukan
                    const dataElement = doc.querySelector('#data-content');
                    if (dataElement) {
                        const dataText = dataElement.textContent;
                        try {
                            const data = JSON.parse(dataText);
                            processData(data);
                            showNotification('Data berhasil dimuat dari file reload.html', 'success');
                        } catch (parseError) {
                            throw new Error('Format data tidak valid di reload.html');
                        }
                    } else {
                        throw new Error('Tidak ditemukan data di reload.html');
                    }
                } else {
                    throw new Error('File reload.html tidak ditemukan');
                }
            } catch (error) {
                console.error('Error loading reload.html:', error);
                throw error;
            }
        }
        
        // Fungsi untuk memproses data
        function processData(data) {
            try {
                if (!data || !Array.isArray(data.data)) {
                    console.log('Menggunakan data sample');
                    data = SAMPLE_DATA;
                }
                
                dataDesa = data.data || [];
                
                // Update informasi metadata
                updateElementText('lastUpdate', data.metadata?.lastUpdate || '9 Desember 2025');
                updateElementText('totalDesa', data.metadata?.totalDesa || '27');
                updateElementText('totalPenerima', data.metadata?.totalPenerima || '393');
                updateElementText('totalBantuan', data.summary?.totalBantuanBarang || '424');
                updateElementText('footerUpdate', data.metadata?.lastUpdate || '9 Desember 2025 pukul 23.35');
                
                // Update ringkasan statistik
                updateElementText('summaryDesa', data.metadata?.totalDesa || '27');
                updateElementText('summaryPenerima', data.metadata?.totalPenerima || '393');
                updateElementText('summaryBarang', data.summary?.totalBantuanBarang || '424');
                updateElementText('summaryUang', data.summary?.totalBantuanUang || '0');
                
                // Tampilkan desa terbanyak penerima
                displayTopDesa(dataDesa);
                
                // Tampilkan daftar desa
                displayDesaList(dataDesa);
                
                // Tampilkan marker di peta
                displayMapMarkers(dataDesa);
                
                // Update charts
                updateCharts(dataDesa);
                
                // Update timestamp
                const now = new Date();
                const formattedDate = now.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                updateElementText('lastUpdate', formattedDate);
                updateElementText('footerUpdate', formattedDate);
                
                // Tampilkan notifikasi sukses
                if (APP_CONFIG.showNotifications) {
                    showNotification('Data berhasil dimuat', 'success');
                }
            } catch (error) {
                console.error('Error processing data:', error);
                showNotification('Terjadi kesalahan saat memproses data.', 'error');
            }
        }
        
        // Helper function untuk update teks elemen
        function updateElementText(elementId, text) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
            }
        }
        
        // Fungsi untuk menampilkan top 5 desa
        function displayTopDesa(desaData) {
            try {
                const topDesaList = document.getElementById('topDesaList');
                if (!topDesaList) return;
                
                topDesaList.innerHTML = '';
                
                if (!Array.isArray(desaData) || desaData.length === 0) {
                    topDesaList.innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 20px;">Data tidak tersedia</p>';
                    return;
                }
                
                // Urutkan dan ambil 5 teratas
                const sortedDesa = [...desaData]
                    .sort((a, b) => (b.jumlahPenerima || 0) - (a.jumlahPenerima || 0))
                    .slice(0, 5);
                
                sortedDesa.forEach((desa, index) => {
                    const desaItem = document.createElement('div');
                    desaItem.className = 'desa-item';
                    
                    let rankBadge = '';
                    if (index === 0) rankBadge = '<span style="background: gold; color: #333; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;"><i class="fas fa-crown"></i> 1</span>';
                    else if (index === 1) rankBadge = '<span style="background: silver; color: #333; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">2</span>';
                    else if (index === 2) rankBadge = '<span style="background: #cd7f32; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">3</span>';
                    else rankBadge = `<span style="background: var(--primary); color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">${index + 1}</span>`;
                    
                    desaItem.innerHTML = `
                        <div>
                            <div class="desa-name">${rankBadge} ${desa.desa || 'N/A'}, ${desa.kecamatan || 'N/A'}</div>
                            <div class="desa-details">
                                <span><i class="fas fa-users"></i> ${desa.jumlahPenerima || 0} Penerima</span>
                                <span><i class="fas fa-box"></i> ${desa.totalBantuanBarang || 0} Unit</span>
                            </div>
                        </div>
                        <div>
                            <button class="control-btn" style="padding: 8px 12px; font-size: 0.9rem;" data-id="${desa.id || ''}">
                                <i class="fas fa-info-circle"></i> Detail
                            </button>
                        </div>
                    `;
                    
                    // Event untuk zoom ke desa
                    desaItem.addEventListener('click', function(e) {
                        if (!e.target.closest('button')) {
                            zoomToDesa(desa.id);
                        }
                    });
                    
                    // Event untuk button detail
                    const detailBtn = desaItem.querySelector('button');
                    detailBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showDesaDetail(desa.id);
                    });
                    
                    topDesaList.appendChild(desaItem);
                });
            } catch (error) {
                console.error('Error displaying top desa:', error);
            }
        }
        
        // Fungsi untuk menampilkan daftar desa
        function displayDesaList(desaData) {
            try {
                const desaList = document.getElementById('desaList');
                if (!desaList) return;
                
                desaList.innerHTML = '';
                
                if (!Array.isArray(desaData) || desaData.length === 0) {
                    desaList.innerHTML = '<div class="desa-item" style="justify-content: center;"><span>Data tidak tersedia</span></div>';
                    return;
                }
                
                // Urutkan berdasarkan jumlah penerima
                const sortedDesa = [...desaData].sort((a, b) => (b.jumlahPenerima || 0) - (a.jumlahPenerima || 0));
                
                sortedDesa.forEach(desa => {
                    const desaItem = document.createElement('div');
                    desaItem.className = 'desa-item';
                    desaItem.dataset.id = desa.id || '';
                    
                    // Format tahun distribusi
                    let tahunText = 'N/A';
                    if (desa.tahunDistribusi && Array.isArray(desa.tahunDistribusi)) {
                        tahunText = desa.tahunDistribusi.map(t => t.tahun).filter(t => t).join(', ');
                    }
                    
                    desaItem.innerHTML = `
                        <div>
                            <div class="desa-name">${desa.desa || 'N/A'}, ${desa.kecamatan || 'N/A'}</div>
                            <div class="desa-details">
                                <span><i class="fas fa-calendar"></i> ${tahunText}</span>
                            </div>
                        </div>
                        <div>
                            <span style="background: ${getColorByPenerima(desa.jumlahPenerima || 0)}; color: white; padding: 5px 12px; border-radius: 20px; font-weight: bold;">
                                ${desa.jumlahPenerima || 0}
                            </span>
                        </div>
                    `;
                    
                    // Event untuk zoom ke desa
                    desaItem.addEventListener('click', function() {
                        zoomToDesa(desa.id);
                    });
                    
                    desaList.appendChild(desaItem);
                });
            } catch (error) {
                console.error('Error displaying desa list:', error);
            }
        }
        
        // Fungsi untuk filter daftar desa
        function filterDesaList(query) {
            try {
                const desaItems = document.querySelectorAll('#desaList .desa-item');
                const lowerQuery = query.toLowerCase().trim();
                
                desaItems.forEach(item => {
                    const desaName = item.querySelector('.desa-name')?.textContent.toLowerCase() || '';
                    if (desaName.includes(lowerQuery) || query === '') {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            } catch (error) {
                console.error('Error filtering desa list:', error);
            }
        }
        
        // Fungsi untuk menampilkan marker di peta
        function displayMapMarkers(desaData) {
            try {
                // Hapus marker lama
                if (statistikMarkerLayerGroup) {
                    statistikMarkerLayerGroup.clearLayers();
                }
                statistikMarkers = [];
                
                if (!Array.isArray(desaData) || desaData.length === 0) return;
                
                // Batasi jumlah marker
                const displayData = desaData.slice(0, APP_CONFIG.maxMarkers);
                
                displayData.forEach(desa => {
                    // Validasi koordinat
                    if (!desa.koordinat || !desa.koordinat.lat || !desa.koordinat.lng) {
                        return;
                    }
                    
                    // Warna marker berdasarkan jumlah penerima
                    const markerColor = getColorByPenerima(desa.jumlahPenerima || 0);
                    
                    // Buat custom icon
                    const markerIcon = L.divIcon({
                        html: `<div style="
                            background: ${markerColor};
                            width: 32px;
                            height: 32px;
                            border-radius: 50%;
                            border: 3px solid white;
                            box-shadow: 0 0 15px rgba(0,0,0,0.3);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-weight: bold;
                            font-size: 12px;
                            cursor: pointer;
                            font-family: var(--font-head);
                            transition: all 0.3s ease;
                        ">${desa.jumlahPenerima || 0}</div>`,
                        className: 'custom-marker',
                        iconSize: [35, 35],
                        iconAnchor: [17.5, 17.5]
                    });
                    
                    // Buat marker
                    const marker = L.marker([desa.koordinat.lat, desa.koordinat.lng], {
                        icon: markerIcon,
                        title: `${desa.desa || 'N/A'}, ${desa.kecamatan || 'N/A'} - ${desa.jumlahPenerima || 0} penerima`
                    });
                    
                    // Tambahkan popup
                    const popupContent = createPopupContent(desa);
                    marker.bindPopup(popupContent);
                    
                    // Event click untuk highlight
                    marker.on('click', function() {
                        highlightDesa(desa.id);
                    });
                    
                    // Tambahkan ke peta
                    if (statistikMarkerLayerGroup) {
                        marker.addTo(statistikMarkerLayerGroup);
                    }
                    
                    // Simpan reference
                    statistikMarkers.push({
                        id: desa.id || '',
                        marker: marker,
                        desa: desa
                    });
                });
                
                // Fit bounds jika ada marker
                if (statistikMarkers.length > 0 && statistikMap) {
                    const markerBounds = L.latLngBounds(statistikMarkers.map(m => {
                        if (m.marker && m.marker.getLatLng) {
                            return m.marker.getLatLng();
                        }
                        return APP_CONFIG.situbondoCenter;
                    }));
                    
                    if (markerBounds.isValid()) {
                        // Atur zoom yang berbeda untuk mobile
                        const maxZoom = isMobileDevice() ? 11 : 12;
                        statistikMap.fitBounds(markerBounds, { padding: [50, 50], maxZoom: maxZoom });
                    }
                }
            } catch (error) {
                console.error('Error displaying map markers:', error);
            }
        }
        
        // Fungsi untuk membuat konten popup
        function createPopupContent(desa) {
            const desaName = desa.desa || 'N/A';
            const kecamatan = desa.kecamatan || 'N/A';
            const jumlahPenerima = desa.jumlahPenerima || 0;
            const totalBantuanBarang = desa.totalBantuanBarang || 0;
            
            return `
                <div style="max-width: 300px;">
                    <h3 style="margin: 0 0 10px 0; color: var(--primary); font-family: var(--font-head); font-size: ${isMobileDevice() ? '1.1rem' : '1.2rem'};">${desaName}, ${kecamatan}</h3>
                    <p><strong><i class="fas fa-users" style="color: var(--accent);"></i> Jumlah Penerima:</strong> ${jumlahPenerima} orang</p>
                    <p><strong><i class="fas fa-box" style="color: #f59e0b;"></i> Total Bantuan Barang:</strong> ${totalBantuanBarang} unit</p>
                    <hr style="margin: 15px 0;">
                    <div style="text-align: center;">
                        <button onclick="window.showDesaDetail('${desa.id || ''}')" style="
                            background: linear-gradient(135deg, var(--accent), var(--primary));
                            color: white;
                            border: none;
                            padding: 10px 18px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: bold;
                            width: 100%;
                            font-family: var(--font-head);
                            transition: all 0.3s ease;
                            font-size: ${isMobileDevice() ? '0.9rem' : '1rem'};
                            min-height: 44px;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(245, 158, 11, 0.3)'" 
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-info-circle"></i> Lihat Detail Lengkap
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Fungsi untuk mendapatkan warna berdasarkan jumlah penerima
        function getColorByPenerima(jumlah) {
            if (jumlah >= 50) return 'var(--danger-color)';
            if (jumlah >= 20) return 'var(--warning-color)';
            return 'var(--success-color)';
        }
        
        // Fungsi untuk zoom ke desa
        function zoomToDesa(desaId) {
            try {
                const selectedMarker = statistikMarkers.find(m => m.id === desaId);
                if (selectedMarker && selectedMarker.marker && statistikMap) {
                    const zoomLevel = isMobileDevice() ? 12 : 13;
                    statistikMap.setView(selectedMarker.marker.getLatLng(), zoomLevel);
                    selectedMarker.marker.openPopup();
                    highlightDesa(desaId);
                }
            } catch (error) {
                console.error('Error zooming to desa:', error);
            }
        }
        
        // Fungsi untuk highlight desa
        function highlightDesa(desaId) {
            try {
                // Reset semua marker
                statistikMarkers.forEach(m => {
                    if (m.marker && m.marker.getElement) {
                        const markerEl = m.marker.getElement();
                        if (markerEl) {
                            markerEl.style.transform = 'scale(1)';
                            markerEl.style.zIndex = '1';
                        }
                    }
                });
                
                // Highlight marker yang dipilih
                const selectedMarker = statistikMarkers.find(m => m.id === desaId);
                if (selectedMarker && selectedMarker.marker && selectedMarker.marker.getElement) {
                    const markerEl = selectedMarker.marker.getElement();
                    if (markerEl) {
                        markerEl.style.transform = 'scale(1.4)';
                        markerEl.style.zIndex = '1000';
                        markerEl.style.boxShadow = '0 0 20px rgba(0,0,0,0.5)';
                    }
                    
                    // Highlight di daftar desa
                    highlightDesaListItem(desaId);
                }
            } catch (error) {
                console.error('Error highlighting desa:', error);
            }
        }
        
        // Fungsi untuk highlight item di daftar desa
        function highlightDesaListItem(desaId) {
            try {
                // Hapus class active dari semua item
                const desaItems = document.querySelectorAll('.desa-item');
                desaItems.forEach(item => {
                    item.classList.remove('active');
                });
                
                // Tambahkan class active ke item yang dipilih
                const selectedItem = document.querySelector(`.desa-item[data-id="${desaId}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('active');
                    selectedItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            } catch (error) {
                console.error('Error highlighting desa list item:', error);
            }
        }
        
        // Fungsi untuk menampilkan detail desa
        function showDesaDetail(desaId) {
            try {
                const desaData = dataDesa.find(d => d.id === desaId);
                if (!desaData) {
                    showNotification('Data desa tidak ditemukan.', 'error');
                    return;
                }
                
                const modalTitle = document.getElementById('modalTitle');
                if (modalTitle) {
                    modalTitle.textContent = `${desaData.desa || 'N/A'}, ${desaData.kecamatan || 'N/A'}`;
                }
                
                // Buat konten modal
                let modalHtml = `
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-item-title">Jumlah Penerima</div>
                            <div class="detail-item-value">${desaData.jumlahPenerima || 0} orang</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-item-title">Total Bantuan Barang</div>
                            <div class="detail-item-value">${desaData.totalBantuanBarang || 0} unit</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-item-title">Rata-rata Bantuan</div>
                            <div class="detail-item-value">${desaData.rataBantuan ? desaData.rataBantuan.toFixed(2) : '0.00'} unit/orang</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalBody').innerHTML = modalHtml;
                document.getElementById('detailModal').classList.add('active');
            } catch (error) {
                console.error('Error showing desa detail:', error);
                showNotification('Terjadi kesalahan saat menampilkan detail desa.', 'error');
            }
        }
        
        // Fungsi untuk menutup modal
        function closeModal() {
            try {
                document.getElementById('detailModal').classList.remove('active');
            } catch (error) {
                console.error('Error closing modal:', error);
            }
        }
        
        // Fungsi untuk update data
        function updateData() {
            try {
                showLoading(true);
                setTimeout(() => {
                    loadData();
                    showNotification('Data berhasil diperbarui', 'success');
                }, 1000);
            } catch (error) {
                console.error('Error updating data:', error);
                showLoading(false);
                showNotification('Gagal memperbarui data.', 'error');
            }
        }
        
        // Fungsi untuk reset view peta
        function resetView() {
            try {
                if (statistikMap) {
                    const zoomLevel = isMobileDevice() ? APP_CONFIG.defaultMapZoom - 1 : APP_CONFIG.defaultMapZoom;
                    statistikMap.setView(APP_CONFIG.situbondoCenter, zoomLevel);
                }
                
                // Reset highlight
                const desaItems = document.querySelectorAll('.desa-item');
                desaItems.forEach(item => {
                    item.classList.remove('active');
                });
                
                // Reset marker
                statistikMarkers.forEach(m => {
                    if (m.marker && m.marker.getElement) {
                        const markerEl = m.marker.getElement();
                        if (markerEl) {
                            markerEl.style.transform = 'scale(1)';
                            markerEl.style.zIndex = '1';
                        }
                        if (m.marker.closePopup) {
                            m.marker.closePopup();
                        }
                    }
                });
            } catch (error) {
                console.error('Error resetting view:', error);
            }
        }
        
        // Fungsi untuk toggle fullscreen
        function toggleFullscreen() {
            try {
                const container = document.querySelector('.peta-statistik-container');
                if (!container) return;
                
                if (!isFullscreen) {
                    if (container.requestFullscreen) {
                        container.requestFullscreen();
                    } else if (container.webkitRequestFullscreen) {
                        container.webkitRequestFullscreen();
                    } else if (container.mozRequestFullScreen) {
                        container.mozRequestFullScreen();
                    } else if (container.msRequestFullscreen) {
                        container.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            } catch (error) {
                console.error('Error toggling fullscreen:', error);
            }
        }
        
        // Fungsi untuk handle fullscreen change
        function handleFullscreenChange() {
            try {
                isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || 
                                document.mozFullScreenElement || document.msFullscreenElement);
                
                const fullscreenBtn = document.getElementById('fullscreenBtn');
                if (fullscreenBtn) {
                    if (isFullscreen) {
                        fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> <span class="btn-text">Keluar Layar Penuh</span>';
                    } else {
                        fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> <span class="btn-text">Layar Penuh</span>';
                    }
                }
            } catch (error) {
                console.error('Error handling fullscreen change:', error);
            }
        }
        
        // Fungsi untuk update charts
        function updateCharts(desaData) {
            try {
                // Data untuk chart distribusi bantuan
                const bantuanLabels = ['Tinggi (≥50)', 'Sedang (20-49)', 'Rendah (≤19)'];
                const bantuanCounts = [0, 0, 0];
                
                if (Array.isArray(desaData)) {
                    desaData.forEach(desa => {
                        const jumlah = desa.jumlahPenerima || 0;
                        if (jumlah >= 50) bantuanCounts[0]++;
                        else if (jumlah >= 20) bantuanCounts[1]++;
                        else bantuanCounts[2]++;
                    });
                }
                
                // Hancurkan chart lama jika ada
                if (bantuanChart) bantuanChart.destroy();
                if (tahunChart) tahunChart.destroy();
                
                // Buat chart distribusi bantuan
                const bantuanCtx = document.getElementById('bantuanChart');
                if (bantuanCtx) {
                    bantuanChart = new Chart(bantuanCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: bantuanLabels,
                            datasets: [{
                                data: bantuanCounts,
                                backgroundColor: ['#ef4444', '#facc15', '#22c55e'],
                                borderWidth: 3,
                                borderColor: 'white',
                                hoverBorderWidth: 4,
                                hoverBorderColor: '#f1f5f9'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: '#475569',
                                        font: {
                                            family: 'var(--font-body)',
                                            size: isMobileDevice() ? 10 : 12,
                                            weight: '600'
                                        },
                                        padding: 15
                                    }
                                }
                            },
                            cutout: '65%'
                        }
                    });
                }
                
                // Buat chart tahun distribusi sederhana
                const tahunCtx = document.getElementById('tahunChart');
                if (tahunCtx) {
                    tahunChart = new Chart(tahunCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['2023', '2024', '2025'],
                            datasets: [{
                                label: 'Jumlah Penerima',
                                data: [150, 200, 250],
                                backgroundColor: 'rgba(245, 158, 11, 0.8)',
                                borderColor: '#f59e0b',
                                borderWidth: 2,
                                borderRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 50
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error updating charts:', error);
            }
        }
        
        // Fungsi untuk menampilkan loading
        function showLoading(show) {
            try {
                const loadingScreen = document.getElementById('loadingScreen');
                if (!loadingScreen) return;
                
                if (show) {
                    loadingScreen.classList.remove('hidden');
                } else {
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                    }, 500);
                }
            } catch (error) {
                console.error('Error showing loading:', error);
            }
        }
        
        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'info') {
            try {
                if (!APP_CONFIG.showNotifications) return;
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                let icon = 'info-circle';
                if (type === 'success') icon = 'check-circle';
                else if (type === 'error') icon = 'exclamation-circle';
                else if (type === 'warning') icon = 'exclamation-triangle';
                
                notification.innerHTML = `<i class="fas fa-${icon}"></i><span>${message}</span>`;
                
                // Style berdasarkan type
                if (type === 'success') {
                    notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                } else if (type === 'error') {
                    notification.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                } else if (type === 'warning') {
                    notification.style.background = 'linear-gradient(135deg, #facc15, #f59e0b)';
                } else {
                    notification.style.background = 'linear-gradient(135deg, var(--accent), var(--primary))';
                }
                notification.style.color = 'white';
                
                // Posisi notifikasi berbeda untuk mobile
                if (isMobileDevice()) {
                    notification.style.top = '15px';
                    notification.style.right = '15px';
                    notification.style.left = '15px';
                    notification.style.maxWidth = 'none';
                }
                
                document.body.appendChild(notification);
                
                // Hapus setelah 4 detik
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 4000);
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        }
        
        // ============================================
        // SISTEM WEBSITE UTAMA
        // ============================================
        
        // Init Animation
        AOS.init({
            once: true,
            offset: 100,
            duration: 800,
        });

        // Script Kirim ke WhatsApp
        function kirimKeWA(e) {
            e.preventDefault();

            try {
                let nama = document.getElementById('nama').value.trim();
                let nik = document.getElementById('nik').value.trim();
                let wa = document.getElementById('whatsapp').value.trim();
                let email = document.getElementById('email').value.trim() || '-';
                let alamat = document.getElementById('alamat').value.trim();
                let perihal = document.getElementById('perihal').value.trim();

                // Validasi
                if (!nama || !nik || !wa || !alamat || !perihal) {
                    showNotification('Harap isi semua field yang wajib diisi!', 'error');
                    return;
                }

                let targetNumber = "6287865614222"; 

                let pesan = `*LAPORAN PENGADUAN NELAYAN*%0A` +
                            `--------------------------------%0A` +
                            `*Nama:* ${nama}%0A` +
                            `*NIK:* ${nik}%0A` +
                            `*Alamat:* ${alamat}%0A` +
                            `*No. WA:* ${wa}%0A` +
                            `*Email:* ${email}%0A` +
                            `--------------------------------%0A` +
                            `*Perihal / Isi Laporan:*%0A` +
                            `${perihal}`;

                let url = `https://api.whatsapp.com/send?phone=${targetNumber}&text=${pesan}`;
                window.open(url, '_blank');
                
                // Reset form
                document.getElementById('waForm').reset();
                showNotification('Formulir berhasil dikirim!', 'success');
            } catch (error) {
                console.error('Error sending WhatsApp message:', error);
                showNotification('Terjadi kesalahan saat mengirim formulir.', 'error');
            }
        }

        // Efek Navbar saat scroll
        window.addEventListener('scroll', function() {
            try {
                const nav = document.getElementById('mainNav');
                if (!nav) return;
                
                if (window.scrollY > 50) {
                    nav.style.boxShadow = "0 10px 30px rgba(0,0,0,0.1)";
                    nav.style.background = "rgba(255, 255, 255, 0.98)";
                } else {
                    nav.style.boxShadow = "0 4px 20px rgba(0,0,0,0.05)";
                    nav.style.background = "rgba(255, 255, 255, 0.95)";
                }
            } catch (error) {
                console.error('Error in scroll handler:', error);
            }
        });

        // Lightbox functionality
        const photoUrls = [
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto1.jpeg',
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto2.jpeg',
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto3.jpeg',
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto4.jpeg',
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto5.jpeg',
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto6.jpeg',
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto7.jpeg',
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto8.jpeg',
            'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/foto/foto9.jpeg'
        ];

        let currentIndex = 0;
        let zoomLevel = 1;
        const maxZoom = 3;
        const minZoom = 1;
        const zoomStep = 0.2;

        function openLightbox(index) {
            try {
                if (index < 0 || index >= photoUrls.length) return;
                
                currentIndex = index;
                updateLightbox();
                const lightboxModal = new bootstrap.Modal(document.getElementById('lightboxModal'));
                lightboxModal.show();
            } catch (error) {
                console.error('Error opening lightbox:', error);
            }
        }

        function updateLightbox() {
            try {
                const lightboxImage = document.getElementById('lightboxImage');
                const currentIndexElement = document.getElementById('currentIndex');
                const totalImagesElement = document.getElementById('totalImages');
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                
                if (!lightboxImage) return;
                
                zoomLevel = 1;
                lightboxImage.style.transform = `scale(${zoomLevel})`;
                
                lightboxImage.src = photoUrls[currentIndex];
                lightboxImage.alt = `Kegiatan ${currentIndex + 1}`;
                
                if (currentIndexElement) currentIndexElement.textContent = currentIndex + 1;
                if (totalImagesElement) totalImagesElement.textContent = photoUrls.length;
                
                if (prevBtn) prevBtn.disabled = currentIndex === 0;
                if (nextBtn) nextBtn.disabled = currentIndex === photoUrls.length - 1;
                
                const modalLabel = document.getElementById('lightboxModalLabel');
                if (modalLabel) modalLabel.textContent = `Galeri Kegiatan - Foto ${currentIndex + 1}`;
            } catch (error) {
                console.error('Error updating lightbox:', error);
            }
        }

        function navigateLightbox(direction) {
            try {
                if (direction === 'prev' && currentIndex > 0) {
                    currentIndex--;
                } else if (direction === 'next' && currentIndex < photoUrls.length - 1) {
                    currentIndex++;
                }
                updateLightbox();
            } catch (error) {
                console.error('Error navigating lightbox:', error);
            }
        }

        function zoomImage(action) {
            try {
                const lightboxImage = document.getElementById('lightboxImage');
                if (!lightboxImage) return;
                
                if (action === 'in' && zoomLevel < maxZoom) {
                    zoomLevel += zoomStep;
                } else if (action === 'out' && zoomLevel > minZoom) {
                    zoomLevel -= zoomStep;
                } else if (action === 'reset') {
                    zoomLevel = 1;
                }
                
                zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));
                lightboxImage.style.transform = `scale(${zoomLevel})`;
                lightboxImage.style.transition = 'transform 0.3s ease';
            } catch (error) {
                console.error('Error zooming image:', error);
            }
        }

        // Smooth scroll untuk navigasi
        function setupSmoothScroll() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    if (href === '#') return;
                    
                    const targetElement = document.querySelector(href);
                    if (targetElement) {
                        e.preventDefault();
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                        
                        // Update active nav link
                        document.querySelectorAll('.nav-link').forEach(link => {
                            link.classList.remove('active');
                        });
                        this.classList.add('active');
                    }
                });
            });
        }
        
        // ============================================
        // FITUR BARU YANG DIPERBAIKI: Sistem Share/Bagikan Link
        // ============================================
        
        // Fungsi untuk copy link ke clipboard
        function copyToClipboard(text) {
            try {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showNotification('Link telah disalin ke clipboard!', 'success');
                    })
                    .catch(err => {
                        console.error('Gagal menyalin: ', err);
                        // Fallback menggunakan metode lama
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showNotification('Link telah disalin ke clipboard!', 'success');
                    });
            } catch (error) {
                console.error('Error copying to clipboard:', error);
                showNotification('Gagal menyalin link', 'error');
            }
        }
        
        // Fungsi untuk membagikan via WhatsApp
        function shareViaWhatsApp(url, title) {
            try {
                const text = `Lihat ${title}: ${url}`;
                const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
                window.open(whatsappUrl, '_blank');
                showNotification('Membuka WhatsApp untuk berbagi...', 'info');
            } catch (error) {
                console.error('Error sharing via WhatsApp:', error);
                showNotification('Gagal membagikan via WhatsApp', 'error');
            }
        }
        
        // Fungsi untuk setup tombol share yang diperbaiki
        function setupImprovedShareButtons() {
            try {
                document.addEventListener('click', function(e) {
                    // Cek jika klik berasal dari tombol share copy
                    if (e.target.closest('.share-btn-copy')) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const shareBtn = e.target.closest('.share-btn-copy');
                        const url = shareBtn.getAttribute('data-url');
                        
                        if (url) {
                            copyToClipboard(url);
                        }
                    }
                    
                    // Cek jika klik berasal dari tombol share WhatsApp
                    if (e.target.closest('.share-btn-whatsapp')) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const shareBtn = e.target.closest('.share-btn-whatsapp');
                        const url = shareBtn.getAttribute('data-url');
                        const title = shareBtn.getAttribute('data-title') || 'Dinas Peternakan dan Perikanan Situbondo';
                        
                        if (url) {
                            shareViaWhatsApp(url, title);
                        }
                    }
                });
                
                console.log('Improved share buttons setup completed');
            } catch (error) {
                console.error('Error setting up improved share buttons:', error);
            }
        }
        
        // ============================================
        // FITUR BARU YANG DIPERBAIKI: Alamat dan WhatsApp di Footer
        // ============================================
        
        // Fungsi untuk setup efek klik pada alamat dan whatsapp di footer - VERSI PERBAIKAN
        function setupFooterClickFeatures() {
            try {
                // Alamat Kantor
                const alamatKantor = document.getElementById('alamatKantor');
                if (alamatKantor) {
                    // Hapus class lama jika ada
                    alamatKantor.classList.remove('address-pulsing', 'pulsing');
                    
                    // Efek hover dengan animasi yang lebih halus
                    alamatKantor.addEventListener('mouseenter', function() {
                        this.classList.add('active-pulse');
                        this.style.transition = 'all 0.3s ease';
                    });
                    
                    alamatKantor.addEventListener('mouseleave', function() {
                        this.classList.remove('active-pulse');
                    });
                    
                    // Klik untuk membuka Google Maps
                    alamatKantor.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Efek visual saat diklik
                        this.classList.add('click-feedback');
                        setTimeout(() => {
                            this.classList.remove('click-feedback');
                        }, 200);
                        
                        // Buka Google Maps
                        window.open('https://maps.app.goo.gl/BxSQYHqFU5QstT2m8', '_blank');
                    });
                    
                    // Untuk touch devices
                    alamatKantor.addEventListener('touchstart', function() {
                        this.classList.add('active-pulse');
                    });
                    
                    alamatKantor.addEventListener('touchend', function() {
                        this.classList.remove('active-pulse');
                    });
                }
                
                // WhatsApp Contact
                const whatsappContact = document.getElementById('whatsappContact');
                if (whatsappContact) {
                    // Hapus class lama jika ada
                    whatsappContact.classList.remove('address-pulsing', 'pulsing');
                    
                    // Efek hover dengan animasi yang lebih halus
                    whatsappContact.addEventListener('mouseenter', function() {
                        this.classList.add('active-pulse-green');
                        this.style.transition = 'all 0.3s ease';
                    });
                    
                    whatsappContact.addEventListener('mouseleave', function() {
                        this.classList.remove('active-pulse-green');
                    });
                    
                    // Klik untuk membuka WhatsApp
                    whatsappContact.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Efek visual saat diklik
                        this.classList.add('click-feedback');
                        setTimeout(() => {
                            this.classList.remove('click-feedback');
                        }, 200);
                        
                        // Buka WhatsApp
                        const phoneNumber = '6287865614222';
                        const message = 'Halo, saya ingin informasi lebih lanjut tentang Dinas Peternakan dan Perikanan Situbondo.';
                        const whatsappUrl = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(message)}`;
                        window.open(whatsappUrl, '_blank');
                    });
                    
                    // Untuk touch devices
                    whatsappContact.addEventListener('touchstart', function() {
                        this.classList.add('active-pulse-green');
                    });
                    
                    whatsappContact.addEventListener('touchend', function() {
                        this.classList.remove('active-pulse-green');
                    });
                }
                
                console.log('Footer click features setup completed with improved animations');
            } catch (error) {
                console.error('Error setting up footer click features:', error);
            }
        }

        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Inisialisasi peta statistik
                initStatistikMap();
                
                // Setup smooth scroll
                setupSmoothScroll();
                
                // Setup fitur klik pada alamat dan whatsapp di footer dengan animasi yang diperbaiki
                setupFooterClickFeatures();
                
                // Setup tombol share yang diperbaiki
                setupImprovedShareButtons();
                
                // Navigation buttons untuk lightbox
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                
                if (prevBtn) {
                    prevBtn.addEventListener('click', () => navigateLightbox('prev'));
                }
                
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => navigateLightbox('next'));
                }
                
                // Zoom buttons untuk lightbox
                const zoomInBtn = document.getElementById('zoomInBtn');
                const zoomOutBtn = document.getElementById('zoomOutBtn');
                const resetZoomBtn = document.getElementById('resetZoomBtn');
                
                if (zoomInBtn) {
                    zoomInBtn.addEventListener('click', () => zoomImage('in'));
                }
                
                if (zoomOutBtn) {
                    zoomOutBtn.addEventListener('click', () => zoomImage('out'));
                }
                
                if (resetZoomBtn) {
                    resetZoomBtn.addEventListener('click', () => zoomImage('reset'));
                }
                
                // Keyboard navigation untuk lightbox
                document.addEventListener('keydown', function(e) {
                    const lightboxModal = document.getElementById('lightboxModal');
                    if (lightboxModal && lightboxModal.classList.contains('show')) {
                        if (e.key === 'ArrowLeft') {
                            navigateLightbox('prev');
                        } else if (e.key === 'ArrowRight') {
                            navigateLightbox('next');
                        } else if (e.key === 'Escape') {
                            const modal = bootstrap.Modal.getInstance(lightboxModal);
                            if (modal) modal.hide();
                        } else if (e.key === '+' || e.key === '=') {
                            zoomImage('in');
                            e.preventDefault();
                        } else if (e.key === '-' || e.key === '_') {
                            zoomImage('out');
                            e.preventDefault();
                        } else if (e.key === '0') {
                            zoomImage('reset');
                        }
                    }
                });
                
                // Tampilkan pesan selamat datang
                setTimeout(() => {
                    showNotification('Website Pemberdayaan Nelayan Situbondo dimuat', 'success');
                }, 1500);
                
                // Optimasi untuk resize window
                window.addEventListener('resize', function() {
                    if (statistikMap) {
                        setTimeout(() => {
                            statistikMap.invalidateSize();
                        }, 300);
                    }
                });
                
            } catch (error) {
                console.error('Error in DOMContentLoaded:', error);
                showNotification('Terjadi kesalahan saat memuat halaman.', 'error');
            }
        });
        
        // Ekspos fungsi ke global scope
        window.showDesaDetail = showDesaDetail;
        window.zoomToDesa = zoomToDesa;
        window.closeModal = closeModal;
        window.openLightbox = openLightbox;
        window.copyToClipboard = copyToClipboard;
        window.shareViaWhatsApp = shareViaWhatsApp;
        window.reloadDataFromFile = reloadDataFromFile;
    </script>
</body>
</html>
