<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Excel Scanner Pro | Aplikasi Pemindai Data Cerdas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), #4a6491);
            color: white;
            padding: 25px 30px;
            position: relative;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--accent-color);
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .logo-text p {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .app-version {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            margin-top: 20px;
            overflow: hidden;
        }
        
        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        .nav-tab.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-bottom: 3px solid var(--accent-color);
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            padding: 0;
            min-height: 700px;
        }
        
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
        }
        
        /* Left Panel */
        .left-panel {
            flex: 1;
            background-color: #f8fafc;
            padding: 25px;
            border-right: 1px solid #e9ecef;
            min-height: 100%;
        }
        
        /* Right Panel */
        .right-panel {
            flex: 2;
            padding: 25px;
            background-color: white;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Panel Card */
        .panel-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            margin-bottom: 25px;
            border-top: 4px solid var(--secondary-color);
        }
        
        .panel-card h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-card h3 i {
            color: var(--secondary-color);
        }
        
        /* Upload Area */
        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }
        
        .upload-area:hover {
            border-color: var(--secondary-color);
            background-color: rgba(52, 152, 219, 0.05);
        }
        
        .upload-area.dragover {
            border-color: var(--accent-color);
            background-color: rgba(46, 204, 113, 0.1);
        }
        
        .upload-icon {
            font-size: 3.5rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        
        .upload-text h4 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .upload-text p {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        /* File Info */
        .file-info {
            background-color: #edf2f7;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            display: none;
        }
        
        .file-info.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .file-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .file-info-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .file-info-value {
            color: #4a5568;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.95rem;
        }
        
        .btn i {
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--accent-color), #27ae60);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, var(--secondary-color), #2980b9);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--secondary-color);
            border: 2px solid var(--secondary-color);
        }
        
        .btn-outline:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--danger-color), #c0392b);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Button Groups */
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        /* Settings */
        .settings-group {
            margin-bottom: 25px;
        }
        
        .setting-item {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: var(--border-radius);
            border-left: 3px solid var(--secondary-color);
        }
        
        .setting-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .setting-description {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 10px;
        }
        
        /* Checkbox & Radio */
        .checkbox-group, .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Inputs */
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: var(--transition);
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            background: linear-gradient(to right, var(--primary-color), #3a506b);
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            user-select: none;
        }
        
        th:last-child {
            border-right: none;
        }
        
        th.sortable {
            cursor: pointer;
            position: relative;
        }
        
        th.sortable:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        th.sortable i {
            margin-left: 5px;
            opacity: 0.7;
        }
        
        tbody tr {
            border-bottom: 1px solid #e2e8f0;
            transition: var(--transition);
        }
        
        tbody tr:hover {
            background-color: #f7fafc;
        }
        
        tbody tr.duplicate {
            background-color: #fff5f5;
        }
        
        tbody tr.selected {
            background-color: #f0fff4;
            border-left: 4px solid var(--accent-color);
        }
        
        td {
            padding: 14px 12px;
            color: #4a5568;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-unique {
            background-color: #d1f7c4;
            color: #2e7d32;
        }
        
        .status-duplicate {
            background-color: #ffeaa7;
            color: #f39c12;
        }
        
        .status-selected {
            background-color: #d0ebff;
            color: #1971c2;
        }
        
        /* Statistics Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
            border-top: 4px solid;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.total {
            border-color: var(--secondary-color);
        }
        
        .stat-card.duplicates {
            border-color: var(--warning-color);
        }
        
        .stat-card.unique {
            border-color: var(--accent-color);
        }
        
        .stat-card.merged {
            border-color: #9b59b6;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #718096;
            font-weight: 600;
        }
        
        /* Filters */
        .filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f8fafc;
            border-radius: var(--border-radius);
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        /* Progress Bar */
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        
        .progress-container.show {
            display: block;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--accent-color), #27ae60);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            padding: 20px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            color: white;
            font-weight: 600;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.4s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--accent-color);
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #718096;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
            background-color: #f8fafc;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .panel-card {
                padding: 20px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .filters-container {
                flex-direction: column;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .main-content {
                padding: 0;
            }
            
            .left-panel, .right-panel {
                padding: 20px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            border-top-color: var(--secondary-color);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Advanced Options */
        .advanced-options {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .advanced-options.show {
            max-height: 500px;
            margin-top: 20px;
        }
        
        .toggle-advanced {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--secondary-color);
            font-weight: 600;
            cursor: pointer;
            padding: 10px 0;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Smart Excel Scanner Pro</h1>
                        <p>Aplikasi Pemindai Data Excel Cerdas</p>
                    </div>
                </div>
                <div class="app-version">
                    <i class="fas fa-code-branch"></i> v2.0 Professional
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="upload">
                    <i class="fas fa-upload"></i> Unggah Data
                </div>
                <div class="nav-tab" data-tab="process">
                    <i class="fas fa-cogs"></i> Proses Data
                </div>
                <div class="nav-tab" data-tab="results">
                    <i class="fas fa-chart-bar"></i> Hasil & Analisis
                </div>
                <div class="nav-tab" data-tab="export">
                    <i class="fas fa-download"></i> Ekspor Data
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- Tab 1: Upload Data -->
                <div id="upload-tab" class="tab-content active">
                    <div class="panel-card">
                        <h3><i class="fas fa-file-upload"></i> Unggah File Excel</h3>
                        
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">
                                <h4>Seret file Excel ke sini</h4>
                                <p>Atau klik untuk memilih file dari komputer Anda</p>
                                <p class="file-formats">Format yang didukung: .xlsx, .xls, .csv</p>
                            </div>
                            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" hidden>
                        </div>
                        
                        <!-- File Info -->
                        <div class="file-info" id="fileInfo">
                            <div class="file-info-row">
                                <span class="file-info-label">Nama File:</span>
                                <span class="file-info-value" id="fileName">-</span>
                            </div>
                            <div class="file-info-row">
                                <span class="file-info-label">Ukuran:</span>
                                <span class="file-info-value" id="fileSize">-</span>
                            </div>
                            <div class="file-info-row">
                                <span class="file-info-label">Jumlah Baris:</span>
                                <span class="file-info-value" id="fileRows">-</span>
                            </div>
                            <div class="file-info-row">
                                <span class="file-info-label">Kolom Terdeteksi:</span>
                                <span class="file-info-value" id="fileColumns">-</span>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="progress-container" id="uploadProgress">
                            <div class="progress-header">
                                <span>Memproses file...</span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn btn-primary" id="btnSelectFile">
                                <i class="fas fa-folder-open"></i> Pilih File
                            </button>
                            <button class="btn btn-outline" id="btnUseSample">
                                <i class="fas fa-vial"></i> Gunakan Data Contoh
                            </button>
                        </div>
                    </div>
                    
                    <!-- Data Preview -->
                    <div class="panel-card" id="previewCard" style="display: none;">
                        <h3><i class="fas fa-eye"></i> Pratinjau Data</h3>
                        <div class="table-container">
                            <table id="previewTable">
                                <thead>
                                    <tr id="previewHeader"></tr>
                                </thead>
                                <tbody id="previewBody"></tbody>
                            </table>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-secondary" id="btnNextToProcess">
                                <i class="fas fa-arrow-right"></i> Lanjut ke Proses Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 2: Process Data -->
                <div id="process-tab" class="tab-content">
                    <div class="panel-card">
                        <h3><i class="fas fa-sliders-h"></i> Pengaturan Pemindaian</h3>
                        
                        <div class="settings-group">
                            <div class="setting-item">
                                <label class="setting-label">Kolom NIK (Identifikasi Duplikat)</label>
                                <select id="nikColumn">
                                    <option value="">Pilih kolom NIK</option>
                                </select>
                                <p class="setting-description">Kolom ini akan digunakan untuk mendeteksi data duplikat</p>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">Metode Pemilihan Data Duplikat</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="methodComplete" name="duplicateMethod" value="complete" checked>
                                        <label for="methodComplete">Alamat Terlengkap</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="methodRecent" name="duplicateMethod" value="recent">
                                        <label for="methodRecent">Data Terbaru</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="methodFirst" name="duplicateMethod" value="first">
                                        <label for="methodFirst">Data Pertama</label>
                                    </div>
                                </div>
                                <p class="setting-description">Menentukan data mana yang akan dipertahankan saat ada duplikat</p>
                            </div>
                            
                            <button class="toggle-advanced" id="toggleAdvanced">
                                <i class="fas fa-chevron-down"></i> Opsi Lanjutan
                            </button>
                            
                            <div class="advanced-options" id="advancedOptions">
                                <div class="setting-item">
                                    <label class="setting-label">Kolom untuk Kelengkapan Alamat</label>
                                    <div class="checkbox-group" id="addressColumns"></div>
                                    <p class="setting-description">Pilih kolom yang akan digunakan untuk menilai kelengkapan alamat</p>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="setting-label">Validasi NIK</label>
                                    <div class="checkbox-group">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="validateNikLength" checked>
                                            <label for="validateNikLength">Validasi panjang NIK (16 digit)</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="validateNikNumeric" checked>
                                            <label for="validateNikNumeric">Validasi NIK harus angka</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="setting-label">Tindakan untuk Data Tidak Valid</label>
                                    <select id="invalidDataAction">
                                        <option value="exclude">Exclude dari hasil</option>
                                        <option value="include">Tetap masukkan ke hasil</option>
                                        <option value="separate">Pisahkan ke file terpisah</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn btn-primary" id="btnScanData">
                                <i class="fas fa-search"></i> Mulai Pemindaian
                            </button>
                            <button class="btn btn-outline" id="btnResetSettings">
                                <i class="fas fa-redo"></i> Reset Pengaturan
                            </button>
                        </div>
                    </div>
                    
                    <!-- Processing Results -->
                    <div class="panel-card" id="processingCard" style="display: none;">
                        <h3><i class="fas fa-tasks"></i> Status Pemrosesan</h3>
                        
                        <div class="progress-container show" id="processProgress">
                            <div class="progress-header">
                                <span>Memindai data...</span>
                                <span id="processPercent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="processFill"></div>
                            </div>
                        </div>
                        
                        <div id="processLogs"></div>
                        
                        <div class="btn-group" id="processButtons" style="display: none;">
                            <button class="btn btn-secondary" id="btnViewResults">
                                <i class="fas fa-chart-bar"></i> Lihat Hasil Lengkap
                            </button>
                            <button class="btn btn-outline" id="btnReconfigure">
                                <i class="fas fa-edit"></i> Konfigurasi Ulang
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 3: Results & Analysis -->
                <div id="results-tab" class="tab-content">
                    <div class="panel-card">
                        <h3><i class="fas fa-chart-pie"></i> Statistik Data</h3>
                        
                        <div class="stats-container">
                            <div class="stat-card total">
                                <div class="stat-value" id="statTotal">0</div>
                                <div class="stat-label">Total Data</div>
                            </div>
                            <div class="stat-card unique">
                                <div class="stat-value" id="statUnique">0</div>
                                <div class="stat-label">Data Unik</div>
                            </div>
                            <div class="stat-card duplicates">
                                <div class="stat-value" id="statDuplicates">0</div>
                                <div class="stat-label">Duplikat Ditemukan</div>
                            </div>
                            <div class="stat-card merged">
                                <div class="stat-value" id="statMerged">0</div>
                                <div class="stat-label">Data Digabungkan</div>
                            </div>
                        </div>
                        
                        <!-- Filters -->
                        <div class="filters-container">
                            <div class="filter-group">
                                <label class="filter-label">Filter Status</label>
                                <select id="filterStatus">
                                    <option value="all">Semua Data</option>
                                    <option value="unique">Data Unik</option>
                                    <option value="duplicate">Duplikat</option>
                                    <option value="selected">Data Terpilih</option>
                                    <option value="excluded">Data Dikecualikan</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label class="filter-label">Cari Data</label>
                                <input type="text" id="searchData" placeholder="Cari berdasarkan NIK atau Nama...">
                            </div>
                            
                            <div class="filter-group">
                                <label class="filter-label">&nbsp;</label>
                                <button class="btn btn-outline" id="btnApplyFilters">
                                    <i class="fas fa-filter"></i> Terapkan Filter
                                </button>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn btn-secondary" id="btnAnalyzeData">
                                <i class="fas fa-chart-line"></i> Analisis Lanjutan
                            </button>
                            <button class="btn btn-outline" id="btnExportResults">
                                <i class="fas fa-download"></i> Ekspor Hasil
                            </button>
                        </div>
                    </div>
                    
                    <!-- Data Issues -->
                    <div class="panel-card" id="issuesCard" style="display: none;">
                        <h3><i class="fas fa-exclamation-triangle"></i> Masalah Data</h3>
                        <div id="issuesList"></div>
                    </div>
                </div>
                
                <!-- Tab 4: Export Data -->
                <div id="export-tab" class="tab-content">
                    <div class="panel-card">
                        <h3><i class="fas fa-file-export"></i> Ekspor Data Hasil</h3>
                        
                        <div class="settings-group">
                            <div class="setting-item">
                                <label class="setting-label">Format Ekspor</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="formatExcel" name="exportFormat" value="excel" checked>
                                        <label for="formatExcel">Excel (.xlsx)</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="formatCSV" name="exportFormat" value="csv">
                                        <label for="formatCSV">CSV (.csv)</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="formatJSON" name="exportFormat" value="json">
                                        <label for="formatJSON">JSON (.json)</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">Data yang Diekspor</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="exportFiltered" name="exportData" value="filtered" checked>
                                        <label for="exportFiltered">Data Hasil (Setelah Filter)</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="exportAll" name="exportData" value="all">
                                        <label for="exportAll">Semua Data Hasil</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="exportIssues" name="exportData" value="issues">
                                        <label for="exportIssues">Hanya Data Bermasalah</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">Kolom yang Diekspor</label>
                                <div class="checkbox-group" id="exportColumns"></div>
                                <p class="setting-description">Pilih kolom yang akan disertakan dalam file ekspor</p>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">Nama File</label>
                                <input type="text" id="exportFileName" value="hasil_pemindaian_data" placeholder="Masukkan nama file">
                                <p class="setting-description">Nama file akan ditambahkan dengan tanggal ekspor</p>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn btn-primary" id="btnExportData">
                                <i class="fas fa-file-download"></i> Ekspor Sekarang
                            </button>
                            <button class="btn btn-outline" id="btnPreviewExport">
                                <i class="fas fa-eye"></i> Pratinjau Ekspor
                            </button>
                        </div>
                    </div>
                    
                    <!-- Export History -->
                    <div class="panel-card" id="historyCard" style="display: none;">
                        <h3><i class="fas fa-history"></i> Riwayat Ekspor</h3>
                        <div id="exportHistory"></div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Data Table -->
                <div class="panel-card">
                    <h3 id="tableTitle">
                        <i class="fas fa-table"></i> Tabel Data
                        <span id="tableCount" style="font-size: 0.9rem; color: #718096; margin-left: 10px;"></span>
                    </h3>
                    
                    <div class="table-actions">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <div>
                                <button class="btn btn-outline" id="btnSelectAll">
                                    <i class="fas fa-check-square"></i> Pilih Semua
                                </button>
                                <button class="btn btn-outline" id="btnDeselectAll">
                                    <i class="far fa-square"></i> Batalkan Pilihan
                                </button>
                            </div>
                            <div>
                                <button class="btn btn-outline" id="btnRefreshTable">
                                    <i class="fas fa-sync-alt"></i> Segarkan
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="dataTable">
                            <thead id="tableHeader"></thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div id="pagination" style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;"></div>
                </div>
                
                <!-- Data Summary -->
                <div class="panel-card" id="summaryCard" style="display: none;">
                    <h3><i class="fas fa-info-circle"></i> Ringkasan Data</h3>
                    <div id="dataSummary"></div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>Smart Excel Scanner Pro &copy; 2023 - Aplikasi Pemindai Data Excel Cerdas</p>
            <p>Dikembangkan dengan <i class="fas fa-heart" style="color:#e74c3c;"></i> untuk optimalisasi pengolahan data</p>
        </footer>
    </div>
    
    <!-- Modals -->
    <div class="modal" id="modalAdvancedAnalysis">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-chart-line"></i> Analisis Data Lanjutan</h3>
                <button class="close-modal" id="closeAdvancedModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="advancedAnalysisContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="btnCloseAdvancedModal">Tutup</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="modalExportPreview">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> Pratinjau Ekspor Data</h3>
                <button class="close-modal" id="closeExportPreview">&times;</button>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table id="exportPreviewTable">
                        <thead id="exportPreviewHeader"></thead>
                        <tbody id="exportPreviewBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="btnCloseExportPreview">Tutup</button>
                <button class="btn btn-primary" id="btnConfirmExport">Konfirmasi Ekspor</button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationMessage">Operasi berhasil diselesaikan!</span>
    </div>

    <script>
        // Global Variables
        let originalData = [];
        let processedData = [];
        let filteredData = [];
        let currentPage = 1;
        let rowsPerPage = 20;
        let columnDefinitions = [];
        let fileData = null;
        let scanningSettings = {
            nikColumn: '',
            duplicateMethod: 'complete',
            addressColumns: [],
            validateNikLength: true,
            validateNikNumeric: true,
            invalidDataAction: 'exclude'
        };
        
        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const fileInfo = document.getElementById('fileInfo');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressFill = document.getElementById('progressFill');
        const progressPercent = document.getElementById('progressPercent');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
            setupSampleData();
        });
        
        // Application Initialization
        function initApp() {
            // Initialize tooltips
            initTooltips();
            
            // Set default date for export filename
            const today = new Date().toISOString().slice(0, 10).replace(/-/g, '');
            document.getElementById('exportFileName').value = `hasil_pemindaian_${today}`;
            
            // Show first tab
            showTab('upload');
        }
        
        // Setup Event Listeners
        function setupEventListeners() {
            // Tab Navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    showTab(tabId);
                });
            });
            
            // File Upload
            document.getElementById('btnSelectFile').addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag and Drop
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                this.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect({ target: fileInput });
                }
            });
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            // Sample Data
            document.getElementById('btnUseSample').addEventListener('click', loadSampleData);
            
            // Navigation Buttons
            document.getElementById('btnNextToProcess').addEventListener('click', () => showTab('process'));
            document.getElementById('btnViewResults').addEventListener('click', () => showTab('results'));
            
            // Process Data
            document.getElementById('btnScanData').addEventListener('click', scanData);
            document.getElementById('btnResetSettings').addEventListener('click', resetSettings);
            document.getElementById('toggleAdvanced').addEventListener('click', toggleAdvancedOptions);
            
            // Table Actions
            document.getElementById('btnSelectAll').addEventListener('click', selectAllRows);
            document.getElementById('btnDeselectAll').addEventListener('click', deselectAllRows);
            document.getElementById('btnRefreshTable').addEventListener('click', refreshTable);
            
            // Filters
            document.getElementById('btnApplyFilters').addEventListener('click', applyFilters);
            document.getElementById('searchData').addEventListener('input', debounce(applyFilters, 300));
            
            // Export
            document.getElementById('btnExportData').addEventListener('click', exportData);
            document.getElementById('btnPreviewExport').addEventListener('click', previewExport);
            document.getElementById('btnConfirmExport').addEventListener('click', confirmExport);
            
            // Modals
            document.getElementById('closeAdvancedModal').addEventListener('click', () => hideModal('modalAdvancedAnalysis'));
            document.getElementById('btnCloseAdvancedModal').addEventListener('click', () => hideModal('modalAdvancedAnalysis'));
            document.getElementById('closeExportPreview').addEventListener('click', () => hideModal('modalExportPreview'));
            document.getElementById('btnCloseExportPreview').addEventListener('click', () => hideModal('modalExportPreview'));
            
            // Analysis
            document.getElementById('btnAnalyzeData').addEventListener('click', showAdvancedAnalysis);
            
            // Initialize settings
            resetSettings();
        }
        
        // Tab Management
        function showTab(tabId) {
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.nav-tab[data-tab="${tabId}"]`).classList.add('active');
            
            // Show active tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');
            
            // Update UI based on tab
            if (tabId === 'results' && processedData.length > 0) {
                updateStatistics();
                displayDataTable();
            }
            
            if (tabId === 'export' && processedData.length > 0) {
                setupExportOptions();
            }
        }
        
        // File Handling
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Validate file type
            const validTypes = ['application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'text/csv'];
            if (!validTypes.includes(file.type) && !file.name.match(/\.(xlsx|xls|csv)$/)) {
                showNotification('Format file tidak didukung. Silakan pilih file Excel (.xlsx, .xls) atau CSV (.csv)', 'error');
                return;
            }
            
            // Show file info
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            fileInfo.classList.add('show');
            
            // Show progress
            uploadProgress.classList.add('show');
            updateProgress(10);
            
            // Read file
            const reader = new FileReader();
            reader.onload = function(e) {
                updateProgress(30);
                
                try {
                    let data;
                    if (file.name.endsWith('.csv')) {
                        data = parseCSV(e.target.result);
                    } else {
                        data = parseExcel(e.target.result, file);
                    }
                    
                    updateProgress(70);
                    
                    if (data.length === 0) {
                        throw new Error('File tidak mengandung data');
                    }
                    
                    // Store file data
                    fileData = {
                        name: file.name,
                        size: file.size,
                        rows: data.length,
                        columns: Object.keys(data[0]),
                        data: data
                    };
                    
                    // Update file info
                    document.getElementById('fileRows').textContent = data.length;
                    document.getElementById('fileColumns').textContent = Object.keys(data[0]).join(', ');
                    
                    // Store original data
                    originalData = data;
                    
                    // Show preview
                    showDataPreview(data);
                    
                    // Setup process settings
                    setupProcessSettings(data[0]);
                    
                    updateProgress(100);
                    
                    setTimeout(() => {
                        uploadProgress.classList.remove('show');
                        showNotification('File berhasil diunggah dan siap diproses', 'success');
                    }, 500);
                    
                } catch (error) {
                    console.error('Error parsing file:', error);
                    showNotification(`Error membaca file: ${error.message}`, 'error');
                    uploadProgress.classList.remove('show');
                }
            };
            
            reader.onerror = function() {
                showNotification('Gagal membaca file', 'error');
                uploadProgress.classList.remove('show');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // Parse Excel File
        function parseExcel(data, file) {
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheet = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheet];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            // Clean up column names
            return jsonData.map(row => {
                const cleanRow = {};
                Object.keys(row).forEach(key => {
                    const cleanKey = key.trim().toLowerCase();
                    cleanRow[cleanKey] = row[key];
                });
                return cleanRow;
            });
        }
        
        // Parse CSV File
        function parseCSV(data) {
            const lines = data.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] ? values[index].trim() : '';
                });
                return row;
            }).filter(row => Object.values(row).some(v => v !== ''));
        }
        
        // Show Data Preview
        function showDataPreview(data) {
            const previewCard = document.getElementById('previewCard');
            const previewHeader = document.getElementById('previewHeader');
            const previewBody = document.getElementById('previewBody');
            
            // Clear previous preview
            previewHeader.innerHTML = '';
            previewBody.innerHTML = '';
            
            // Get columns from first row
            const columns = Object.keys(data[0]);
            
            // Create header
            columns.forEach(column => {
                const th = document.createElement('th');
                th.textContent = column.toUpperCase();
                previewHeader.appendChild(th);
            });
            
            // Create rows (limit to 10 for preview)
            const previewRows = data.slice(0, 10);
            previewRows.forEach(row => {
                const tr = document.createElement('tr');
                columns.forEach(column => {
                    const td = document.createElement('td');
                    td.textContent = row[column] || '';
                    tr.appendChild(td);
                });
                previewBody.appendChild(tr);
            });
            
            // Show preview card
            previewCard.style.display = 'block';
        }
        
        // Setup Process Settings
        function setupProcessSettings(firstRow) {
            const columns = Object.keys(firstRow);
            const nikColumnSelect = document.getElementById('nikColumn');
            const addressColumnsDiv = document.getElementById('addressColumns');
            
            // Clear previous options
            nikColumnSelect.innerHTML = '<option value="">Pilih kolom NIK</option>';
            addressColumnsDiv.innerHTML = '';
            
            // Add column options
            columns.forEach(column => {
                // NIK column select
                const option = document.createElement('option');
                option.value = column;
                option.textContent = column;
                
                // Auto-select if column name contains 'nik'
                if (column.includes('nik')) {
                    option.selected = true;
                    scanningSettings.nikColumn = column;
                }
                
                nikColumnSelect.appendChild(option);
                
                // Address columns checkboxes
                if (column.includes('alamat') || column.includes('kecamatan') || column.includes('desa') || 
                    column.includes('address') || column.includes('kelurahan') || column.includes('kota')) {
                    
                    const checkboxItem = document.createElement('div');
                    checkboxItem.className = 'checkbox-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `col_${column}`;
                    checkbox.value = column;
                    
                    // Auto-check address-related columns
                    if (column.includes('alamat') || column.includes('address')) {
                        checkbox.checked = true;
                        scanningSettings.addressColumns.push(column);
                    }
                    
                    const label = document.createElement('label');
                    label.htmlFor = `col_${column}`;
                    label.textContent = column;
                    
                    checkboxItem.appendChild(checkbox);
                    checkboxItem.appendChild(label);
                    addressColumnsDiv.appendChild(checkboxItem);
                    
                    // Add event listener
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            scanningSettings.addressColumns.push(this.value);
                        } else {
                            scanningSettings.addressColumns = scanningSettings.addressColumns.filter(col => col !== this.value);
                        }
                    });
                }
            });
            
            // Add event listener for NIK column change
            nikColumnSelect.addEventListener('change', function() {
                scanningSettings.nikColumn = this.value;
            });
            
            // Add event listeners for duplicate method
            document.querySelectorAll('input[name="duplicateMethod"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    scanningSettings.duplicateMethod = this.value;
                });
            });
            
            // Add event listeners for validation options
            document.getElementById('validateNikLength').addEventListener('change', function() {
                scanningSettings.validateNikLength = this.checked;
            });
            
            document.getElementById('validateNikNumeric').addEventListener('change', function() {
                scanningSettings.validateNikNumeric = this.checked;
            });
            
            // Add event listener for invalid data action
            document.getElementById('invalidDataAction').addEventListener('change', function() {
                scanningSettings.invalidDataAction = this.value;
            });
        }
        
        // Scan Data
        function scanData() {
            if (!scanningSettings.nikColumn) {
                showNotification('Silakan pilih kolom NIK terlebih dahulu', 'warning');
                return;
            }
            
            if (originalData.length === 0) {
                showNotification('Tidak ada data untuk diproses', 'error');
                return;
            }
            
            // Show processing card
            const processingCard = document.getElementById('processingCard');
            const processLogs = document.getElementById('processLogs');
            const processButtons = document.getElementById('processButtons');
            const processProgress = document.getElementById('processProgress');
            const processFill = document.getElementById('processFill');
            const processPercent = document.getElementById('processPercent');
            
            processingCard.style.display = 'block';
            processLogs.innerHTML = '';
            processButtons.style.display = 'none';
            
            // Start progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                if (progress > 90) clearInterval(progressInterval);
                processFill.style.width = `${progress}%`;
                processPercent.textContent = `${progress}%`;
            }, 100);
            
            // Add log
            addProcessLog('Memulai pemindaian data...');
            
            // Process data asynchronously
            setTimeout(() => {
                try {
                    addProcessLog('Mengelompokkan data berdasarkan NIK...');
                    
                    // Group data by NIK
                    const groups = {};
                    const invalidData = [];
                    
                    originalData.forEach((item, index) => {
                        const nik = item[scanningSettings.nikColumn];
                        
                        // Validate NIK
                        if (scanningSettings.validateNikLength && nik && nik.toString().length !== 16) {
                            item._status = 'invalid_length';
                            invalidData.push(item);
                            return;
                        }
                        
                        if (scanningSettings.validateNikNumeric && nik && !/^\d+$/.test(nik.toString())) {
                            item._status = 'invalid_numeric';
                            invalidData.push(item);
                            return;
                        }
                        
                        if (!nik) {
                            item._status = 'missing_nik';
                            invalidData.push(item);
                            return;
                        }
                        
                        const nikKey = nik.toString();
                        
                        if (!groups[nikKey]) {
                            groups[nikKey] = [];
                        }
                        
                        item._index = index;
                        item._nik = nikKey;
                        item._selected = false;
                        groups[nikKey].push(item);
                    });
                    
                    addProcessLog(`Data dikelompokkan menjadi ${Object.keys(groups).length} kelompok NIK`);
                    
                    // Process each group
                    processedData = [];
                    let duplicateCount = 0;
                    
                    Object.keys(groups).forEach((nik, groupIndex) => {
                        const group = groups[nik];
                        
                        if (group.length === 1) {
                            // Unique data
                            group[0]._status = 'unique';
                            group[0]._selected = true;
                            processedData.push(group[0]);
                        } else {
                            // Duplicate data - select based on method
                            duplicateCount += group.length - 1;
                            
                            let selectedItem;
                            
                            switch (scanningSettings.duplicateMethod) {
                                case 'complete':
                                    // Select item with most complete address
                                    selectedItem = selectByAddressCompleteness(group);
                                    break;
                                case 'recent':
                                    // Select last item (assuming last is most recent)
                                    selectedItem = group[group.length - 1];
                                    break;
                                case 'first':
                                    // Select first item
                                    selectedItem = group[0];
                                    break;
                                default:
                                    selectedItem = group[0];
                            }
                            
                            // Mark all items
                            group.forEach(item => {
                                item._status = 'duplicate';
                                item._selected = (item === selectedItem);
                            });
                            
                            processedData.push(selectedItem);
                        }
                    });
                    
                    // Handle invalid data based on setting
                    switch (scanningSettings.invalidDataAction) {
                        case 'include':
                            invalidData.forEach(item => {
                                item._status = 'invalid_included';
                                item._selected = true;
                                processedData.push(item);
                            });
                            break;
                        case 'separate':
                            // Store invalid data separately
                            window.invalidData = invalidData;
                            break;
                        case 'exclude':
                        default:
                            // Do nothing - data is excluded
                            break;
                    }
                    
                    addProcessLog(`Pemindaian selesai: ${processedData.length} data unik ditemukan`);
                    addProcessLog(`${duplicateCount} data duplikat diidentifikasi`);
                    
                    if (invalidData.length > 0) {
                        addProcessLog(`${invalidData.length} data tidak valid ditemukan`, 'warning');
                    }
                    
                    // Update progress to 100%
                    clearInterval(progressInterval);
                    processFill.style.width = '100%';
                    processPercent.textContent = '100%';
                    
                    // Show complete message
                    setTimeout(() => {
                        addProcessLog('Pemrosesan data selesai!', 'success');
                        processButtons.style.display = 'flex';
                        showNotification('Pemindaian data berhasil diselesaikan', 'success');
                        
                        // Show results tab
                        showTab('results');
                    }, 500);
                    
                } catch (error) {
                    console.error('Error processing data:', error);
                    addProcessLog(`Error: ${error.message}`, 'error');
                    showNotification(`Error memproses data: ${error.message}`, 'error');
                }
            }, 1000);
        }
        
        // Select item by address completeness
        function selectByAddressCompleteness(group) {
            let bestScore = -1;
            let bestItem = group[0];
            
            group.forEach(item => {
                let score = 0;
                
                // Calculate completeness score
                scanningSettings.addressColumns.forEach(column => {
                    const value = item[column];
                    if (value && value.toString().trim() !== '') {
                        score += 1;
                        // Bonus for longer values (more detailed)
                        score += value.toString().length * 0.001;
                    }
                });
                
                // Bonus for having specific address components
                if (item.alamat && item.alamat.toString().includes('RT') && item.alamat.toString().includes('RW')) {
                    score += 2;
                }
                
                if (item.alamat && item.alamat.toString().includes('No.')) {
                    score += 1;
                }
                
                if (score > bestScore) {
                    bestScore = score;
                    bestItem = item;
                }
            });
            
            return bestItem;
        }
        
        // Add process log
        function addProcessLog(message, type = 'info') {
            const processLogs = document.getElementById('processLogs');
            const logEntry = document.createElement('div');
            logEntry.className = 'process-log';
            logEntry.innerHTML = `
                <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}" 
                   style="color: ${type === 'error' ? '#e74c3c' : type === 'warning' ? '#f39c12' : '#3498db'}; margin-right: 8px;"></i>
                ${message}
                <span style="color: #718096; font-size: 0.9rem; margin-left: 10px;">${new Date().toLocaleTimeString()}</span>
            `;
            processLogs.appendChild(logEntry);
            processLogs.scrollTop = processLogs.scrollHeight;
        }
        
        // Update Statistics
        function updateStatistics() {
            const total = originalData.length;
            const unique = processedData.filter(item => item._status === 'unique').length;
            const duplicates = processedData.filter(item => item._status === 'duplicate' && item._selected).length;
            const merged = originalData.length - processedData.length;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statUnique').textContent = unique;
            document.getElementById('statDuplicates').textContent = duplicates;
            document.getElementById('statMerged').textContent = merged;
            
            // Update table count
            document.getElementById('tableCount').textContent = `(${filteredData.length || processedData.length} data)`;
        }
        
        // Display Data Table
        function displayDataTable() {
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            
            // Clear table
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            
            // Use filtered data or all processed data
            const dataToDisplay = filteredData.length > 0 ? filteredData : processedData;
            
            if (dataToDisplay.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 40px; color: #718096;">
                            <i class="fas fa-database" style="font-size: 3rem; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                            Tidak ada data untuk ditampilkan
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Get columns from first item
            const firstItem = dataToDisplay[0];
            const columns = Object.keys(firstItem).filter(key => !key.startsWith('_'));
            
            // Add status column
            columns.push('_status');
            
            // Create header
            const headerRow = document.createElement('tr');
            columns.forEach(column => {
                const th = document.createElement('th');
                th.className = column.startsWith('_') ? '' : 'sortable';
                th.textContent = formatColumnName(column);
                
                if (column.startsWith('_')) {
                    // Status column
                    if (column === '_status') {
                        th.innerHTML = 'STATUS <i class="fas fa-sort"></i>';
                    }
                } else {
                    th.innerHTML = `${column.toUpperCase()} <i class="fas fa-sort"></i>`;
                    
                    // Add sorting functionality
                    th.addEventListener('click', () => sortTable(column));
                }
                
                headerRow.appendChild(th);
            });
            tableHeader.appendChild(headerRow);
            
            // Create rows for current page
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const pageData = dataToDisplay.slice(startIndex, endIndex);
            
            pageData.forEach((item, index) => {
                const row = document.createElement('tr');
                if (item._status === 'duplicate') row.classList.add('duplicate');
                if (item._selected) row.classList.add('selected');
                
                columns.forEach(column => {
                    const td = document.createElement('td');
                    
                    if (column === '_status') {
                        // Status badge
                        const badge = document.createElement('span');
                        badge.className = 'status-badge';
                        
                        switch (item._status) {
                            case 'unique':
                                badge.classList.add('status-unique');
                                badge.textContent = 'UNIK';
                                break;
                            case 'duplicate':
                                badge.classList.add(item._selected ? 'status-selected' : 'status-duplicate');
                                badge.textContent = item._selected ? 'DIPILIH' : 'DUPLIKAT';
                                break;
                            case 'invalid_length':
                            case 'invalid_numeric':
                            case 'missing_nik':
                                badge.classList.add('status-duplicate');
                                badge.textContent = 'TIDAK VALID';
                                break;
                            case 'invalid_included':
                                badge.classList.add('status-duplicate');
                                badge.textContent = 'TIDAK VALID';
                                break;
                            default:
                                badge.textContent = item._status || '-';
                        }
                        
                        td.appendChild(badge);
                    } else {
                        td.textContent = item[column] || '';
                    }
                    
                    row.appendChild(td);
                });
                
                tableBody.appendChild(row);
            });
            
            // Update pagination
            updatePagination(dataToDisplay.length);
        }
        
        // Sort Table
        function sortTable(column) {
            const dataToSort = filteredData.length > 0 ? filteredData : processedData;
            
            dataToSort.sort((a, b) => {
                const valA = a[column] || '';
                const valB = b[column] || '';
                
                if (typeof valA === 'string' && typeof valB === 'string') {
                    return valA.localeCompare(valB);
                }
                
                return (valA > valB) ? 1 : (valA < valB) ? -1 : 0;
            });
            
            if (filteredData.length > 0) {
                filteredData = dataToSort;
            } else {
                processedData = dataToSort;
            }
            
            displayDataTable();
        }
        
        // Update Pagination
        function updatePagination(totalItems) {
            const paginationDiv = document.getElementById('pagination');
            const totalPages = Math.ceil(totalItems / rowsPerPage);
            
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let paginationHTML = `
                <div>
                    <span style="color: #718096;">Menampilkan ${Math.min(rowsPerPage, totalItems)} dari ${totalItems} data</span>
                </div>
                <div style="display: flex; gap: 5px;">
            `;
            
            // Previous button
            paginationHTML += `
                <button class="btn btn-outline" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})" style="padding: 8px 12px;">
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `
                        <button class="btn ${i === currentPage ? 'btn-primary' : 'btn-outline'}" onclick="changePage(${i})" style="padding: 8px 12px;">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += `<span style="padding: 8px 5px;">...</span>`;
                }
            }
            
            // Next button
            paginationHTML += `
                <button class="btn btn-outline" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})" style="padding: 8px 12px;">
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            paginationHTML += `</div>`;
            
            paginationDiv.innerHTML = paginationHTML;
        }
        
        // Change Page
        function changePage(page) {
            currentPage = page;
            displayDataTable();
        }
        
        // Apply Filters
        function applyFilters() {
            const statusFilter = document.getElementById('filterStatus').value;
            const searchTerm = document.getElementById('searchData').value.toLowerCase();
            
            filteredData = processedData.filter(item => {
                // Status filter
                if (statusFilter !== 'all') {
                    if (statusFilter === 'unique' && item._status !== 'unique') return false;
                    if (statusFilter === 'duplicate' && item._status !== 'duplicate') return false;
                    if (statusFilter === 'selected' && !item._selected) return false;
                    if (statusFilter === 'excluded' && item._status && item._status.includes('invalid')) return false;
                }
                
                // Search filter
                if (searchTerm) {
                    const searchableFields = ['nama', 'nik', 'alamat', 'kecamatan', 'desa'];
                    const matches = searchableFields.some(field => {
                        const value = item[field];
                        return value && value.toString().toLowerCase().includes(searchTerm);
                    });
                    
                    if (!matches) return false;
                }
                
                return true;
            });
            
            currentPage = 1;
            displayDataTable();
            updateStatistics();
            
            // Update table count
            document.getElementById('tableCount').textContent = `(${filteredData.length} data)`;
        }
        
        // Setup Export Options
        function setupExportOptions() {
            const exportColumnsDiv = document.getElementById('exportColumns');
            exportColumnsDiv.innerHTML = '';
            
            if (processedData.length === 0) return;
            
            // Get all columns from first item (excluding internal fields)
            const firstItem = processedData[0];
            const columns = Object.keys(firstItem).filter(key => !key.startsWith('_'));
            
            // Add status column option
            columns.push('_status_display');
            
            columns.forEach(column => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `export_${column}`;
                checkbox.value = column;
                checkbox.checked = true;
                
                const label = document.createElement('label');
                label.htmlFor = `export_${column}`;
                label.textContent = formatColumnName(column);
                
                checkboxItem.appendChild(checkbox);
                checkboxItem.appendChild(label);
                exportColumnsDiv.appendChild(checkboxItem);
            });
        }
        
        // Export Data
        function exportData() {
            const exportFormat = document.querySelector('input[name="exportFormat"]:checked').value;
            const exportDataType = document.querySelector('input[name="exportData"]:checked').value;
            const exportFileName = document.getElementById('exportFileName').value || 'hasil_pemindaian';
            
            // Get selected columns
            const selectedColumns = [];
            document.querySelectorAll('#exportColumns input:checked').forEach(checkbox => {
                selectedColumns.push(checkbox.value);
            });
            
            if (selectedColumns.length === 0) {
                showNotification('Pilih minimal satu kolom untuk diekspor', 'warning');
                return;
            }
            
            // Get data to export
            let dataToExport;
            switch (exportDataType) {
                case 'filtered':
                    dataToExport = filteredData.length > 0 ? filteredData : processedData;
                    break;
                case 'all':
                    dataToExport = processedData;
                    break;
                case 'issues':
                    dataToExport = processedData.filter(item => 
                        item._status && (item._status.includes('invalid') || item._status === 'duplicate' && !item._selected)
                    );
                    break;
                default:
                    dataToExport = processedData;
            }
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk diekspor', 'warning');
                return;
            }
            
            // Prepare data for export
            const exportData = dataToExport.map(item => {
                const exportItem = {};
                
                selectedColumns.forEach(column => {
                    if (column === '_status_display') {
                        // Format status for display
                        switch (item._status) {
                            case 'unique':
                                exportItem['Status'] = 'Data Unik';
                                break;
                            case 'duplicate':
                                exportItem['Status'] = item._selected ? 'Data Terpilih (Duplikat)' : 'Data Duplikat';
                                break;
                            case 'invalid_length':
                                exportItem['Status'] = 'NIK Tidak Valid (Panjang)';
                                break;
                            case 'invalid_numeric':
                                exportItem['Status'] = 'NIK Tidak Valid (Format)';
                                break;
                            case 'missing_nik':
                                exportItem['Status'] = 'NIK Kosong';
                                break;
                            case 'invalid_included':
                                exportItem['Status'] = 'Data Tidak Valid (Tetap Disertakan)';
                                break;
                            default:
                                exportItem['Status'] = item._status || '';
                        }
                    } else {
                        // Use formatted column name
                        const columnName = formatColumnName(column);
                        exportItem[columnName] = item[column] || '';
                    }
                });
                
                return exportItem;
            });
            
            // Export based on format
            const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g, '');
            const filename = `${exportFileName}_${dateStr}`;
            
            try {
                switch (exportFormat) {
                    case 'excel':
                        exportToExcel(exportData, filename);
                        break;
                    case 'csv':
                        exportToCSV(exportData, filename);
                        break;
                    case 'json':
                        exportToJSON(exportData, filename);
                        break;
                }
                
                showNotification(`Data berhasil diekspor (${exportData.length} records)`, 'success');
                
                // Add to export history
                addExportHistory(filename, exportFormat, exportData.length);
                
            } catch (error) {
                console.error('Export error:', error);
                showNotification(`Gagal mengekspor data: ${error.message}`, 'error');
            }
        }
        
        // Export to Excel
        function exportToExcel(data, filename) {
            const worksheet = XLSX.utils.json_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Data Hasil");
            XLSX.writeFile(workbook, `${filename}.xlsx`);
        }
        
        // Export to CSV
        function exportToCSV(data, filename) {
            const headers = Object.keys(data[0]);
            const csvRows = [
                headers.join(','),
                ...data.map(row => headers.map(header => {
                    const cell = row[header];
                    return typeof cell === 'string' && cell.includes(',') ? `"${cell}"` : cell;
                }).join(','))
            ];
            
            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}.csv`;
            link.click();
        }
        
        // Export to JSON
        function exportToJSON(data, filename) {
            const jsonContent = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonContent], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}.json`;
            link.click();
        }
        
        // Preview Export
        function previewExport() {
            // Similar to exportData but shows preview in modal
            const exportDataType = document.querySelector('input[name="exportData"]:checked').value;
            
            // Get selected columns
            const selectedColumns = [];
            document.querySelectorAll('#exportColumns input:checked').forEach(checkbox => {
                selectedColumns.push(checkbox.value);
            });
            
            if (selectedColumns.length === 0) {
                showNotification('Pilih minimal satu kolom untuk dipratinjau', 'warning');
                return;
            }
            
            // Get data to export
            let dataToExport;
            switch (exportDataType) {
                case 'filtered':
                    dataToExport = filteredData.length > 0 ? filteredData : processedData;
                    break;
                case 'all':
                    dataToExport = processedData;
                    break;
                case 'issues':
                    dataToExport = processedData.filter(item => 
                        item._status && (item._status.includes('invalid') || item._status === 'duplicate' && !item._selected)
                    );
                    break;
                default:
                    dataToExport = processedData;
            }
            
            if (dataToExport.length === 0) {
                showNotification('Tidak ada data untuk dipratinjau', 'warning');
                return;
            }
            
            // Prepare preview data (first 10 rows)
            const previewData = dataToExport.slice(0, 10).map(item => {
                const previewItem = {};
                
                selectedColumns.forEach(column => {
                    if (column === '_status_display') {
                        // Format status for display
                        switch (item._status) {
                            case 'unique':
                                previewItem['Status'] = 'Data Unik';
                                break;
                            case 'duplicate':
                                previewItem['Status'] = item._selected ? 'Data Terpilih (Duplikat)' : 'Data Duplikat';
                                break;
                            case 'invalid_length':
                                previewItem['Status'] = 'NIK Tidak Valid (Panjang)';
                                break;
                            case 'invalid_numeric':
                                previewItem['Status'] = 'NIK Tidak Valid (Format)';
                                break;
                            case 'missing_nik':
                                previewItem['Status'] = 'NIK Kosong';
                                break;
                            default:
                                previewItem['Status'] = item._status || '';
                        }
                    } else {
                        // Use formatted column name
                        const columnName = formatColumnName(column);
                        previewItem[columnName] = item[column] || '';
                    }
                });
                
                return previewItem;
            });
            
            // Display preview in modal
            const previewHeader = document.getElementById('exportPreviewHeader');
            const previewBody = document.getElementById('exportPreviewBody');
            
            previewHeader.innerHTML = '';
            previewBody.innerHTML = '';
            
            // Create header
            if (previewData.length > 0) {
                const headers = Object.keys(previewData[0]);
                const headerRow = document.createElement('tr');
                
                headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                
                previewHeader.appendChild(headerRow);
                
                // Create rows
                previewData.forEach(row => {
                    const tr = document.createElement('tr');
                    headers.forEach(header => {
                        const td = document.createElement('td');
                        td.textContent = row[header] || '';
                        tr.appendChild(td);
                    });
                    previewBody.appendChild(tr);
                });
            }
            
            // Show modal
            showModal('modalExportPreview');
        }
        
        // Confirm Export (from preview modal)
        function confirmExport() {
            hideModal('modalExportPreview');
            exportData();
        }
        
        // Show Advanced Analysis
        function showAdvancedAnalysis() {
            const analysisContent = document.getElementById('advancedAnalysisContent');
            
            if (processedData.length === 0) {
                analysisContent.innerHTML = '<p>Tidak ada data untuk dianalisis</p>';
                showModal('modalAdvancedAnalysis');
                return;
            }
            
            // Calculate statistics
            const total = originalData.length;
            const unique = processedData.filter(item => item._status === 'unique').length;
            const duplicates = processedData.filter(item => item._status === 'duplicate').length;
            const selectedDuplicates = processedData.filter(item => item._status === 'duplicate' && item._selected).length;
            const invalid = processedData.filter(item => item._status && item._status.includes('invalid')).length;
            
            // Group by status
            const statusCounts = {};
            processedData.forEach(item => {
                const status = item._status || 'unknown';
                statusCounts[status] = (statusCounts[status] || 0) + 1;
            });
            
            // Create analysis HTML
            let analysisHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 15px;">Statistik Lengkap</h4>
                    <div class="stats-container" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="stat-card total">
                            <div class="stat-value">${total}</div>
                            <div class="stat-label">Total Data Awal</div>
                        </div>
                        <div class="stat-card unique">
                            <div class="stat-value">${unique}</div>
                            <div class="stat-label">Data Unik</div>
                        </div>
                        <div class="stat-card duplicates">
                            <div class="stat-value">${duplicates}</div>
                            <div class="stat-label">Total Duplikat</div>
                        </div>
                        <div class="stat-card merged">
                            <div class="stat-value">${selectedDuplicates}</div>
                            <div class="stat-label">Duplikat Terpilih</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 15px;">Distribusi Status Data</h4>
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: var(--border-radius);">
            `;
            
            Object.keys(statusCounts).forEach(status => {
                const count = statusCounts[status];
                const percentage = ((count / processedData.length) * 100).toFixed(1);
                
                let statusLabel = status;
                switch (status) {
                    case 'unique': statusLabel = 'Data Unik'; break;
                    case 'duplicate': statusLabel = 'Data Duplikat'; break;
                    case 'invalid_length': statusLabel = 'NIK Panjang Tidak Valid'; break;
                    case 'invalid_numeric': statusLabel = 'NIK Format Tidak Valid'; break;
                    case 'missing_nik': statusLabel = 'NIK Kosong'; break;
                    case 'invalid_included': statusLabel = 'Data Tidak Valid (Disertakan)'; break;
                }
                
                analysisHTML += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${statusLabel}</span>
                            <span>${count} (${percentage}%)</span>
                        </div>
                        <div style="height: 8px; background-color: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${percentage}%; background-color: var(--secondary-color);"></div>
                        </div>
                    </div>
                `;
            });
            
            analysisHTML += `
                    </div>
                </div>
                
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: 15px;">Rekomendasi</h4>
                    <div style="background-color: #f0fff4; padding: 15px; border-radius: var(--border-radius); border-left: 4px solid var(--accent-color);">
            `;
            
            if (duplicates > 0) {
                analysisHTML += `<p><i class="fas fa-check-circle" style="color: var(--accent-color); margin-right: 8px;"></i> ${duplicates} data duplikat telah berhasil diidentifikasi dan diproses.</p>`;
            }
            
            if (invalid > 0) {
                analysisHTML += `<p><i class="fas fa-exclamation-triangle" style="color: var(--warning-color); margin-right: 8px;"></i> ${invalid} data tidak valid ditemukan. Periksa validitas data NIK.</p>`;
            }
            
            if (unique === total) {
                analysisHTML += `<p><i class="fas fa-info-circle" style="color: var(--secondary-color); margin-right: 8px;"></i> Tidak ada data duplikat ditemukan. Data sudah bersih.</p>`;
            }
            
            analysisHTML += `
                    </div>
                </div>
            `;
            
            analysisContent.innerHTML = analysisHTML;
            showModal('modalAdvancedAnalysis');
        }
        
        // Helper Functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatColumnName(column) {
            if (column.startsWith('_')) {
                return column.replace('_', '').toUpperCase();
            }
            
            // Convert snake_case or camelCase to Title Case
            return column
                .replace(/_/g, ' ')
                .replace(/([A-Z])/g, ' $1')
                .replace(/^./, str => str.toUpperCase())
                .trim();
        }
        
        function updateProgress(percent) {
            progressFill.style.width = `${percent}%`;
            progressPercent.textContent = `${percent}%`;
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notificationMessage');
            
            notification.className = `notification ${type}`;
            notificationMessage.textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        function resetSettings() {
            scanningSettings = {
                nikColumn: '',
                duplicateMethod: 'complete',
                addressColumns: ['alamat', 'kecamatan', 'desa'],
                validateNikLength: true,
                validateNikNumeric: true,
                invalidDataAction: 'exclude'
            };
            
            // Update UI
            document.getElementById('validateNikLength').checked = true;
            document.getElementById('validateNikNumeric').checked = true;
            document.getElementById('invalidDataAction').value = 'exclude';
            document.querySelector('input[name="duplicateMethod"][value="complete"]').checked = true;
            
            showNotification('Pengaturan telah direset ke default', 'success');
        }
        
        function toggleAdvancedOptions() {
            const advancedOptions = document.getElementById('advancedOptions');
            const toggleIcon = document.getElementById('toggleAdvanced').querySelector('i');
            
            if (advancedOptions.classList.contains('show')) {
                advancedOptions.classList.remove('show');
                toggleIcon.className = 'fas fa-chevron-down';
            } else {
                advancedOptions.classList.add('show');
                toggleIcon.className = 'fas fa-chevron-up';
            }
        }
        
        function selectAllRows() {
            // Implementation for selecting all rows
            showNotification('Fitur pilih semua diaktifkan', 'info');
        }
        
        function deselectAllRows() {
            // Implementation for deselecting all rows
            showNotification('Semua pilihan dibatalkan', 'info');
        }
        
        function refreshTable() {
            displayDataTable();
            showNotification('Tabel data diperbarui', 'success');
        }
        
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        function addExportHistory(filename, format, recordCount) {
            // Implementation for export history
            console.log(`Exported: ${filename}.${format} (${recordCount} records)`);
        }
        
        function initTooltips() {
            // Simple tooltip implementation
            const tooltipElements = document.querySelectorAll('[title]');
            tooltipElements.forEach(el => {
                el.addEventListener('mouseenter', function(e) {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = this.title;
                    tooltip.style.position = 'absolute';
                    tooltip.style.backgroundColor = 'rgba(0,0,0,0.8)';
                    tooltip.style.color = 'white';
                    tooltip.style.padding = '5px 10px';
                    tooltip.style.borderRadius = '4px';
                    tooltip.style.fontSize = '0.8rem';
                    tooltip.style.zIndex = '1000';
                    tooltip.style.pointerEvents = 'none';
                    
                    document.body.appendChild(tooltip);
                    
                    const rect = this.getBoundingClientRect();
                    tooltip.style.left = rect.left + 'px';
                    tooltip.style.top = (rect.top - tooltip.offsetHeight - 5) + 'px';
                    
                    this._tooltip = tooltip;
                });
                
                el.addEventListener('mouseleave', function() {
                    if (this._tooltip) {
                        document.body.removeChild(this._tooltip);
                        this._tooltip = null;
                    }
                });
            });
        }
        
        // Sample Data Setup
        function setupSampleData() {
            window.sampleData = [
                { nama: "Ahmad Santoso", nik: "1234567890123456", alamat: "Jl. Merdeka No. 12 RT 03 RW 05", kecamatan: "Sukajadi", desa: "Sukamaju" },
                { nama: "Budi Pratama", nik: "2345678901234567", alamat: "Jl. Sudirman No. 45", kecamatan: "Cibeunying", desa: "Cihapit" },
                { nama: "Citra Dewi", nik: "3456789012345678", alamat: "Jl. Gatot Subroto No. 78", kecamatan: "Bandung Kidul", desa: "Mengger" },
                { nama: "Ahmad Santoso", nik: "1234567890123456", alamat: "Jl. Merdeka No. 12", kecamatan: "Sukajadi", desa: "Sukamaju" },
                { nama: "Dian Sari", nik: "4567890123456789", alamat: "Jl. Asia Afrika No. 23", kecamatan: "Sumur Bandung", desa: "Braga" },
                { nama: "Eko Wijaya", nik: "5678901234567890", alamat: "Jl. Cihampelas No. 56", kecamatan: "Cidadap", desa: "Cipaganti" },
                { nama: "Budi Pratama", nik: "2345678901234567", alamat: "Jl. Sudirman No. 45 Lantai 3", kecamatan: "Cibeunying", desa: "" },
                { nama: "Fajar Nugraha", nik: "6789012345678901", alamat: "Jl. Sultan Agung No. 34", kecamatan: "Lengkong", desa: "Turangga" },
                { nama: "Gita Maya", nik: "7890123456789012", alamat: "Jl. Pahlawan No. 67", kecamatan: "Buahbatu", desa: "Kebon Lega" },
                { nama: "Hendra Setiawan", nik: "8901234567890123", alamat: "Jl. Soekarno Hatta No. 89", kecamatan: "Bandung Kulon", desa: "Caringin" },
                { nama: "Indra Kurniawan", nik: "9012345678901234", alamat: "Jl. Pasteur No. 11", kecamatan: "Sukajadi", desa: "Sukagalih" },
                { nama: "Julia Anastasia", nik: "0123456789012345", alamat: "Jl. Dago No. 99", kecamatan: "Coblong", desa: "Dago" },
                { nama: "Kurniawan Eka", nik: "1122334455667788", alamat: "Jl. Buah Batu No. 123", kecamatan: "Lengkong", desa: "Malabar" },
                { nama: "Linda Wijaya", nik: "2233445566778899", alamat: "Jl. Cikutra No. 45", kecamatan: "Cibeunying Kidul", desa: "Cikutra" },
                { nama: "M. Rizki Pratama", nik: "3344556677889900", alamat: "Jl. Cihampelas No. 78", kecamatan: "Cidadap", desa: "Cipaganti" },
                { nama: "Nina Susanti", nik: "4455667788990011", alamat: "Jl. Martadinata No. 56", kecamatan: "Andir", desa: "Campaka" },
                { nama: "Oscar Hermawan", nik: "5566778899001122", alamat: "Jl. Laswi No. 34", kecamatan: "Antapani", desa: "Antapani Tengah" },
                { nama: "Putri Ayu Lestari", nik: "6677889900112233", alamat: "Jl. Surapati No. 67", kecamatan: "Cicendo", desa: "Arjuna" },
                { nama: "Qory Sandioriva", nik: "7788990011223344", alamat: "Jl. Cipaganti No. 89", kecamatan: "Coblong", desa: "Cipaganti" },
                { nama: "Rudi Hartono", nik: "8899001122334455", alamat: "Jl. Suryalaya No. 12", kecamatan: "Ujung Berung", desa: "Cigending" }
            ];
        }
        
        function loadSampleData() {
            originalData = window.sampleData;
            fileData = {
                name: 'data_contoh.xlsx',
                size: 10240,
                rows: originalData.length,
                columns: Object.keys(originalData[0]),
                data: originalData
            };
            
            // Update file info
            document.getElementById('fileName').textContent = 'data_contoh.xlsx';
            document.getElementById('fileSize').textContent = '10 KB';
            document.getElementById('fileRows').textContent = originalData.length;
            document.getElementById('fileColumns').textContent = Object.keys(originalData[0]).join(', ');
            fileInfo.classList.add('show');
            
            // Show preview
            showDataPreview(originalData);
            
            // Setup process settings
            setupProcessSettings(originalData[0]);
            
            // Show success message
            showNotification('Data contoh berhasil dimuat', 'success');
            
            // Show preview card
            document.getElementById('previewCard').style.display = 'block';
        }
    </script>
</body>
</html>
