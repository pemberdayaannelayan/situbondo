<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Statistik Nelayan Kab. Situbondo</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e, #283593);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        header {
            background: linear-gradient(to right, #0d47a1, #1976d2);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .metadata {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .meta-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .meta-item i {
            font-size: 1.2rem;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            min-height: 700px;
        }
        
        .sidebar {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            padding: 25px;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: 800px;
        }
        
        .map-container {
            flex: 2;
            min-width: 500px;
            height: 700px;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
            border-radius: 0 0 15px 0;
        }
        
        .stats-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #1976d2;
        }
        
        .stats-title {
            font-size: 1.3rem;
            color: #0d47a1;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px 10px;
            background: #f5f7ff;
            border-radius: 8px;
            transition: transform 0.3s;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            background: #e8eeff;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #0d47a1;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .desa-list {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 10px;
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .desa-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .desa-item:hover {
            background: #e8eeff;
            padding-left: 20px;
        }
        
        .desa-item.active {
            background: #d1e7ff;
            border-left: 4px solid #1976d2;
        }
        
        .desa-name {
            font-weight: bold;
            color: #0d47a1;
            margin-bottom: 5px;
        }
        
        .desa-details {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            justify-content: space-between;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-width: 250px;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #0d47a1;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        
        .legend-label {
            font-size: 0.85rem;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            background: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #0d47a1;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: #e8eeff;
            transform: translateY(-3px);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
        }
        
        @media (max-width: 1024px) {
            .content {
                flex-direction: column;
            }
            
            .sidebar, .map-container {
                min-width: 100%;
            }
            
            #map {
                border-radius: 0;
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .marker-cluster {
            background-color: rgba(25, 118, 210, 0.6);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-map-marked-alt"></i> Peta Statistik Nelayan Kab. Situbondo</h1>
            <div class="subtitle">Visualisasi Data Bantuan Nelayan Berbasis Peta Digital</div>
            <div class="metadata">
                <div class="meta-item"><i class="fas fa-calendar-alt"></i> Terakhir Update: <span id="lastUpdate">9 Desember 2025</span></div>
                <div class="meta-item"><i class="fas fa-village"></i> Total Desa: <span id="totalDesa">27</span></div>
                <div class="meta-item"><i class="fas fa-users"></i> Total Penerima: <span id="totalPenerima">393</span></div>
                <div class="meta-item"><i class="fas fa-box"></i> Total Bantuan: <span id="totalBantuan">424</span> Unit</div>
            </div>
        </header>
        
        <div class="content">
            <div class="sidebar">
                <div class="stats-box">
                    <div class="stats-title"><i class="fas fa-chart-bar"></i> Ringkasan Statistik</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="summaryDesa">27</div>
                            <div class="stat-label">Desa Terdata</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="summaryPenerima">393</div>
                            <div class="stat-label">Penerima Bantuan</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="summaryBarang">424</div>
                            <div class="stat-label">Bantuan Barang</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="summaryUang">0</div>
                            <div class="stat-label">Bantuan Uang</div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-box">
                    <div class="stats-title"><i class="fas fa-star"></i> Desa Terbanyak Penerima</div>
                    <div id="topDesaList">
                        <!-- Akan diisi oleh JavaScript -->
                    </div>
                </div>
                
                <div class="stats-box">
                    <div class="stats-title"><i class="fas fa-list"></i> Daftar Desa/Kelurahan</div>
                    <div class="desa-list" id="desaList">
                        <!-- Akan diisi oleh JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="map-container">
                <div id="map"></div>
                
                <div class="controls">
                    <button class="control-btn" id="reloadBtn">
                        <i class="fas fa-sync-alt"></i> Reload Data
                    </button>
                    <button class="control-btn" id="resetViewBtn">
                        <i class="fas fa-globe-asia"></i> Reset Peta
                    </button>
                </div>
                
                <div class="legend">
                    <div class="legend-title">Kepadatan Penerima</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ff6b6b;"></div>
                        <div class="legend-label">Tinggi (≥ 50 penerima)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ffd166;"></div>
                        <div class="legend-label">Sedang (20-49 penerima)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #06d6a0;"></div>
                        <div class="legend-label">Rendah (≤ 19 penerima)</div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p><i class="fas fa-database"></i> Sumber Data: Sistem Bantuan Nelayan Kab. Situbondo | Dinas Peternakan dan Perikanan Kab. Situbondo</p>
            <p><i class="fas fa-code"></i> Aplikasi Peta Statistik v2.0 | Data terakhir diperbarui: <span id="footerUpdate">9 Desember 2025 pukul 18.54</span></p>
        </footer>
    </div>

    <!-- Load data file -->
    <script src="datapeta.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let map;
        let markers = [];
        let markerLayerGroup;
        let dataDesa = [];
        
        // Fungsi untuk menginisialisasi peta
        function initMap() {
            // Koordinat tengah Kabupaten Situbondo
            const situbondoCenter = [-7.7069, 113.6347];
            
            // Inisialisasi peta
            map = L.map('map').setView(situbondoCenter, 10);
            
            // Tambahkan tile layer (peta dasar)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Tambahkan layer group untuk marker
            markerLayerGroup = L.layerGroup().addTo(map);
            
            // Load data dari window.DATA_PETA_STATISTIK
            loadData();
        }
        
        // Fungsi untuk memuat data dari datapeta.js
        function loadData() {
            if (!window.DATA_PETA_STATISTIK) {
                console.error("Data tidak ditemukan. Pastikan datapeta.js telah dimuat.");
                alert("Data tidak dapat dimuat. Periksa konsol untuk detail.");
                return;
            }
            
            const data = window.DATA_PETA_STATISTIK;
            dataDesa = data.data || [];
            
            // Update informasi metadata
            document.getElementById('lastUpdate').textContent = data.metadata.lastUpdate;
            document.getElementById('totalDesa').textContent = data.metadata.totalDesa;
            document.getElementById('totalPenerima').textContent = data.metadata.totalPenerima;
            document.getElementById('totalBantuan').textContent = data.summary.totalBantuanBarang;
            document.getElementById('footerUpdate').textContent = data.metadata.lastUpdate;
            
            // Update ringkasan statistik
            document.getElementById('summaryDesa').textContent = data.metadata.totalDesa;
            document.getElementById('summaryPenerima').textContent = data.metadata.totalPenerima;
            document.getElementById('summaryBarang').textContent = data.summary.totalBantuanBarang;
            document.getElementById('summaryUang').textContent = data.summary.totalBantuanUang;
            
            // Tampilkan desa terbanyak penerima
            displayTopDesa(data.summary.desaTerbanyak);
            
            // Tampilkan daftar desa
            displayDesaList(dataDesa);
            
            // Tampilkan marker di peta
            displayMapMarkers(dataDesa);
        }
        
        // Fungsi untuk menampilkan desa dengan penerima terbanyak
        function displayTopDesa(topDesaData) {
            const topDesaList = document.getElementById('topDesaList');
            topDesaList.innerHTML = '';
            
            if (Array.isArray(topDesaData) && topDesaData.length > 0) {
                // Ambil item pertama dari array (desa terbanyak)
                const topDesa = topDesaData[0];
                
                // Periksa apakah topDesa adalah objek atau string
                if (typeof topDesa === 'object' && topDesa.desa) {
                    const desaItem = document.createElement('div');
                    desaItem.className = 'desa-item pulse';
                    desaItem.innerHTML = `
                        <div class="desa-name">${topDesa.desa}, ${topDesa.kecamatan}</div>
                        <div class="desa-details">
                            <span><i class="fas fa-users"></i> ${topDesa.jumlahPenerima} Penerima</span>
                            <span><i class="fas fa-box"></i> ${topDesa.totalBantuanBarang} Unit</span>
                        </div>
                    `;
                    
                    // Tambahkan event click untuk zoom ke desa tersebut
                    desaItem.addEventListener('click', function() {
                        const desaData = dataDesa.find(d => 
                            d.desa === topDesa.desa && d.kecamatan === topDesa.kecamatan
                        );
                        
                        if (desaData && desaData.koordinat) {
                            map.setView([desaData.koordinat.lat, desaData.koordinat.lng], 13);
                            
                            // Highlight marker
                            highlightMarker(desaData.id);
                            
                            // Highlight item di daftar
                            highlightDesaListItem(desaData.id);
                        }
                    });
                    
                    topDesaList.appendChild(desaItem);
                } else if (typeof topDesa === 'string') {
                    // Jika hanya string, tampilkan sebagai teks
                    const desaItem = document.createElement('div');
                    desaItem.className = 'desa-item';
                    desaItem.innerHTML = `<div class="desa-name">${topDesa}</div>`;
                    topDesaList.appendChild(desaItem);
                }
            } else {
                topDesaList.innerHTML = '<p style="text-align: center; color: #666;">Data tidak tersedia</p>';
            }
        }
        
        // Fungsi untuk menampilkan daftar desa
        function displayDesaList(desaData) {
            const desaList = document.getElementById('desaList');
            desaList.innerHTML = '';
            
            // Urutkan berdasarkan jumlah penerima (descending)
            const sortedDesa = [...desaData].sort((a, b) => b.jumlahPenerima - a.jumlahPenerima);
            
            sortedDesa.forEach(desa => {
                const desaItem = document.createElement('div');
                desaItem.className = 'desa-item';
                desaItem.dataset.id = desa.id;
                
                // Tentukan warna berdasarkan jumlah penerima
                let colorClass = '';
                if (desa.jumlahPenerima >= 50) {
                    colorClass = 'high';
                } else if (desa.jumlahPenerima >= 20) {
                    colorClass = 'medium';
                } else {
                    colorClass = 'low';
                }
                
                desaItem.innerHTML = `
                    <div class="desa-name">${desa.desa}, ${desa.kecamatan}</div>
                    <div class="desa-details">
                        <span><i class="fas fa-users"></i> ${desa.jumlahPenerima} Penerima</span>
                        <span><i class="fas fa-box"></i> ${desa.totalBantuanBarang} Unit</span>
                    </div>
                `;
                
                // Tambahkan event click
                desaItem.addEventListener('click', function() {
                    map.setView([desa.koordinat.lat, desa.koordinat.lng], 13);
                    
                    // Highlight marker
                    highlightMarker(desa.id);
                    
                    // Highlight item di daftar
                    highlightDesaListItem(desa.id);
                });
                
                desaList.appendChild(desaItem);
            });
        }
        
        // Fungsi untuk menampilkan marker di peta
        function displayMapMarkers(desaData) {
            // Hapus marker lama
            markerLayerGroup.clearLayers();
            markers = [];
            
            desaData.forEach(desa => {
                if (!desa.koordinat || !desa.koordinat.lat || !desa.koordinat.lng) {
                    console.warn(`Koordinat tidak valid untuk desa ${desa.desa}`);
                    return;
                }
                
                // Tentukan warna marker berdasarkan jumlah penerima
                let markerColor;
                if (desa.jumlahPenerima >= 50) {
                    markerColor = '#ff6b6b'; // Merah
                } else if (desa.jumlahPenerima >= 20) {
                    markerColor = '#ffd166'; // Kuning
                } else {
                    markerColor = '#06d6a0'; // Hijau
                }
                
                // Buat custom icon untuk marker
                const markerIcon = L.divIcon({
                    html: `<div style="
                        background-color: ${markerColor};
                        width: 20px;
                        height: 20px;
                        border-radius: 50%;
                        border: 3px solid white;
                        box-shadow: 0 0 10px rgba(0,0,0,0.5);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        font-size: 10px;
                    ">${desa.jumlahPenerima}</div>`,
                    className: 'custom-marker',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });
                
                // Buat marker
                const marker = L.marker([desa.koordinat.lat, desa.koordinat.lng], {
                    icon: markerIcon,
                    title: `${desa.desa}, ${desa.kecamatan} - ${desa.jumlahPenerima} penerima`
                });
                
                // Tambahkan popup dengan informasi desa
                const popupContent = `
                    <div style="max-width: 300px;">
                        <h3 style="margin: 0 0 10px 0; color: #0d47a1;">${desa.desa}, ${desa.kecamatan}</h3>
                        <p><strong>Jumlah Penerima:</strong> ${desa.jumlahPenerima} orang</p>
                        <p><strong>Total Bantuan Barang:</strong> ${desa.totalBantuanBarang} unit</p>
                        <p><strong>Jenis Bantuan:</strong> ${desa.jenisBantuan.map(b => b.jenis).join(', ')}</p>
                        <p><strong>Tahun Distribusi:</strong> ${desa.tahunDistribusi.map(t => t.tahun).join(', ')}</p>
                        <hr>
                        <p style="font-size: 0.9em; color: #666;"><i>Klik untuk detail lengkap</i></p>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                
                // Tambahkan event click untuk highlight
                marker.on('click', function() {
                    highlightMarker(desa.id);
                    highlightDesaListItem(desa.id);
                });
                
                // Tambahkan ke layer group
                marker.addTo(markerLayerGroup);
                
                // Simpan reference
                markers.push({
                    id: desa.id,
                    marker: marker,
                    desa: desa
                });
            });
            
            // Jika ada data, fit bounds ke semua marker
            if (markers.length > 0) {
                const markerBounds = L.latLngBounds(markers.map(m => [m.marker.getLatLng().lat, m.marker.getLatLng().lng]));
                map.fitBounds(markerBounds, { padding: [50, 50] });
            }
        }
        
        // Fungsi untuk highlight marker berdasarkan ID
        function highlightMarker(desaId) {
            // Reset semua marker
            markers.forEach(m => {
                const markerEl = m.marker.getElement();
                if (markerEl) {
                    markerEl.style.transform = 'scale(1)';
                    markerEl.style.zIndex = '1';
                }
            });
            
            // Highlight marker yang dipilih
            const selectedMarker = markers.find(m => m.id === desaId);
            if (selectedMarker) {
                const markerEl = selectedMarker.marker.getElement();
                if (markerEl) {
                    markerEl.style.transform = 'scale(1.3)';
                    markerEl.style.zIndex = '1000';
                    markerEl.classList.add('pulse');
                    
                    // Buka popup
                    selectedMarker.marker.openPopup();
                    
                    // Hentikan animasi setelah 2 detik
                    setTimeout(() => {
                        markerEl.classList.remove('pulse');
                    }, 2000);
                }
            }
        }
        
        // Fungsi untuk highlight item di daftar desa
        function highlightDesaListItem(desaId) {
            // Hapus class active dari semua item
            const desaItems = document.querySelectorAll('.desa-item');
            desaItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Tambahkan class active ke item yang dipilih
            const selectedItem = document.querySelector(`.desa-item[data-id="${desaId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('active');
                
                // Scroll ke item yang dipilih
                selectedItem.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }
        
        // Fungsi untuk reload data
        function reloadData() {
            // Tampilkan loading indicator
            const reloadBtn = document.getElementById('reloadBtn');
            const originalHTML = reloadBtn.innerHTML;
            reloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memuat...';
            reloadBtn.disabled = true;
            
            // Reload script datapeta.js
            const script = document.querySelector('script[src="datapeta.js"]');
            if (script) {
                // Buat script baru untuk reload
                const newScript = document.createElement('script');
                newScript.src = 'datapeta.js?t=' + new Date().getTime();
                newScript.onload = function() {
                    // Setelah data dimuat, refresh peta
                    loadData();
                    
                    // Reset tombol
                    reloadBtn.innerHTML = originalHTML;
                    reloadBtn.disabled = false;
                    
                    // Tampilkan notifikasi
                    showNotification('Data berhasil dimuat ulang', 'success');
                };
                
                newScript.onerror = function() {
                    // Jika error, reset tombol
                    reloadBtn.innerHTML = originalHTML;
                    reloadBtn.disabled = false;
                    showNotification('Gagal memuat data', 'error');
                };
                
                // Hapus script lama dan tambahkan yang baru
                script.parentNode.removeChild(script);
                document.body.appendChild(newScript);
            } else {
                // Jika script tidak ditemukan, coba loadData langsung
                loadData();
                reloadBtn.innerHTML = originalHTML;
                reloadBtn.disabled = false;
            }
        }
        
        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'info') {
            // Buat elemen notifikasi
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background-color: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: bold;
                animation: slideIn 0.3s ease-out;
            `;
            
            // Tambahkan keyframes untuk animasi
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Hapus notifikasi setelah 3 detik
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Fungsi untuk reset view peta
        function resetView() {
            const situbondoCenter = [-7.7069, 113.6347];
            map.setView(situbondoCenter, 10);
            
            // Reset highlight
            const desaItems = document.querySelectorAll('.desa-item');
            desaItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Reset marker
            markers.forEach(m => {
                const markerEl = m.marker.getElement();
                if (markerEl) {
                    markerEl.style.transform = 'scale(1)';
                    markerEl.style.zIndex = '1';
                }
                m.marker.closePopup();
            });
        }
        
        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi peta
            initMap();
            
            // Event listener untuk tombol reload
            document.getElementById('reloadBtn').addEventListener('click', reloadData);
            
            // Event listener untuk tombol reset view
            document.getElementById('resetViewBtn').addEventListener('click', resetView);
            
            // Tampilkan pesan selamat datang
            setTimeout(() => {
                showNotification('Peta Statistik Nelayan Kab. Situbondo dimuat', 'success');
            }, 1000);
        });
    </script>
</body>
</html>
