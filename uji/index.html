<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>SIMPADAN TANGKAP - SISTEM PEMETAAN NELAYAN</title>
    
    <!-- LOAD SEMUA CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@500;600;700;800;900&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- Style tambahan untuk tombol informasi dan gambar modal -->
    <style>
        /* Tombol informasi jenis ikan */
        .fish-info-btn {
            background-color: #0d6efd;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 5px;
            vertical-align: middle;
            transition: all 0.3s ease;
        }

        .fish-info-btn:hover {
            background-color: #0b5ed7;
            transform: scale(1.1);
        }

        /* Tombol informasi jenis kapal */
        .boat-info-btn {
            background-color: #198754;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 5px;
            vertical-align: middle;
            transition: all 0.3s ease;
        }

        .boat-info-btn:hover {
            background-color: #157347;
            transform: scale(1.1);
        }

        /* Modal gambar ikan - DIPERBAIKI */
        .fish-modal-img {
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto 15px auto;
        }
        
        /* Modal gambar kapal */
        .boat-modal-img {
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto 15px auto;
        }
        
        /* Container untuk gambar ikan */
        .fish-image-container {
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* Container untuk gambar kapal */
        .boat-image-container {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .fish-image-title {
            font-size: 16px;
            font-weight: 600;
            color: #0c2461;
            margin-bottom: 8px;
            text-align: left;
        }
        
        .boat-image-title {
            font-size: 16px;
            font-weight: 600;
            color: #0c2461;
            margin-bottom: 8px;
            text-align: left;
        }
        
        .fish-image-caption {
            font-size: 14px;
            color: #6c757d;
            text-align: left;
            font-style: italic;
        }
        
        .boat-image-caption {
            font-size: 14px;
            color: #6c757d;
            text-align: left;
            font-style: italic;
        }
        
        /* Loading untuk gambar */
        .fish-image-loading {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .boat-image-loading {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        /* Perbaikan untuk backdrop modal */
        .modal-backdrop {
            z-index: 1040;
        }
        
        .modal {
            z-index: 1050;
        }
        
        /* Perbaikan untuk modal fishInfoModal dan boatInfoModal */
        #fishInfoModal .modal-content,
        #boatInfoModal .modal-content {
            z-index: 1060;
        }
    </style>
    
    <!-- LOAD SEMUA JAVASCRIPT LIBRARY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- LOAD FILE JAVASCRIPT YANG DIPISAHKAN -->
    <script src="idcard.js" onerror="console.log('File idcard.js tidak ditemukan, menggunakan versi di main.js')"></script>
    <script src="reload.js" onerror="console.log('File reload.js belum tersedia di server, menggunakan database lokal.')"></script>
    <script src="convert.js"></script>
    <script src="main.js" defer></script>
    
    <!-- Skrip untuk mengelola modal gambar ikan dan kapal - DIPERBAIKI -->
    <script>
        // Fungsi untuk menampilkan modal info ikan
        function showFishInfoModal() {
            try {
                // Hapus backdrop yang mungkin tertinggal
                const existingBackdrops = document.querySelectorAll('.modal-backdrop');
                existingBackdrops.forEach(backdrop => {
                    backdrop.remove();
                });
                
                // Hapus kelas modal-open dari body jika ada
                document.body.classList.remove('modal-open');
                
                const fishModal = new bootstrap.Modal(document.getElementById('fishInfoModal'), {
                    backdrop: true,
                    keyboard: true
                });
                fishModal.show();
                
                // Preload gambar untuk memastikan dapat dimuat
                preloadFishImages();
            } catch (error) {
                console.error('Gagal membuka modal info ikan:', error);
                alert('Modal informasi ikan tidak dapat dibuka. Silakan coba lagi.');
            }
        }
        
        // Fungsi untuk menampilkan modal info kapal
        function showBoatInfoModal() {
            try {
                // Hapus backdrop yang mungkin tertinggal
                const existingBackdrops = document.querySelectorAll('.modal-backdrop');
                existingBackdrops.forEach(backdrop => {
                    backdrop.remove();
                });
                
                // Hapus kelas modal-open dari body jika ada
                document.body.classList.remove('modal-open');
                
                const boatModal = new bootstrap.Modal(document.getElementById('boatInfoModal'), {
                    backdrop: true,
                    keyboard: true
                });
                boatModal.show();
                
                // Preload gambar untuk memastikan dapat dimuat
                preloadBoatImages();
            } catch (error) {
                console.error('Gagal membuka modal info kapal:', error);
                alert('Modal informasi kapal tidak dapat dibuka. Silakan coba lagi.');
            }
        }
        
        // Fungsi untuk memuat gambar ikan secara asinkron
        function preloadFishImages() {
            const imageUrls = [
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/info-jenis-ikan-tangkapan-1.jpg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/info-jenis-ikan-tangkapan-2.jpg',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/info-jenis-ikan-tangkapan-3.jpg'
            ];
            
            imageUrls.forEach((url, index) => {
                const img = new Image();
                img.src = url;
                img.onload = function() {
                    console.log(`Gambar ikan ${index + 1} berhasil dimuat`);
                };
                img.onerror = function() {
                    console.error(`Gagal memuat gambar ikan ${index + 1}: ${url}`);
                    // Tampilkan placeholder jika gambar gagal dimuat
                    const imgElement = document.getElementById(`fishImage${index + 1}`);
                    if (imgElement) {
                        imgElement.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300" viewBox="0 0 400 300"><rect width="400" height="300" fill="%23f8f9fa"/><text x="200" y="150" text-anchor="middle" font-family="Arial" font-size="16" fill="%236c757d">Gambar tidak tersedia</text></svg>';
                        imgElement.alt = `Gambar referensi ikan ${index + 1} tidak tersedia`;
                    }
                };
            });
        }
        
        // Fungsi untuk memuat gambar kapal secara asinkron
        function preloadBoatImages() {
            const imageUrls = [
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/jenis-perahu-1.png',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/jenis-perahu-2.png',
                'https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/jenis-perahu-3.png'
            ];
            
            imageUrls.forEach((url, index) => {
                const img = new Image();
                img.src = url;
                img.onload = function() {
                    console.log(`Gambar kapal ${index + 1} berhasil dimuat`);
                };
                img.onerror = function() {
                    console.error(`Gagal memuat gambar kapal ${index + 1}: ${url}`);
                    // Tampilkan placeholder jika gambar gagal dimuat
                    const imgElement = document.getElementById(`boatImage${index + 1}`);
                    if (imgElement) {
                        imgElement.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300" viewBox="0 0 400 300"><rect width="400" height="300" fill="%23f8f9fa"/><text x="200" y="150" text-anchor="middle" font-family="Arial" font-size="16" fill="%236c757d">Gambar tidak tersedia</text></svg>';
                        imgElement.alt = `Gambar referensi kapal ${index + 1} tidak tersedia`;
                    }
                };
            });
        }
        
        // Fungsi untuk menampilkan gambar spesifik di modal
        function showSpecificFishImage(imageNumber) {
            showFishInfoModal();
            // Jika perlu scroll ke gambar tertentu
            setTimeout(() => {
                const imageElement = document.getElementById(`fishImage${imageNumber}`);
                if (imageElement) {
                    imageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 500);
        }
        
        // Fungsi untuk menampilkan gambar spesifik di modal kapal
        function showSpecificBoatImage(imageNumber) {
            showBoatInfoModal();
            // Jika perlu scroll ke gambar tertentu
            setTimeout(() => {
                const imageElement = document.getElementById(`boatImage${imageNumber}`);
                if (imageElement) {
                    imageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 500);
        }
        
        // Fungsi untuk menutup modal ikan dengan aman - DITAMBAHKAN
        function closeFishInfoModalSafely() {
            try {
                const modalElement = document.getElementById('fishInfoModal');
                if (modalElement) {
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Hapus backdrop setelah modal ditutup
                    setTimeout(() => {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => {
                            backdrop.remove();
                        });
                        
                        // Hapus kelas modal-open dari body
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                    }, 300);
                }
            } catch (error) {
                console.error('Error closing modal:', error);
            }
        }
        
        // Fungsi untuk menutup modal kapal dengan aman - DITAMBAHKAN
        function closeBoatInfoModalSafely() {
            try {
                const modalElement = document.getElementById('boatInfoModal');
                if (modalElement) {
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Hapus backdrop setelah modal ditutup
                    setTimeout(() => {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => {
                            backdrop.remove();
                        });
                        
                        // Hapus kelas modal-open dari body
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                    }, 300);
                }
            } catch (error) {
                console.error('Error closing modal:', error);
            }
        }
        
        // Fungsi untuk kembali ke input data nelayan - DIPERBAIKI
        function goToInputDataAfterModal() {
            // Tutup modal dengan aman terlebih dahulu
            closeFishInfoModalSafely();
            closeBoatInfoModalSafely();
            
            // Tunggu sebentar untuk memastikan modal benar-benar tertutup
            setTimeout(() => {
                try {
                    // Klik tab input data
                    const inputTab = document.getElementById('v-pills-input-tab');
                    if (inputTab) {
                        inputTab.click();
                        
                        // Scroll ke atas halaman
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                        
                        // Fokus ke form input
                        const namaInput = document.getElementById('nama');
                        if (namaInput) {
                            setTimeout(() => {
                                namaInput.focus();
                            }, 100);
                        }
                    }
                } catch (error) {
                    console.error('Error navigating to input tab:', error);
                }
            }, 400);
        }
    </script>
</head>
<body>

    <!-- Modal Loading -->
    <div class="loading-modal-overlay" id="loadingModal" style="display: none;">
        <div class="loading-modal-content">
            <div class="loading-spinner"></div>
            <h3 class="loading-title" id="loadingTitle">Memproses Data</h3>
            <p class="loading-message" id="loadingMessage">Mohon tunggu, sistem sedang memproses permintaan Anda. Proses ini mungkin memerlukan waktu beberapa saat tergantung jumlah data yang tersedia.</p>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <div id="qr-code-generator">
        <div id="qr-right"></div> 
    </div>
    
    <!-- Container untuk tabel PDF (hidden) -->
    <div class="pdf-table-container" id="pdfTableContainer"></div>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- PERBAIKAN LOGIN: TAMBAHKAN INPUT USERNAME -->
    <div class="login-overlay" id="loginModal">
        <ul class="circles">
            <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
        </ul>
        <div class="login-card">
            <div class="login-header-new">
                <div class="simata-logo-container">
                    <div class="simata-icon-box">
                        <img src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/logoku.png" alt="Logo SIMPADAN TANGKAP" onerror="this.onerror=null; this.innerHTML='<i class=\'fas fa-eye fa-4x\'></i>';">
                    </div>
                </div>
                <h1 class="simata-title">SIMPADAN TANGKAP</h1>
                <p class="simata-subtitle">SISTEM SATU DATA NELAYAN</p>
                <div class="simata-slogan">Situbondo Naik Kelas</div>
            </div>
            <div class="p-4 p-md-5 pt-2">
                <!-- PERBAIKAN: UBAH FORM LOGIN SESUAI DENGAN main.js -->
                <form id="loginForm">
                    <div class="mb-4 text-center">
                        <p class="small text-primary fw-bold mb-2" id="currentDateDisplay"></p>
                        
                        <!-- Input Username -->
                        <div class="input-group input-group-lg shadow-sm rounded-pill overflow-hidden mb-3">
                            <span class="input-group-text bg-light border-0 ps-4"><i class="fas fa-user text-primary"></i></span>
                            <input type="text" class="form-control bg-light border-0 fs-6" id="loginUsername" placeholder="Masukkan username" required>
                        </div>
                        
                        <!-- Input Password -->
                        <div class="input-group input-group-lg shadow-sm rounded-pill overflow-hidden">
                            <span class="input-group-text bg-light border-0 ps-4"><i class="fas fa-key text-success"></i></span>
                            <input type="password" class="form-control bg-light border-0 fs-6" id="loginPassword" placeholder="Masukkan password" required>
                            <button type="button" class="input-group-text bg-light border-0 password-toggle-btn" id="loginPasswordToggle">
                                <i class="fas fa-eye" id="passwordToggleIcon"></i>
                            </button>
                        </div>
                        <small class="text-muted mt-2 d-block" id="passwordHint">Masukkan username dan password untuk mengakses sistem</small>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-3 fw-bold shadow rounded-pill" id="loginButton" style="background: var(--primary-gradient);">
                        BUKA DASHBOARD
                        <span class="spinner-border spinner-border-sm d-none ms-2" id="loginSpinner"></span>
                    </button>
                </form>
                
                <!-- TOMBOL TAMBAHAN BARU -->
                <div class="login-extra-buttons">
                    <a href="https://drive.google.com/drive/folders/1zmLnQ8bXFEL682BXzA2pV6WsQq7p4wdo?usp=sharing" target="_blank" class="btn btn-outline-primary">
                        <i class="fas fa-download me-2"></i>Panduan Aplikasi
                    </a>
                    <a href="http://www.dinasperikanansitubondo.com/simpadan/peta" target="_blank" class="btn btn-outline-success">
                        <i class="fas fa-map me-2"></i>Lihat Peta
                    </a>
                </div>
                
                <div class="text-center mt-4 pt-3 border-top">
                    <small class="text-muted opacity-75">&copy; 2025 Dinas Perikanan Kabupaten Situbondo</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Notifikasi Login Berhasil -->
    <div class="modal fade login-success-modal" id="loginSuccessModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="w-100 d-flex flex-column align-items-center justify-content-center">
                        <i class="fas fa-check-circle fa-3x mb-3 text-warning"></i>
                        <h4 class="fw-bold mb-0 text-center">Akses Diotorisasi</h4>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="login-success-icon d-flex justify-content-center">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h5 class="fw-bold text-center mb-4" style="color: #0c2461;">SELAMAT DATANG DI SIMPADAN TANGKAP</h5>
                    
                    <div class="welcome-message">
                        <p class="mb-3">Anda telah berhasil mengakses <span class="fw-bold" style="color: #0c2461;">Sistem Informasi Pemetaan Data Nelayan Terpadu</span> Dinas Perikanan Kabupaten Situbondo.</p>
                        
                        <div class="welcome-highlight mb-3">
                            <i class="fas fa-user-check me-2"></i>Akses Anda telah diverifikasi dan diotorisasi
                        </div>
                        
                        <div class="welcome-highlight mb-3">
                            <i class="fas fa-database me-2"></i>Sistem siap untuk pengelolaan data nelayan terpadu
                        </div>
                        
                        <div class="welcome-highlight">
                            <i class="fas fa-chart-line me-2"></i>Dashboard analitik tersedia untuk pengambilan keputusan
                        </div>
                    </div>
                    
                    <p class="text-muted small mt-4 text-center">
                        <i class="fas fa-info-circle me-2"></i>
                        Sistem ini menggunakan teknologi keamanan dinamis untuk melindungi data sensitif
                    </p>
                </div>
                <div class="modal-footer justify-content-center border-0">
                    <button type="button" class="btn btn-primary px-5 fw-bold shadow" data-bs-dismiss="modal" id="btnContinueDashboard">
                        <i class="fas fa-rocket me-2"></i>LANJUT KE DASHBOARD
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="welcomeModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content welcome-modal-content">
                <div class="welcome-header">
                    <i class="fas fa-satellite-dish fa-3x mb-3 text-warning"></i>
                    <h4 class="fw-bold mb-0">Selamat Datang, Sobat!</h4>
                </div>
                <div class="welcome-body">
                    <p class="text-muted mb-4">
                        Untuk memastikan data yang Anda akses adalah data terbaru dan valid, sistem merekomendasikan untuk melakukan <strong>Sinkronisasi Data</strong> terlebih dahulu.
                    </p>
                    <div class="d-grid gap-2 justify-content-center">
                        <button type="button" class="welcome-btn-reload" id="btnWelcomeReload">
                            <i class="fas fa-sync me-2"></i> Sinkronisasi Data Sekarang
                        </button>
                        <button type="button" class="btn btn-link text-muted text-decoration-none btn-sm mt-2" data-bs-dismiss="modal">
                            Tutup Notifikasi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal untuk informasi ikan -->
    <div class="modal fade" id="fishInfoModal" tabindex="-1" aria-labelledby="fishInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="fishInfoModalLabel">Informasi Jenis Ikan Tangkapan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 fish-image-container">
                            <h6 class="fish-image-title">Jenis Ikan Demersal</h6>
                            <img id="fishImage1" src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/info-jenis-ikan-tangkapan-1.jpg" 
                                 alt="Jenis Ikan Demersal" class="fish-modal-img" 
                                 onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"300\" viewBox=\"0 0 400 300\"><rect width=\"400\" height=\"300\" fill=\"%23f8f9fa\"/><text x=\"200\" y=\"150\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"16\" fill=\"%236c757d\">Gambar tidak tersedia</text></svg>'">
                            <p class="fish-image-caption">Contoh ikan kategori demersal: Ikan Kerapu, Kakap Merah, Mangla, dll.</p>
                        </div>
                        <div class="col-md-4 fish-image-container">
                            <h6 class="fish-image-title">Jenis Ikan Pelagis Kecil</h6>
                            <img id="fishImage2" src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/info-jenis-ikan-tangkapan-2.jpg" 
                                 alt="Jenis Ikan Pelagis Kecil" class="fish-modal-img"
                                 onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"300\" viewBox=\"0 0 400 300\"><rect width=\"400\" height=\"300\" fill=\"%23f8f9fa\"/><text x=\"200\" y=\"150\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"16\" fill=\"%236c757d\">Gambar tidak tersedia</text></svg>'">
                            <p class="fish-image-caption">Contoh ikan kategori pelagis kecil: Tembang, Kembung, Selar, Layang, dll.</p>
                        </div>
                        <div class="col-md-4 fish-image-container">
                            <h6 class="fish-image-title">Jenis Ikan Pelagis Besar</h6>
                            <img id="fishImage3" src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/info-jenis-ikan-tangkapan-3.jpg" 
                                 alt="Jenis Ikan Pelagis Besar" class="fish-modal-img"
                                 onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"300\" viewBox=\"0 0 400 300\"><rect width=\"400\" height=\"300\" fill=\"%23f8f9fa\"/><text x=\"200\" y=\"150\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"16\" fill=\"%236c757d\">Gambar tidak tersedia</text></svg>'">
                            <p class="fish-image-caption">Contoh ikan kategori pelagis besar: Tongkol, Cakalang, Tenggiri, Tuna, dll.</p>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Informasi:</strong> Pilih jenis ikan yang sesuai dengan hasil tangkapan utama nelayan. Klik tombol informasi <button class="fish-info-btn" disabled><i class="fas fa-info-circle"></i></button> untuk melihat referensi gambar.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="goToInputDataAfterModal()">Kembali ke Input Data</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal untuk informasi kapal -->
    <div class="modal fade" id="boatInfoModal" tabindex="-1" aria-labelledby="boatInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="boatInfoModalLabel">Informasi Jenis Kapal Nelayan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 boat-image-container">
                            <h6 class="boat-image-title">Perahu Tanpa Motor (PTM)</h6>
                            <img id="boatImage1" src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/jenis-perahu-1.png" 
                                 alt="Perahu Tanpa Motor" class="boat-modal-img"
                                 onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"300\" viewBox=\"0 0 400 300\"><rect width=\"400\" height=\"300\" fill=\"%23f8f9fa\"/><text x=\"200\" y=\"150\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"16\" fill=\"%236c757d\">Gambar tidak tersedia</text></svg>'">
                            <p class="boat-image-caption">Perahu tradisional tanpa mesin, digerakkan dayung/layar.</p>
                        </div>
                        <div class="col-md-4 boat-image-container">
                            <h6 class="boat-image-title">Perahu Motor Tempel (PMT)</h6>
                            <img id="boatImage2" src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/jenis-perahu-2.png" 
                                 alt="Perahu Motor Tempel" class="boat-modal-img"
                                 onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"300\" viewBox=\"0 0 400 300\"><rect width=\"400\" height=\"300\" fill=\"%23f8f9fa\"/><text x=\"200\" y=\"150\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"16\" fill=\"%236c757d\">Gambar tidak tersedia</text></svg>'">
                            <p class="boat-image-caption">Perahu dengan mesin tempel di bagian belakang.</p>
                        </div>
                        <div class="col-md-4 boat-image-container">
                            <h6 class="boat-image-title">Kapal Motor (KM)</h6>
                            <img id="boatImage3" src="https://raw.githubusercontent.com/pemberdayaannelayan/situbondo/refs/heads/main/simpadan/hasil-tangkapan/jenis-perahu-3.png" 
                                 alt="Kapal Motor" class="boat-modal-img"
                                 onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"300\" viewBox=\"0 0 400 300\"><rect width=\"400\" height=\"300\" fill=\"%23f8f9fa\"/><text x=\"200" y=\"150\" text-anchor=\"middle\" font-family=\"Arial\" font-size=\"16\" fill=\"%236c757d\">Gambar tidak tersedia</text></svg>'">
                            <p class="boat-image-caption">Kapal dengan mesin dalam, kapasitas lebih besar.</p>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Informasi:</strong> Pilih jenis kapal yang sesuai dengan kapal yang digunakan nelayan. Klik tombol informasi <button class="boat-info-btn" disabled><i class="fas fa-info-circle"></i></button> untuk melihat referensi gambar.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="goToInputDataAfterModal()">Kembali ke Input Data</button>
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Konten utama aplikasi (akan ditampilkan setelah login berhasil) -->
    <div id="appContent" style="display: none;">
        <!-- NAVBAR -->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top main-navbar">
            <div class="container-fluid">
                <a class="navbar-brand d-flex align-items-center" href="#">
                    <div class="brand-logo">
                        <i class="fas fa-fish me-2"></i>
                    </div>
                    <div class="brand-text">
                        <div class="app-title">SIMPADAN TANGKAP</div>
                        <div class="app-subtitle" id="dynamicSubtitle">DINAS PERIKANAN KABUPATEN SITUBONDO</div>
                    </div>
                </a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="mainNavbar">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="mobileMenuBtn">
                                <i class="fas fa-bars me-1"></i> Menu
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="btn-reload-repo">
                                <i class="fas fa-sync-alt me-1"></i> Sinkronisasi
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="btn-refresh-page">
                                <i class="fas fa-redo me-1"></i> Refresh
                            </a>
                        </li>
                        <li class="nav-item">
                            <span class="nav-link">
                                <i class="fas fa-user me-1"></i>
                                <span id="currentUserDisplay">Administrator</span>
                            </span>
                        </li>
                        <li class="nav-item">
                            <span class="nav-link sensor-status" id="sensorStatusText">
                                <i class="fas fa-shield-alt me-1"></i> Sensor: ON
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- SIDEBAR & MAIN CONTENT -->
        <div class="container-fluid main-container">
            <div class="row">
                <!-- Sidebar Menu -->
                <div class="col-lg-2 col-md-3 sidebar" id="sidebarMenu">
                    <div class="sidebar-header">
                        <h5><i class="fas fa-bars me-2"></i> Menu Navigasi</h5>
                    </div>
                    
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dashboard" type="button" role="tab">
                            <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                        </button>
                        
                        <button class="nav-link" id="v-pills-input-tab" data-bs-toggle="pill" data-bs-target="#v-pills-input" type="button" role="tab">
                            <i class="fas fa-edit me-2"></i> Input Data
                        </button>
                        
                        <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button" role="tab">
                            <i class="fas fa-database me-2"></i> Data Nelayan
                        </button>
                        
                        <button class="nav-link" id="v-pills-filter-tab" data-bs-toggle="pill" data-bs-target="#v-pills-filter" type="button" role="tab">
                            <i class="fas fa-filter me-2"></i> Filter & Validasi
                        </button>
                        
                        <button class="nav-link" id="v-pills-verify-tab" data-bs-toggle="pill" data-bs-target="#v-pills-verify" type="button" role="tab">
                            <i class="fas fa-search me-2"></i> Verifikasi KIN
                        </button>
                        
                        <button class="nav-link" id="v-pills-export-tab" data-bs-toggle="pill" data-bs-target="#v-pills-export" type="button" role="tab">
                            <i class="fas fa-file-export me-2"></i> Ekspor Data
                        </button>
                        
                        <button class="nav-link" id="v-pills-backup-tab" data-bs-toggle="pill" data-bs-target="#v-pills-backup" type="button" role="tab">
                            <i class="fas fa-hdd me-2"></i> Backup & Restore
                        </button>
                        
                        <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab">
                            <i class="fas fa-cog me-2"></i> Pengaturan
                        </button>
                        
                        <button class="nav-link text-danger" id="v-pills-logout-tab" type="button">
                            <i class="fas fa-sign-out-alt me-2"></i> Logout
                        </button>
                    </div>
                    
                    <div class="sidebar-footer">
                        <div class="current-wilayah" id="currentWilayahBadge">
                            <i class="fas fa-map-marker-alt me-2"></i> Wilayah: Global
                        </div>
                        <small class="text-muted" id="wilayahInfo">Mode Global: Data dari reload.js</small>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="col-lg-10 col-md-9 offset-lg-2 offset-md-3 main-content">
                    <div class="tab-content" id="v-pills-tabContent">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="v-pills-dashboard" role="tabpanel">
                            <div class="dashboard-header">
                                <h2><i class="fas fa-tachometer-alt me-2"></i> Dashboard SIMPADAN TANGKAP</h2>
                                <p class="text-muted">Statistik dan analisis data nelayan terpadu</p>
                            </div>
                            
                            <!-- Statistik Cards -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="stat-card bg-primary">
                                        <div class="stat-icon">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h3 id="totalPenerima">0</h3>
                                            <p>Total Nelayan</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card bg-warning">
                                        <div class="stat-icon">
                                            <i class="fas fa-user-clock"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h3 id="totalPenuhWaktu">0</h3>
                                            <p>Penuh Waktu</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card bg-success">
                                        <div class="stat-icon">
                                            <i class="fas fa-ship"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h3 id="totalPemilik">0</h3>
                                            <p>Pemilik Kapal</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card bg-info">
                                        <div class="stat-icon">
                                            <i class="fas fa-user-friends"></i>
                                        </div>
                                        <div class="stat-info">
                                            <h3 id="totalABK">0</h3>
                                            <p>Anak Buah Kapal</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Charts -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5><i class="fas fa-chart-pie me-2"></i> Distribusi Profesi Nelayan</h5>
                                        </div>
                                        <div class="chart-container">
                                            <canvas id="profesiChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="chart-card">
                                        <div class="chart-header">
                                            <h5><i class="fas fa-chart-bar me-2"></i> Distribusi Jenis Kapal</h5>
                                        </div>
                                        <div class="chart-container">
                                            <canvas id="kapalChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Info Tambahan -->
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="info-card">
                                        <div class="info-header bg-info">
                                            <i class="fas fa-user-tag"></i>
                                            <h5>Nelayan Sambilan Utama</h5>
                                        </div>
                                        <div class="info-body">
                                            <h2 id="totalSambilanUtama">0</h2>
                                            <p>Orang</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="info-card">
                                        <div class="info-header bg-secondary">
                                            <i class="fas fa-user-tag"></i>
                                            <h5>Nelayan Sambilan Tambahan</h5>
                                        </div>
                                        <div class="info-body">
                                            <h2 id="totalSambilanTambahan">0</h2>
                                            <p>Orang</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="info-card">
                                        <div class="info-header bg-purple">
                                            <i class="fas fa-database"></i>
                                            <h5>Data Wilayah</h5>
                                        </div>
                                        <div class="info-body">
                                            <button class="btn btn-outline-primary w-100" id="btnDataWilayah">
                                                <i class="fas fa-map me-2"></i> Kelola Data Wilayah
                                            </button>
                                            <small class="text-muted mt-2 d-block">Kelola data per desa/kecamatan</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Input Data Tab -->
                        <div class="tab-pane fade" id="v-pills-input" role="tabpanel">
                            <!-- Konten input data akan diisi oleh main.js -->
                        </div>
                        
                        <!-- Data Nelayan Tab -->
                        <div class="tab-pane fade" id="v-pills-data" role="tabpanel">
                            <!-- Konten data nelayan akan diisi oleh main.js -->
                        </div>
                        
                        <!-- Filter & Validasi Tab -->
                        <div class="tab-pane fade" id="v-pills-filter" role="tabpanel">
                            <!-- Konten filter & validasi akan diisi oleh main.js -->
                        </div>
                        
                        <!-- Verifikasi KIN Tab -->
                        <div class="tab-pane fade" id="v-pills-verify" role="tabpanel">
                            <!-- Konten verifikasi KIN akan diisi oleh main.js -->
                        </div>
                        
                        <!-- Ekspor Data Tab -->
                        <div class="tab-pane fade" id="v-pills-export" role="tabpanel">
                            <!-- Konten ekspor data akan diisi oleh main.js -->
                        </div>
                        
                        <!-- Backup & Restore Tab -->
                        <div class="tab-pane fade" id="v-pills-backup" role="tabpanel">
                            <!-- Konten backup & restore akan diisi oleh main.js -->
                        </div>
                        
                        <!-- Pengaturan Tab -->
                        <div class="tab-pane fade" id="v-pills-settings" role="tabpanel">
                            <!-- Konten pengaturan akan diisi oleh main.js -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Button -->
        <div class="fab-container" id="fabMenu">
            <button class="fab-main-btn" id="fabMainBtn">
                <i class="fas fa-plus"></i>
            </button>
            
            <button class="fab-btn fab-input" id="fabInput" title="Input Data">
                <i class="fas fa-edit"></i>
            </button>
            
            <button class="fab-btn fab-filter" id="fabFilter" title="Filter Data">
                <i class="fas fa-filter"></i>
            </button>
            
            <button class="fab-btn fab-verify" id="fabVerify" title="Verifikasi KIN">
                <i class="fas fa-search"></i>
            </button>
            
            <button class="fab-btn fab-export" id="fabExport" title="Ekspor Data">
                <i class="fas fa-file-export"></i>
            </button>
            
            <button class="fab-btn fab-backup" id="fabBackup" title="Backup Data">
                <i class="fas fa-hdd"></i>
            </button>
            
            <button class="fab-btn fab-settings" id="fabSettings" title="Pengaturan">
                <i class="fas fa-cog"></i>
            </button>
            
            <button class="fab-btn fab-reload" id="fabReload" title="Sinkronisasi Data">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>

    <!-- Modal Detail -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Konten detail modal akan diisi oleh main.js -->
            </div>
        </div>
    </div>

    <!-- Modal Data Wilayah -->
    <div class="modal fade" id="modalDataWilayah" tabindex="-1" aria-labelledby="modalDataWilayahLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <!-- Konten modal data wilayah akan diisi oleh main.js -->
            </div>
        </div>
    </div>

    <!-- Toast Notifikasi -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notifikasi</strong>
                <small class="text-muted">baru saja</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Pesan notifikasi akan muncul di sini.
            </div>
        </div>
    </div>

    <script>
        // Fungsi untuk kembali ke input data - tetap dipertahankan
        if (typeof goToInputDataAfterModal === 'undefined') {
            window.goToInputDataAfterModal = function() {
                // Tutup modal dengan aman terlebih dahulu
                if (typeof closeFishInfoModalSafely !== 'undefined') closeFishInfoModalSafely();
                if (typeof closeBoatInfoModalSafely !== 'undefined') closeBoatInfoModalSafely();
                
                // Tunggu sebentar untuk memastikan modal benar-benar tertutup
                setTimeout(() => {
                    try {
                        // Klik tab input data
                        const inputTab = document.getElementById('v-pills-input-tab');
                        if (inputTab) {
                            inputTab.click();
                            
                            // Scroll ke atas halaman
                            window.scrollTo({
                                top: 0,
                                behavior: 'smooth'
                            });
                            
                            // Fokus ke form input
                            const namaInput = document.getElementById('nama');
                            if (namaInput) {
                                setTimeout(() => {
                                    namaInput.focus();
                                }, 100);
                            }
                        }
                    } catch (error) {
                        console.error('Error navigating to input tab:', error);
                    }
                }, 400);
            };
        }

        //=============================================== code saya sembunyikan karena tidak ada perubahan ==================================================================//
    </script>

</body>
</html>
